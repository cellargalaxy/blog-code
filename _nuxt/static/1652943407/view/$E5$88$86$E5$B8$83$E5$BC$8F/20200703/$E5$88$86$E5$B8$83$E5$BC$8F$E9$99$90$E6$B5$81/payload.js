__NUXT_JSONP__("/view/$E5$88$86$E5$B8$83$E5$BC$8F/20200703/$E5$88$86$E5$B8$83$E5$BC$8F$E9$99$90$E6$B5$81", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_){return {data:[{siteConfig:{siteName:an,siteHost:"https:\u002F\u002Fcellargalaxy.github.io",basePath:"\u002Fblog-code\u002F",navs:[{text:"文章",url:"\u002Fblog-code\u002Fpage\u002F1\u002F"},{text:"归档",url:"\u002Fblog-code\u002Farchive\u002F0\u002F"},{text:"画画",url:"\u002Fblog-code\u002Fhtml\u002Fhua.html"},{text:"开源",url:"\u002Fblog-code\u002Fhttps:\u002Fgithub.com\u002Fcellargalaxy\u002Fblog-vue"}],pageSize:10,urlReplace:{"^/file/blog/code":"http:\u002F\u002F123.207.79.108\u002Ffile\u002Ffile\u002Fblog\u002Fcode"},backgroundImage:{duration:ao,fade:1000,images:[{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FcofTzDQXitjeVZ6.jpg",description:ap,type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FsfaRJ2lVeM3NDbE.jpg",description:ap,type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F26\u002FKybiTdftam5Su7x.jpg",description:"青春猪头-双葉理央",type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F09\u002F08\u002FxdX73nfs24qgOYk.jpg",description:"京吹-明日香,久美子",type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F14\u002FMAiruNcEFW2HYtg.jpg",description:"终将成为你-七海灯子,小糸侑",type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F05\u002FEojdAxTDJsFpbPw.jpg",description:"玉子市场-北白川玉子",type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F31\u002FAXxwJDRS9fmN2uU.jpg",description:"fate_hf-弓道馆",type:z},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F01\u002FaHhVObpJus6dnM4.jpg",description:"fate_hf-樱花树",type:z}]}},homeConfig:{brandInterval:ao,brands:[{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F21\u002FmMEAnwY5XPC2pFb.jpg",title:"日常",texts:["我们所度过的每个平凡的日常，也许就是连续不断发生的奇迹。","日々、私たちが過ごしている日常は、実は奇跡の連続なのかもしれない。"]},{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F04\u002F19\u002FH1MmXb9xPcYEhT2.jpg",title:"昨日之歌",texts:["时间梭梭箭如飞，人道漫漫步蹒跚","人間そんな変わるもんじゃないのに、月日ばっかどんどん過ぎて"]}],navs:[{text:"Github",url:"https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002F"}]},pageFootConfig:{lines:[[{text:"Copyright © 2017-? ."},{text:"备案？不存在的"},{text:"Powered by Nuxt.js & Github"}]]},buildTime:new Date(1652943414400),siteName:an,file:{slug:aq,description:J,createdAt:ar,updatedAt:ar,toc:[],body:{type:as,children:[{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"下面所说到的并发数，除了考虑请求接受的速度以外，还需要考虑每个请求的处理时间的。\n但是为了方便讨论，这里就假设这些请求都能在较短的时间内完成，在合理的请求速度下，请求不会因为处理时间过长而堆积。"}]},{type:a,value:f},{type:b,tag:K,props:{id:at},children:[{type:b,tag:A,props:{href:"#%E5%9B%BA%E5%AE%9A%E7%AA%97%E5%8F%A3%E8%AE%A1%E6%95%B0%E5%99%A8",ariaHidden:L,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:at}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"例如每秒钟限制20个请求，每一秒为一个窗口，计数器记录一秒钟的请求数量，超过20次则触发限流，到下一秒计数器重置。\n固定窗口计数器能控制总的请求数，但是并发数可能会是请求数的两倍。\n例如第一秒的最后面和第二秒的最前面集中了这40次的请求，那么最大并发数就可能是40。"}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:T,props:{alt:J,"data-src":"http:\u002F\u002F123.207.79.108\u002Ffile\u002Ffile\u002Fblog\u002Fcode\u002F20200703\u002Fstatic001.infoq.cn-resource-image-8d-15-8ded7a2b90e1482093f92fff555b3615.png.JPEG"},children:[]}]},{type:a,value:f},{type:b,tag:K,props:{id:au},children:[{type:b,tag:A,props:{href:"#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E8%AE%A1%E6%95%B0%E5%99%A8",ariaHidden:L,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:au}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"例如每秒钟限制20个请求，滑动窗口大小为一秒，将每秒划分为十个区间，并且会保存最近的十个区间的请求数量。\n当请求来的时候，会对最近十个区间进行求和。如果和大于20次，则触发限流。\n滑动窗口计数器只是固定窗口计数器的平滑版本，区间越小，平滑程度越高所需的储存空间也越大。\n但是固定窗口计数器有的问题他依然有。"}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:T,props:{alt:J,"data-src":"http:\u002F\u002F123.207.79.108\u002Ffile\u002Ffile\u002Fblog\u002Fcode\u002F20200703\u002Fstatic001.infoq.cn-resource-image-4d-f4-4d03e8e43a8edc3f32376d90e52b85f4.png.JPEG"},children:[]}]},{type:a,value:f},{type:b,tag:K,props:{id:av},children:[{type:b,tag:A,props:{href:"#%E6%BC%8F%E6%A1%B6%E7%AE%97%E6%B3%95",ariaHidden:L,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:av}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"将请求都放进大小有限的队列（桶）里面，然后以固定的速度从队列里取出请求进行处理（漏桶），如果队列慢了则触发限流。\n漏桶算法虽然控制了请求数和并发数，但是当一开始没有请求，然后突然有大量请求，却依然慢吞吞的固定速度取请求。\n导致一开始有的资源空闲着，有的请求在等待，降低了吞吐。"}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:T,props:{alt:J,"data-src":"http:\u002F\u002F123.207.79.108\u002Ffile\u002Ffile\u002Fblog\u002Fcode\u002F20200703\u002Fstatic001.infoq.cn-resource-image-75-03-75938d1010138ce66e38c6ed0392f103.png.JPEG"},children:[]}]},{type:a,value:f},{type:b,tag:K,props:{id:aw},children:[{type:b,tag:A,props:{href:"#%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95",ariaHidden:L,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:aw}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"令牌以固定的速度生成，放在大小有限的桶里，桶满了则令牌丢弃。每个请求都往桶里取令牌，取不到令牌则触发限流。\n令牌算法既能控制请求数量，由令牌的生成速度决定。\n又能承受突发的大量请求，这个由桶的大小决定，并且桶的大小决定了最大并发数。\n假设一开始没有请求，然后突然大量请求，桶里满的令牌一下子就被拿完了，达到最大并发数，并且触发了限流。"}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:T,props:{alt:J,"data-src":"http:\u002F\u002F123.207.79.108\u002Ffile\u002Ffile\u002Fblog\u002Fcode\u002F20200703\u002Fstatic001.infoq.cn-resource-image-ec-93-eca0e5eaa35dac938c673fecf2ec9a93.png.JPEG"},children:[]}]},{type:a,value:f},{type:b,tag:K,props:{id:ax},children:[{type:b,tag:A,props:{href:"#%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0",ariaHidden:L,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:ax}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"令牌桶算法是使用比较广泛的限流算法，可以使用redis的lua脚本实现。lua大致的思路是："}]},{type:a,value:f},{type:b,tag:"ul",props:{},children:[{type:a,value:f},{type:b,tag:P,props:{},children:[{type:a,value:"根据key获取令牌剩余数量和上次获取令牌时间"}]},{type:a,value:f},{type:b,tag:P,props:{},children:[{type:a,value:"如果是第一次获取令牌，默认桶满，令牌取一，更新获取时间，返回成功"}]},{type:a,value:f},{type:b,tag:P,props:{},children:[{type:a,value:"根据令牌剩余数量、令牌增长速度、上次获取令牌时间和当前时间，计算到现在令牌应该增长到的数量"}]},{type:a,value:f},{type:b,tag:P,props:{},children:[{type:a,value:"判断还有没有令牌可取，没有则返回失败"}]},{type:a,value:f},{type:b,tag:P,props:{},children:[{type:a,value:"有令牌则取一，更新获取时间，返回成功"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"具体的lua脚本这里先贴《分布式服务限流实战，已经为你排好坑了》和《基于redis的分布式限流方案》。\n这两个脚本感觉可以合并一下（待续）"}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"《分布式服务限流实战，已经为你排好坑了》"}]},{type:a,value:f},{type:b,tag:U,props:{className:[V]},children:[{type:b,tag:W,props:{className:[X,ay]},children:[{type:b,tag:Y,props:{},children:[{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" ratelimit_info "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"pcall"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"'HMGET'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" last_time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" ratelimit_info"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"ratelimit_info"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" max_token "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" token_rate "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" current_time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 生成每个令牌所需要的时间"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" reverse_time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"1000"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:"token_rate\n"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:E}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"=="}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aE}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:F}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" max_token\n  last_time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" current_time\n"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"else"}]},{type:a,value:"\n  "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" past_time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" current_time"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:aF},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" reverse_token "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"floor"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"past_time"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ae},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:G}]},{type:a,value:"reverse_token\n  "},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 注意这里需要对last_time进行修正"}]},{type:a,value:"\n  last_time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" reverse_time"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:a,value:"reverse_token"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:G}]},{type:a,value:aF},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:E}]},{type:a,value:ae},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:"max_token "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:F}]},{type:a,value:"\n    current_token "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" max_token\n  "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:H}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:H}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" result "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aa}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:F}]},{type:a,value:"\n  result "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ae},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:H}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"'HMSET'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 感觉设不设置过期时间都可以"}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"'pexpire'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"math"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"ceil"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"max_token"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"current_time"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ag}]},{type:a,value:" result\n"}]}]}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"《基于redis的分布式限流方案》"}]},{type:a,value:f},{type:b,tag:U,props:{className:[V]},children:[{type:b,tag:W,props:{className:[X,ay]},children:[{type:b,tag:Y,props:{},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- key"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" key "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" KEYS"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 最大存储的令牌数"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" max_permits "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 每秒钟产生的令牌数"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" permits_per_second "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 请求的令牌数"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 下次请求可以获取令牌的起始时间"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 当前时间"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" time "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"'time'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" now_micros "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:x}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aO}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:G}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 查询获取令牌是否超时"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:E}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"~="}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:F}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 获取令牌的超时时间"}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" timeout_micros "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" micros_to_wait "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:" now_micros\n    "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:E}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"micros_to_wait "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:" timeout_micros"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:F}]},{type:a,value:"\n        "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ag}]},{type:a,value:" micros_to_wait\n    "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:H}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:H}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 当前存储的令牌数"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 添加令牌的时间间隔"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" stable_interval_micros "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aO}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:" permits_per_second\n\n"},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 补充令牌"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:E}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aQ},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:F}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" new_permits "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aQ},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:" stable_interval_micros\n    stored_permits "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"max_permits"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:G}]},{type:a,value:" new_permits"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"\n    next_free_ticket_micros "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aT},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:H}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 消耗令牌"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" next_free_ticket_micros\n"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" stored_permits_to_spend "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"required_permits"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" stored_permits"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:";"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:" wait_micros "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:a,value:" stable_interval_micros\n\nredis"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"replicate_commands"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:G}]},{type:a,value:" wait_micros"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"'expire'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"10"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"-- 返回需要等待的时间长度"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ag}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:y}]},{type:a,value:aT}]}]}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"如果是acquire方法，执行下面，redis将返回获取请求成功后，线程需要等待的微秒数"}]},{type:a,value:f},{type:b,tag:U,props:{className:[V]},children:[{type:b,tag:W,props:{className:[X,aY]},children:[{type:b,tag:Y,props:{},children:[{type:a,value:"eval 'lua脚本' 3 '自定义的key' '最大存储的令牌数' '每秒钟产生的令牌数' '请求的令牌数'\n"}]}]}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"如果是tryAcquire方法，执行下面，redis同样返回需要等待的微秒数，将该返回值与最大等待微秒数做比较，如果redis返回的值较大，则说明失败；反之则是成功，并根据返回值让线程等待。"}]},{type:a,value:f},{type:b,tag:U,props:{className:[V]},children:[{type:b,tag:W,props:{className:[X,aY]},children:[{type:b,tag:Y,props:{},children:[{type:a,value:"eval 'lua脚本' 3 '自定义的key' '最大存储的令牌数' '每秒钟产生的令牌数' '请求的令牌数' '最大等待的微秒数'\n"}]}]}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:a,value:"参考文章："}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:A,props:{href:"https:\u002F\u002Fwww.infoq.cn\u002Farticle\u002FQg2tX8fyw5Vt-f3HH673",rel:[aj,ak,al],target:am},children:[{type:a,value:"分布式服务限流实战，已经为你排好坑了"}]}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:A,props:{href:"https:\u002F\u002Fblog.wangqi.love\u002Farticles\u002FJava\u002F%E9%99%90%E6%B5%81%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93.html",rel:[aj,ak,al],target:am},children:[{type:a,value:"限流技术总结"}]}]},{type:a,value:f},{type:b,tag:q,props:{},children:[{type:b,tag:A,props:{href:"https:\u002F\u002Fblog.wangqi.love\u002Farticles\u002FJava\u002F%E5%9F%BA%E4%BA%8Eredis%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%99%90%E6%B5%81%E6%96%B9%E6%A1%88.html",rel:[aj,ak,al],target:am},children:[{type:a,value:"基于redis的分布式限流方案"}]}]}]},excerpt:{type:as,children:[]},dir:aZ,path:"\u002F分布式\u002F20200703\u002F分布式限流",extension:".md",title:aq,url:"\u002Fblog-code\u002Fview\u002F$E5$88$86$E5$B8$83$E5$BC$8F\u002F20200703\u002F$E5$88$86$E5$B8$83$E5$BC$8F$E9$99$90$E6$B5$81\u002F",createAt:new Date(1593734400000),updateAt:new Date(1593734400000),attributes:[{name:"createAt",value:a_},{name:"updateAt",value:a_},{name:"sort",value:aZ,url:"\u002Fblog-code\u002Fpage\u002F$E5$88$86$E5$B8$83$E5$BC$8F\u002F20200703\u002F1\u002F"}]}}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation","\n","operator","keyword"," ","=","(",")","local","function","number",",","p","string","[","]","comment",".","tonumber","1","-","wide","a","call","2","ARGV","if","then","+","end","\n\n","","h1","true",-1,"icon","icon-link","li","KEYS","\nredis"," key","img","div","nuxt-content-highlight","pre","line-numbers","code","\u002F","*","\u003E","0","\n    ","\n  current_token "," math"," current_token","current_token","return"," next_free_ticket_micros "," stored_permits ","nofollow","noopener","noreferrer","_blank","无名の窝",10000,"青春猪头-牧之原翔子-江之岛","分布式限流","2020-07-03T00:00:00.000Z","root","固定窗口计数器","滑动窗口计数器","漏桶算法","令牌桶算法","令牌桶算法的实现","language-lua"," redis","'last_time'","'current_token'"," current_token ","3","nil","last_time\n  ","reverse_time","last_time"," required_permits ","redis","'hget'","'next_free_ticket_micros'","or","time","1000000","'stored_permits'","now_micros "," next_free_ticket_micros","min"," now_micros\n"," moment_available "," fresh_permits "," stored_permits_to_spend","'hset'","language-text","\u002F分布式\u002F20200703","2020-07-03")));