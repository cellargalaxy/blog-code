__NUXT_JSONP__("/archive/2022", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR){return {data:[{navbarConfig:{brandText:"无名の窝",brandUrl:"\u002Fblog-code\u002F",navs:[{text:"文章",url:ar},{text:"归档",url:"\u002Fblog-code\u002Farchive\u002F0\u002F"},{text:"画画",url:"\u002Fblog-code\u002Fhtml\u002Fhua.html"},{text:"开源",url:"\u002Fblog-code\u002Fhttps:\u002Fgithub.com\u002Fcellargalaxy\u002Fblog-vue"}]},homeConfig:{brandInterval:10000,brands:[{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F21\u002FmMEAnwY5XPC2pFb.jpg",title:"日常",texts:["我们所度过的每个平凡的日常，也许就是连续不断发生的奇迹。","日々、私たちが過ごしている日常は、実は奇跡の連続なのかもしれない。"]},{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F04\u002F19\u002FH1MmXb9xPcYEhT2.jpg",title:"昨日之歌",texts:["时间梭梭箭如飞，人道漫漫步蹒跚","人間そんな変わるもんじゃないのに、月日ばっかどんどん過ぎて"]}],navs:[{text:"Github",url:"https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002F"}]},pageFootConfig:{lines:[[{text:"Copyright © 2017-? ."},{text:"备案？不存在的"},{text:"Powered by Nuxt.js & Github"}]]},buildTime:new Date(1651154518466),currentPage:as,total:as,files:[{slug:at,description:"夜深，好困，长话短说。\n\nloki：存储查询日志的服务，对外提供一个http端口\npromtail：收集日志，把日志发生到loki里进行管理\ngrafana：可以通过loki的接口查询日志\n",createdAt:au,updatedAt:au,toc:[],body:{type:K,children:[{type:b,tag:l,props:{},children:[{type:a,value:av}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aw}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:ax}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:ay}]},{type:a,value:e}]},{type:a,value:e},{type:a,value:e},{type:b,tag:y,props:{id:az},children:[{type:b,tag:i,props:{href:"#%E9%A2%84%E5%A4%87%E5%B7%A5%E4%BD%9C",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:az}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"loki的http端口需要对外，但loki的http貌似没权限校验功能，所以用caddy反代置于，加个账号密码校验。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"caddy的配置，使用basicauth加上账号密码校验。admin就是账号，后面的是密码的hash base64。 这个hash base64需要使用caddy来生成，执行"},{type:b,tag:v,props:{},children:[{type:a,value:"caddy hash-password"}]},{type:a,value:"\n，输入两次密码，就能生成。"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,X]},children:[{type:b,tag:v,props:{},children:[{type:a,value:":80 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ah}]},{type:a,value:"\n  encode "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"gzip"}]},{type:a,value:" zstd\n  \n  route \u002Floki\u002F* "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ah}]},{type:a,value:"\n    uri strip_prefix \u002Floki\n    reverse_proxy "},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"127.0"}]},{type:a,value:".0.1:3100\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ai}]},{type:a,value:"\n    \n  basicauth \u002Floki\u002F* "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ah}]},{type:a,value:"\n    admin JDJhJDE0JEZDN1Q0ZjZwc2ZrbG1FODROdndmc09UZzRJWW41c2QyaFB0aUFnSUhwL3JZWVRob1FabWV1\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ai}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ai}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:y,props:{id:aA},children:[{type:b,tag:i,props:{href:"#grafana",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aA}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"grafana没啥要求的，docker直接安装就好"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,X]},children:[{type:b,tag:v,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Y}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Z}]},{type:a,value:" volume create grafana_data\n"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Y}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:Q}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  --name grafana "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:aB},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"3000"}]},{type:a,value:":3000 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  -v grafana_data:\u002Fvar\u002Flib\u002Fgrafana "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  grafana\u002Fgrafana\n"}]}]}]},{type:a,value:e},{type:b,tag:y,props:{id:aC},children:[{type:b,tag:i,props:{href:"#loki",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aC}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"配置文件，加了注释的可以按需改改，其余的都是官方默认配置。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"官方配置："},{type:b,tag:i,props:{href:aD,rel:[m,n,o],target:p},children:[{type:a,value:aD}]}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,aE]},children:[{type:b,tag:v,props:{},children:[{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"auth_enabled"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,am,_]},children:[{type:a,value:"false"}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:aH}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"9096"}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"common"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"path_prefix"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" \u002Ftmp\u002Floki\n  "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"storage"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"filesystem"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"chunks_directory"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" \u002Ftmp\u002Floki\u002Fchunks\n      "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"rules_directory"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" \u002Ftmp\u002Floki\u002Frules\n  "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"replication_factor"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"1"}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"ring"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"instance_addr"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" 127.0.0.1\n    "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"kvstore"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" inmemory\n\n"},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"schema_config"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"configs"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"from"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,"datetime",z]},children:[{type:a,value:"2020-10-24"}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" boltdb"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:"shipper\n      "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"object_store"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" filesystem\n      "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"schema"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" v11\n      "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"index"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"\n        "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"prefix"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" index_\n        "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"period"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" 24h\n\n"},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"ruler"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"alertmanager_url"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"\u002F\u002Flocalhost"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"9093"}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"limits_config"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"reject_old_samples"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,am,_]},children:[{type:a,value:q}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#是否拒绝旧样本"}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"reject_old_samples_max_age"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aL},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#30d,默认168h(7d),之前的样本被拒绝"}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"ingestion_rate_mb"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"32"}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#每用户每秒样本大小的摄取速率限制。单位为 MB"}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"max_entries_limit_per_query"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"10000"}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#默认5000,最大查询行数"}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"table_manager"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"retention_deletes_enabled"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,am,_]},children:[{type:a,value:q}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#开启删除"}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"retention_period"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aL},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#30d,默认744h(31d),超过的数据将被删除"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:aM}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,X]},children:[{type:b,tag:v,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Y}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:Q}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  --name loki "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:aB},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:aH}]},{type:a,value:":3100 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  -v \u002Fconfig:\u002Fconfig "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  grafana\u002Floki "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:Q}]},{type:a,value:"\u002Fconfig\u002Floki.yaml\n"}]}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"安装完之后可以进"},{type:b,tag:v,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:3100\u002Floki\u002Fready"}]},{type:a,value:"。一开始会线上要等等，还没ready。等个一会就会显示ready了。"}]},{type:a,value:e},{type:b,tag:y,props:{id:aO},children:[{type:b,tag:i,props:{href:"#promtail",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aO}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"配置文件，官方配置："},{type:b,tag:i,props:{href:aP,rel:[m,n,o],target:p},children:[{type:a,value:aP}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:"\u002Flog\u002F*log"}]},{type:a,value:"，promtail会抓取\u002Flog下面全面log结尾的文件"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"启动之后可以看看日志，如果发现请求loki被拒绝，报429，可能是promtail给loki一口气发送的日志过大。可以修改loki的速率限制配置。"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,aE]},children:[{type:b,tag:v,props:{},children:[{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"9080"}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"0"}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"positions"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"filename"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" \u002Ftmp\u002Fpositions.yaml\n\n"},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"client"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"url"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"\u002F\u002F127.0.0.1"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"3100\u002Floki\u002Fapi\u002Fv1\u002Fpush\n  "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"basic_auth"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"username"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" username\n    "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"password"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" password\n\n"},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"scrape_configs"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:x},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"job_name"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" log\n    "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"static_configs"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"targets"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:" localhost\n        "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aQ}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"job"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" log\n          "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"__path__"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" \u002Flog\u002F"},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:"**\u002F*.log"}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"pipeline_stages"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"regex"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,M]},children:[{type:a,value:"#https:\u002F\u002Fregex101.com\u002F"}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"expression"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,"string"]},children:[{type:a,value:"'(?P\u003Ctimestamp\u003E\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+\\d{2}:\\d{2}).+\\[(?P\u003Clevel\u003E[A-Z]{4})\\].+\\[logid:(?P\u003Clogid\u003E[0-9]+)\\].+\\[sn:(?P\u003Csn\u003E.+)\\].+\\[ip:(?P\u003Cip\u003E[0-9.]+)\\].+\\[caller:\"(?P\u003Ccaller\u003E.+)\"\\]'"}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:aQ}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"level"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"logid"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"sn"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"ip"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"caller"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"timestamp"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"source"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" timestamp\n          "},{type:b,tag:c,props:{className:[d,j,k]},children:[{type:a,value:"format"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" RFC3339\n"}]}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:aM}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"加有日志文件的文件夹挂载到容器内的\u002Flog里。"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,X]},children:[{type:b,tag:v,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Y}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:Z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:Q}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  --name promtail "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  -v log:\u002Flog "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  -v \u002Fconfig.yml:\u002Fconfig.yml "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:"\n  grafana\u002Fpromtail "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:w}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:Q}]},{type:a,value:"\u002Fconfig.yml\n"}]}]}]},{type:a,value:e},{type:b,tag:y,props:{id:aR},children:[{type:b,tag:i,props:{href:"#%E6%9F%A5%E8%AF%A2",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aR}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"在grafana的左边菜单里找到"},{type:b,tag:v,props:{},children:[{type:a,value:"Configuration"}]},{type:a,value:"，在配置里添加数据源。\n按理数据源的列表有loki可以选。URL填上"},{type:b,tag:v,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:3100\u002Floki"}]},{type:a,value:"。有账号密码就在"},{type:b,tag:v,props:{},children:[{type:a,value:"Basic auth"}]},{type:a,value:"里填一下。保存测试。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"左侧菜单里去到"},{type:b,tag:v,props:{},children:[{type:a,value:"Explore"}]},{type:a,value:"，点一下"},{type:b,tag:v,props:{},children:[{type:a,value:"Log browser"}]},{type:a,value:"，正常的话就有日志文件和任务名称可以选。\n所谓的任务名称，是promtail配置里的"},{type:b,tag:v,props:{},children:[{type:a,value:"scrape_configs.static_configs.labels.job"}]},{type:a,value:"那一项。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"查询logid："},{type:b,tag:v,props:{},children:[{type:a,value:"{job=\"log\"} |= \"211016031700537788\""}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:aS}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Finstallation\u002Fdocker\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"官方安装教程"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fjoelei.com\u002F2021\u002F06\u002Flightweight-log-system-loki-experience\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"轻量级的日志系统Loki体验"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fxiaosongs.com\u002Foperation\u002Floki\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"Loki 轻量级日志收集系统"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fwww.feiyiblog.com\u002F2021\u002F09\u002F16\u002F%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%ADLoki%E7%9A%84%E4%BC%98%E5%8C%96\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"生产环境中Loki的优化"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fwww.yoyoask.com\u002F?p=4436",rel:[m,n,o],target:p},children:[{type:a,value:"Loki、promtail、Grafana、Prometheus日志监控安装与配置"}]}]},{type:a,value:e}]}]},excerpt:{type:K,children:[{type:b,tag:l,props:{},children:[{type:a,value:av}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aw}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:ax}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:ay}]},{type:a,value:e}]}]},dir:aT,path:"\u002F折腾\u002F20220116\u002Fgrafana+loki+promtail搭建轻量日志系统",extension:T,title:at,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220116\u002Fgrafana+loki+promtail搭建轻量日志系统",createAt:new Date(1642291200000),updateAt:new Date(1642291200000),attributes:[{name:U,value:aU},{name:V,value:aU},{name:W,value:aT,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220116\u002F1\u002F"}]},{slug:aV,description:an,createdAt:"2022-03-04T00:00:00.000Z",updatedAt:"2022-03-07T00:00:00.000Z",toc:[{id:aW,depth:H,text:aX},{id:$,depth:H,text:$},{id:aY,depth:H,text:aZ},{id:a_,depth:3,text:a$},{id:aa,depth:H,text:aa},{id:ab,depth:H,text:ab},{id:ba,depth:H,text:bb}],body:{type:K,children:[{type:b,tag:l,props:{},children:[{type:a,value:an}]},{type:a,value:e},{type:a,value:e},{type:b,tag:y,props:{id:"lsm树的实现"},children:[{type:b,tag:i,props:{href:"#lsm%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:"LSM树的实现"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"RocksDB的LSM树的存储结构有三种：WAL+mentable+SSTable"}]},{type:a,value:e},{type:b,tag:I,props:{id:aW},children:[{type:b,tag:i,props:{href:"#wal",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aX}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"WAL(write-ahead log)(预写式日志)，WAL本质是一个追加写入的硬盘文件，是数据库技术中实现事务的一种标准方法，可以实现单机事务的原子性和持久性，同时提高写入的性能。\n在修改数据时为了实现事务的原子性和持久性，并不会直接修改数据文件，因为一个事务中可能会随机修改多个字段，导致需要修改数据文件的位置也是随机的。\n一是随机IO会影响性能，二是多次的随机IO写入显然无法保证原子性。\n而使用WAL的话，并不会直接去修改数据文件，而是把数据修改的情况都写入WAL里。往WAL里写入的类型有两种，redo执行写操作，undo回滚写操作。\n接下来可能会有五种情况："}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"往WAL写入redo前崩溃了，重启后WAL并没有相关日志：事务无执行，数据文件无影响"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"往WAL写入redo时崩溃了，重启后WAL的日志并不完整：事务取消执行，数据文件无影响"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"往WAL写入redo后崩溃了，重启后WAL的日志写入完整：从WAL中读出所需修改的数据，修改数据文件"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"修改数据文件时崩溃了：从WAL中读出所需修改的数据，继续修改数据文件"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"修改数据文件无法进行：往WAL里写入undo，回滚写操作，事务执行失败"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"使用WAL支持并发读读和读写，由于都是追加写入，不支持并发写写。\n如果需要读最新的数据，则需要往WAL里查询。如果WAL没查到，那数据文件里的就是最新的数据。\n需要注意，写入WAL与修改数据文件并不一定是同步的。往往会合并WAL多个写操作，批量刷入硬盘里。"}]},{type:a,value:e},{type:b,tag:I,props:{id:$},children:[{type:b,tag:i,props:{href:"#mentable",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"mentable是RocksDB的内存数据结构，使用跳表实现，分为active memtable和immutable memtable两种。\nRocksDB在写入WAL之后，会把数据写到active mentable里。\n如果active mentable被写满，会新建一个active mentable，旧的会变成immutable memtable，等待被异步刷入硬盘里。"}]},{type:a,value:e},{type:b,tag:I,props:{id:aY},children:[{type:b,tag:i,props:{href:"#sstable",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aZ}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"SSTable，SST文件，全称Sorted String Table，是持久化的，不可改的，有序的数据文件。\nSSTable的文件分为多个区域，内部有索引信息能加快数据查询速度。\nmentable被刷到硬盘里的数据去向就是生成SSTable。\nSST文件都属于某一个层，从L0到Ln，层级越小，数据越新。新生成的SST文件首先会在L0层，但每一层的SST文件数量会有限制。在一定的条件下，会对SST文件进行合并。"}]},{type:a,value:e},{type:b,tag:"h3",props:{id:a_},children:[{type:b,tag:i,props:{href:"#compaction",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:a$}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"由于RocksDB通过增量写写入mentable，而SST文件数据来源于mentable，所以SST文件的数据的冗余的。\n为了减少冗余，会对SST文件进行合并，删除重复或者过期的key。\n而RocksDB默认是使用Level Style Compaction作为合并策略。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"首先L0的SST文件是从mentable生成的，所以L0的SST文件直接会有重复的key。\n当进行合并时，会选择Ln层的一个文件，与Ln+1的多个文件进行合并，合并相同的key，删除失效key。\n合并后，每一层的SST文件直接都是有顺序的。"}]},{type:a,value:e},{type:b,tag:I,props:{id:aa},children:[{type:b,tag:i,props:{href:"#%E8%AF%BB%E6%93%8D%E4%BD%9C",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aa}]},{type:a,value:e},{type:b,tag:N,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在active mentable里查询"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在immutable memtable里查询"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在L0里查询。由于L0可能有重复key，所以才有遍历查询"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在Ln里查询，由于Ln没有重复key，所以使用二分法查询"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"如果到Lmax都还查不到，那就是查不到"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:I,props:{id:ab},children:[{type:b,tag:i,props:{href:"#%E5%86%99%E6%93%8D%E4%BD%9C",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:ab}]},{type:a,value:e},{type:b,tag:N,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"数据写入active mentable"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"active mentable到达一定大小，会转变成immutable memtable，创建新的active mentable继续提供读写"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"满足一定会把immutable memtable刷为硬盘的SST文件。先写入系统缓存页，再异步写入硬盘，考虑到系统奔溃丢缓存页可能性较低，异步写还是可靠的"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:I,props:{id:ba},children:[{type:b,tag:i,props:{href:"#column-family",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:bb}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"kv存储时需要指定列族(Column Family)，且允许创建多个列族。列族直接使用不同的mentable和SST文件，但是公用一个WAL。\n好处是可以对不同列族的mentable和SST进行不同的配置，提高读写性能。"}]},{type:a,value:e},{type:b,tag:y,props:{id:"lsm树总结"},children:[{type:b,tag:i,props:{href:"#lsm%E6%A0%91%E6%80%BB%E7%BB%93",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:"LSM树总结"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"相比于B+树来说，要在B+树写入随机的数据，写入的节点位置是随机的，随机写入影响着B+树的写入性能。\n而LSM树通过使用WAL，mentable和SST文件，将随机写转换为顺序写，大大提高了写入的性能。\n但顺序写的所带来的代价的空间放大，写放大和读放大。"}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"由于SST文件的冗余性，存储空间被放大"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"同样由于冗余性而需要进行合并，每次合并都进行一次写操作，实际是把每次只需写入一次的数据放大操作了多次写"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"LSM树读取数据需要分层读取多次，读取次数的放大会影响读性能"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"空间放大，写放大和读放大三种需要平衡，RocksDB提供了许多配置来进行微调设置。\n跟B+树相比，B+树对事物支持更好，因为B+树能原地更新数据，并且数据只有一份。而LSM树的key在L0里会重复，只有在进行合并的时候才算完成事物。\nLSM树支持O(1)的写，O(n)的读。而B+树的读写都是O(logN)。通常来说，LSM树的写性能由于B+树，B+树的读性能优于LSM树。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:aS}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fsegmentfault.com\u002Fa\u002F1190000041198407",rel:[m,n,o],target:p},children:[{type:a,value:"从 RocksDB 看 LSM-Tree 算法设计"}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fflynx.dev\u002Frocksdb\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"一个项目的诞生(三)：RocksDB的价值"}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Flessisbetter.site\u002F2020\u002F01\u002F02\u002Fwal-introduction\u002F",rel:[m,n,o],target:p},children:[{type:a,value:"WAL(预写式日志)简介"}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:"https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1623123",rel:[m,n,o],target:p},children:[{type:a,value:"你常听说的WAL到底是什么"}]}]}]},excerpt:{type:K,children:[{type:b,tag:l,props:{},children:[{type:a,value:an}]}]},dir:bc,path:"\u002F中间件\u002F20220304\u002FRocksDB初步了解",extension:T,title:aV,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20220304\u002FRocksDB初步了解",createAt:new Date(1646352000000),updateAt:new Date(1646611200000),attributes:[{name:U,value:"2022-03-04"},{name:V,value:"2022-03-07"},{name:W,value:bc,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20220304\u002F1\u002F"}]},{slug:bd,toc:[],body:{type:K,children:[{type:b,tag:l,props:{},children:[{type:a,value:"这是关于关于我的页面，一名底层搬砖的程序猿。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"希望有一个自己喜欢的，漂漂亮亮的地方来记录各种东西，所以写了这个博客。当然你可能是在GitHub里看见这句话的，那欢迎光临"},{type:b,tag:i,props:{href:be,rel:[m,n,o],target:p},children:[{type:a,value:be}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"不知道写些什么好，就先到这里为止吧。"}]}]},dir:bf,path:"\u002FREADME",extension:T,createdAt:bg,updatedAt:bg,excerpt:ac,title:bd,url:"\u002Fblog-code\u002Fview\u002FREADME",createAt:new Date(1651154423695),updateAt:new Date(1651154423695),attributes:[{name:U,value:O},{name:V,value:O},{name:W,value:bf,url:ar}]},{slug:bh,toc:[],body:{type:K,children:[{type:b,tag:y,props:{id:"oltp"},children:[{type:b,tag:i,props:{href:"#oltp",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:"OLTP"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"Online Transactional Processing，事务型数据库。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"要求实时处理，响应速度快，保证事务的ACID。实际场景中，多会操作少数几行的多列数据，因此适用于行式存储。"}]},{type:a,value:e},{type:b,tag:y,props:{id:"olap"},children:[{type:b,tag:i,props:{href:"#olap",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:"OLAP"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"Online analytical processing：分析型数据库。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"对查询速度要求不高，查询也并不频繁，操作多是查询，对修改需求不高。实际场景中，多会查询少数几列的多行数据，因此适用于列式存储。"}]},{type:a,value:e},{type:b,tag:y,props:{id:"htap"},children:[{type:b,tag:i,props:{href:"#htap",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:"HTAP"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"Hybrid Transactional\u002FAnalytical Processing：混合型数据库。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"既能支持实时事务特性，也支持大量数据查询分析的性能，一般由三种实现方式。"}]},{type:a,value:e},{type:b,tag:N,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在应用层对OLTP和OLAP系统进行松耦合，OLTP和OLAP共享一份数据，通过ETL将OLTP的数据同步到OLAP，整体对外表现为HTAP。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在数据库层分别使用行存储引擎和列存储引擎，分别负责OLTP和OLAP的功能。存储在物理上隔离，使用一定的协议进行数据同步。是主流的实现方案。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"使用但一次存储引擎，同时实现OLTP和OLAP。但无论是单使用行存储还是列存储，性能都无法达到较优。"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:bi}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:bj,rel:[m,n,o],target:p},children:[{type:a,value:bj}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:bk,rel:[m,n,o],target:p},children:[{type:a,value:bk}]}]},{type:a,value:e}]},{type:a,value:e}]}]},dir:bl,path:"\u002F中间件\u002F20220428\u002FOLTP、OLAP与HTAP",extension:T,createdAt:bm,updatedAt:bm,excerpt:ac,title:bh,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20220428\u002FOLTP、OLAP与HTAP",createAt:new Date(1651154423699),updateAt:new Date(1651154423699),attributes:[{name:U,value:O},{name:V,value:O},{name:W,value:bl,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20220428\u002F1\u002F"}]},{slug:bn,toc:[{id:ad,depth:H,text:ad},{id:ae,depth:H,text:ae},{id:af,depth:H,text:af}],body:{type:K,children:[{type:b,tag:y,props:{id:bo},children:[{type:b,tag:i,props:{href:"#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:bo}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"twrp刷入并不成功，目前不晓得啥原因。 但由于没有太需要twrp，所以就先放弃了。 可以直接调到刷rom那步。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"我下载的都是最新的"}]},{type:a,value:e},{type:b,tag:I,props:{id:ad},children:[{type:b,tag:i,props:{href:"#rom%E4%B8%8B%E8%BD%BD",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:ad}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"最新的版本貌似永远停留在2020年十二月了。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:bp,rel:[m,n,o],target:p},children:[{type:a,value:bp}]}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:v,props:{},children:[{type:a,value:"taimen-rp1a.201005.004.a1-factory-2f5c4987.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:I,props:{id:ae},children:[{type:b,tag:i,props:{href:"#%E4%B8%8B%E8%BD%BDtwrp",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:ae}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"twrp起码到2022三月还有更新。"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:bq,rel:[m,n,o],target:p},children:[{type:a,value:bq}]}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:v,props:{},children:[{type:a,value:"twrp-3.6.1_9-0-taimen.img\ntwrp-installer-3.6.1_9-0-taimen.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:I,props:{id:af},children:[{type:b,tag:i,props:{href:"#%E4%B8%8B%E8%BD%BDfastboot",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:af}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"ubuntu安装安卓的fastboot，在安装ROM时提示版本太低，还是去官网下载了个新的"}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:b,tag:i,props:{href:br,rel:[m,n,o],target:p},children:[{type:a,value:br}]}]},{type:a,value:e},{type:b,tag:y,props:{id:bs},children:[{type:b,tag:i,props:{href:"#%E8%A7%A3%E9%94%81",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:bs}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"待补充。我买到手已经是解锁了的，所以没操作"}]},{type:a,value:e},{type:b,tag:y,props:{id:bt},children:[{type:b,tag:i,props:{href:"#%E6%AD%A5%E9%AA%A4",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:bt}]},{type:a,value:e},{type:b,tag:N,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:ap}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:bu}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aq}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:y,props:{id:ap},children:[{type:b,tag:i,props:{href:"#%E5%88%B7%E5%85%A5%E4%B8%B4%E6%97%B6twrp",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:ap}]},{type:a,value:e},{type:b,tag:N,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:"adb devices"}]},{type:a,value:"查看设备列表"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"关机后同时按开机键和音量下键\u002F"},{type:b,tag:v,props:{},children:[{type:a,value:"adb reboot bootloader"}]},{type:a,value:"进入bootloader模式"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:bv}]},{type:a,value:bw}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:"fastboot boot twrp-3.6.1_9-0-taimen.img"}]},{type:a,value:"刷入"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:y,props:{id:"刷入rom"},children:[{type:b,tag:i,props:{href:"#%E5%88%B7%E5%85%A5rom",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:bu}]},{type:a,value:e},{type:b,tag:N,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"解压fastboot工具和rom"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"将解压出来的fastboot文件夹里的全部文件拷贝一份到rom的文件夹里"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"得把fastboot文件夹里全部文件都拷贝，会依赖到文件夹里其他文件，不然刷到中途会失败"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"修改一下"},{type:b,tag:v,props:{},children:[{type:a,value:bx}]},{type:a,value:"，改成使用当前路径的fastboot"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"手机进入fastboot模式"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:bv}]},{type:a,value:bw}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"直接"},{type:b,tag:v,props:{},children:[{type:a,value:bx}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:y,props:{id:aq},children:[{type:b,tag:i,props:{href:"#%E5%88%B7%E5%85%A5%E6%B0%B8%E4%B9%85twrp",ariaHidden:q,tabIndex:s},children:[{type:b,tag:c,props:{className:[t,u]},children:[]}]},{type:a,value:aq}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"选择高级 \u003E sideload进入sideload"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:v,props:{},children:[{type:a,value:"adb sideload twrp-installer-3.6.1_9-0-taimen.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:bi}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:by,rel:[m,n,o],target:p},children:[{type:a,value:by}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bz,rel:[m,n,o],target:p},children:[{type:a,value:bz}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bA,rel:[m,n,o],target:p},children:[{type:a,value:bA}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bB,rel:[m,n,o],target:p},children:[{type:a,value:bB}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:ag,rel:[m,n,o],target:p},children:[{type:a,value:ag}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:ag,rel:[m,n,o],target:p},children:[{type:a,value:ag}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bC,rel:[m,n,o],target:p},children:[{type:a,value:bC}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bD,rel:[m,n,o],target:p},children:[{type:a,value:bD}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"电信破解相关的"}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bE,rel:[m,n,o],target:p},children:[{type:a,value:bE}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bF,rel:[m,n,o],target:p},children:[{type:a,value:bF}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bG,rel:[m,n,o],target:p},children:[{type:a,value:bG}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bH,rel:[m,n,o],target:p},children:[{type:a,value:bH}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bI,rel:[m,n,o],target:p},children:[{type:a,value:bI}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bJ,rel:[m,n,o],target:p},children:[{type:a,value:bJ}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"无需root电信破解"}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bK,rel:[m,n,o],target:p},children:[{type:a,value:bK}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{},children:[{type:a,value:"一代的"}]},{type:a,value:e},{type:b,tag:A,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bL,rel:[m,n,o],target:p},children:[{type:a,value:bL}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bM,rel:[m,n,o],target:p},children:[{type:a,value:bM}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bN,rel:[m,n,o],target:p},children:[{type:a,value:bN}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bO,rel:[m,n,o],target:p},children:[{type:a,value:bO}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:i,props:{href:bP,rel:[m,n,o],target:p},children:[{type:a,value:bP}]}]},{type:a,value:e}]}]},dir:bQ,path:"\u002F折腾\u002F20220425\u002FPixel2xl刷机手记",extension:T,createdAt:bR,updatedAt:bR,excerpt:ac,title:bn,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220425\u002FPixel2xl刷机手记",createAt:new Date(1651154423703),updateAt:new Date(1651154423703),attributes:[{name:U,value:O},{name:V,value:O},{name:W,value:bQ,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220425\u002F1\u002F"}]}]}],fetch:{},mutations:ac}}("text","element","span","token","\n","punctuation",":","li","a","key","atrule","p","nofollow","noopener","noreferrer","_blank","true"," ",-1,"icon","icon-link","code","\\","\n  ","h1","number","ul","div","nuxt-content-highlight","pre","line-numbers","function","\n          ",2,"h2","-","root","\n      ","comment","ol","2022-04-28","operator","=","\n\n","\n    ",".md","createAt","updateAt","sort","language-shell","sudo","docker","important","mentable","读操作","写操作",void 0,"rom下载","下载twrp","下载fastboot","https:\u002F\u002Fblog.csdn.net\u002Fweixin_45472158\u002Farticle\u002Fdetails\u002F108441357","{","}"," run -d ","\n  --restart","always ","boolean","RocksDB是一个嵌入式的KV数据库，由Facebook基于levelDB开发。\n多数情况下，看一把RocksDB看做是一个在本地的，数据落盘的，大数据量的Redis，且访问性能高于远端的Redis。\nRocksDB底层使用LSM树实现，但LSM树实际上并不是一棵具体的树，其实是一套存储处理算法。\nLSM树对KV的持久化，保持较高性能的读的基础上，实现了追加写，提供了写入的性能。","language-text","刷入临时twrp","刷入永久twrp","\u002Fblog-code\u002Fpage\u002F1\u002F",2022,"grafana+loki+promtail搭建轻量日志系统","2022-01-16T00:00:00.000Z","夜深，好困，长话短说。","loki：存储查询日志的服务，对外提供一个http端口","promtail：收集日志，把日志发生到loki里进行管理","grafana：可以通过loki的接口查询日志","预备工作","grafana","\n  -p ","loki","https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Fconfiguration\u002F","language-yaml","server","http_listen_port","3100","grpc_listen_port","store"," http"," 720h ","安装","\n  -config.file","promtail","https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Fclients\u002Fpromtail\u002Fconfiguration\u002F","labels","查询","参考文章","\u002F折腾\u002F20220116","2022-01-16","RocksDB初步了解","wal","WAL","sstable","SSTable","compaction","Compaction","column-family","Column Family","\u002F中间件\u002F20220304","README","https:\u002F\u002Fcode.cellargalaxy.top\u002F","\u002F","2022-04-28T14:00:23.695Z","OLTP、OLAP与HTAP","参考文献","https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1706006","https:\u002F\u002Fblog.51cto.com\u002Fkymdidicom\u002F3145671","\u002F中间件\u002F20220428","2022-04-28T14:00:23.699Z","Pixel2xl刷机手记","前期准备","https:\u002F\u002Fdevelopers.google.com\u002Fandroid\u002Fimages#taimen","https:\u002F\u002Ftwrp.me\u002Fgoogle\u002Fgooglepixel2xl.html","https:\u002F\u002Fdeveloper.android.com\u002Fstudio\u002Freleases\u002Fplatform-tools","解锁","步骤","刷入ROM","fastboot devices","检查设备列表","flash-all.sh","https:\u002F\u002Freallysnow.moe\u002Farchives\u002F244.html","https:\u002F\u002Flemisky.github.io\u002F2020\u002F11\u002F30\u002FPixel-XL-%E5%88%B7%E6%9C%BA%E7%9B%B8%E5%85%B3\u002F","https:\u002F\u002Fwww.jianshu.com\u002Fp\u002F4017e9d6541c","https:\u002F\u002Fwww.itfanr.cc\u002F2018\u002F10\u002F16\u002Fgoogle-pixel-unlock-bl-and-root\u002F","https:\u002F\u002Fblog.csdn.net\u002Fachirandliu\u002Farticle\u002Fdetails\u002F105028423","https:\u002F\u002Fceshidao.com\u002Fhow-to-get-magisk-working-on-pixel-2-xl\u002F","https:\u002F\u002Fsandyfffeng.com\u002F2020\u002F05\u002F24\u002Fgoogle-pixel-2-%E7%A0%B4%E8%A7%A3%E7%94%B5%E4%BF%A14g-%E5%85%A8%E6%95%99%E7%A8%8B%EF%BC%88mac-windows-%E9%80%9A%E7%94%A8%EF%BC%89\u002F","https:\u002F\u002Fblog.isteed.cc\u002Fpost\u002F4291184207\u002F","https:\u002F\u002Fgist.github.com\u002Fcoeusite\u002F86f6318c13c5bc15aef13345f1bb3ed4","https:\u002F\u002Fwww.jianshu.com\u002Fp\u002F075ed256a85d","https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F395935","https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F598302","https:\u002F\u002Fandroid.poppur.com\u002Fjiaocheng\u002F10416.html","https:\u002F\u002Fwww.berlinchan.com\u002F2019\u002F09\u002Fupdate-android-10-and-flash-modem-for-china-telecom-4g","https:\u002F\u002Fwww.somedoc.net\u002F?p=4263","http:\u002F\u002Fwww.gandalf.site\u002F2018\u002F11\u002Fgoogle-pixel-4g.html","https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F429528","https:\u002F\u002Fericclose.github.io\u002FPixel-modem-mod-for-China-Telecom.html","\u002F折腾\u002F20220425","2022-04-28T14:00:23.703Z")));