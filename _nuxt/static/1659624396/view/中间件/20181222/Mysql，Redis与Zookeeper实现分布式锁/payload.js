__NUXT_JSONP__("/view/%E4%B8%AD%E9%97%B4%E4%BB%B6/20181222/Mysql%EF%BC%8CRedis%E4%B8%8EZookeeper%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB){return {data:[{siteConfig:{siteName:aE,siteHost:"https:\u002F\u002Fcellargalaxy.github.io",basePath:"\u002Fblog-code\u002F",navs:[{text:"文章",url:"\u002Fblog-code\u002Fpage\u002F1\u002F"},{text:"归档",url:"\u002Fblog-code\u002Farchive\u002F0\u002F"},{text:"画画",url:"\u002Fblog-code\u002Fhtml\u002Fhua.html"},{text:"开源",url:"\u002Fblog-code\u002Fhttps:\u002Fgithub.com\u002Fcellargalaxy\u002Fblog-vue"}],pageSize:10,urlReplace:{"^/file/blog/code":"https:\u002F\u002Foracleamd1.dynv6.net\u002Ffile\u002Ffile\u002Fblog\u002Fcode"},backgroundImage:{duration:aF,fade:1000,images:[{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FcofTzDQXitjeVZ6.jpg",description:aG,type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FsfaRJ2lVeM3NDbE.jpg",description:aG,type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F26\u002FKybiTdftam5Su7x.jpg",description:"青春猪头-双葉理央",type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F09\u002F08\u002FxdX73nfs24qgOYk.jpg",description:"京吹-明日香,久美子",type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F14\u002FMAiruNcEFW2HYtg.jpg",description:"终将成为你-七海灯子,小糸侑",type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F05\u002FEojdAxTDJsFpbPw.jpg",description:"玉子市场-北白川玉子",type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F31\u002FAXxwJDRS9fmN2uU.jpg",description:"fate_hf-弓道馆",type:G},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F01\u002FaHhVObpJus6dnM4.jpg",description:"fate_hf-樱花树",type:G}]}},homeConfig:{brandInterval:aF,brands:[{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F21\u002FmMEAnwY5XPC2pFb.jpg",title:"日常",texts:["我们所度过的每个平凡的日常，也许就是连续不断发生的奇迹。","日々、私たちが過ごしている日常は、実は奇跡の連続なのかもしれない。"]},{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F04\u002F19\u002FH1MmXb9xPcYEhT2.jpg",title:"昨日之歌",texts:["时间梭梭箭如飞，人道漫漫步蹒跚","人間そんな変わるもんじゃないのに、月日ばっかどんどん過ぎて"]}],navs:[{text:"Github",url:"https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002F"}]},pageFootConfig:{lines:[[{text:"Copyright © 2017-? ."},{text:"备案？不存在的"},{text:"Powered by Nuxt.js & Github"}]]},buildTime:new Date(1659624404642),siteName:aE,file:{slug:aH,description:"",createdAt:aI,updatedAt:aI,toc:[{id:aJ,depth:aK,text:aL},{id:aM,depth:aK,text:aN}],body:{type:aO,children:[{type:a,value:h},{type:b,tag:ao,props:{id:"mysql分布式锁"},children:[{type:b,tag:x,props:{href:"#mysql%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81",ariaHidden:H,tabIndex:X},children:[{type:b,tag:c,props:{className:[Y,Z]},children:[]}]},{type:a,value:"Mysql分布式锁"}]},{type:a,value:h},{type:b,tag:aP,props:{id:aJ},children:[{type:b,tag:x,props:{href:"#mysql%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81",ariaHidden:H,tabIndex:X},children:[{type:b,tag:c,props:{className:[Y,Z]},children:[]}]},{type:a,value:aL}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"互斥性：需要自己在表中增加一列值，为此锁的版本号。并利用Mysql事务的级别（读已提交）确保校验版本号，修改锁状态来实现"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:aQ}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"不会发生死锁：需要自己在表中增加一列值，为此锁的过期时间"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:aR}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"使用InnoDB，假设表有三列：主键id、版本号version，用来标志当前锁的版本、锁状态status，例如0表示未锁，1表示已锁"}]},{type:a,value:h},{type:b,tag:aa,props:{className:[ab]},children:[{type:b,tag:ac,props:{className:[ad,aS]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F获取旧的状态与版本号"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aT}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:"version "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aU}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:af}]},{type:a,value:aq},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F当旧的状态为0，就可以尝试获取锁了，把status设置为1"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F但是要检查更新时的版本号依然是获取数据时的版本号"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F如果仍然是旧的版本，说明在这段时间里没有线程获取了锁，修改成功并版本号+1。否则失败，非阻塞返回"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"+"}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:af}]},{type:a,value:" version"},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"#{version} and id=1"}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:aP,props:{id:aM},children:[{type:b,tag:x,props:{href:"#mysql%E7%9A%84%E6%82%B2%E8%A7%82%E9%94%81",ariaHidden:H,tabIndex:X},children:[{type:b,tag:c,props:{className:[Y,Z]},children:[]}]},{type:a,value:aN}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"互斥性：需在select语句后面加上"},{type:b,tag:w,props:{},children:[{type:a,value:aX}]},{type:a,value:"，如果已经有其他线程"},{type:b,tag:w,props:{},children:[{type:a,value:aX}]},{type:a,value:"同样的数据，select操作就会被阻塞"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:aQ}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"不会发生死锁：如果加锁线程不释放锁是没有办法的。但是如果加锁线程挂了，连接断了，Mysql倒是会自动释放锁"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:aR}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"同样使用InnoDB，但select需要在事务内部。如果阻塞时间过长，jdbc一般会报异常而返回，实际上又不可以无限制等待下去，依然需要自己去实现重试。"}]},{type:a,value:h},{type:b,tag:aa,props:{className:[ab]},children:[{type:b,tag:ac,props:{className:[ad,aS]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"#以免事务自动提交"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:F}]},{type:a,value:" autocommit "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:aY}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aZ}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"work"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"start"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"transaction"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"三者选一就可以"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F如果成功执行这句，就获取了锁了"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aT}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"*"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aU}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:af}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"for"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F获取了锁之后就能进行业务操作了"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"2"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:af}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F提交事务后释放锁"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"commit"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"缺点："}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"最大的问题是这里使用InnoDB一般是想利用InnoDB的行锁来提高并发，这就要求select语句的where需要走索引。但由于Mysql的内部优化，小表可能会全表扫描比走索引快，而实际使用的是表锁。行锁不一定靠谱，并发性能不稳定。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"数据库嘛，资源消耗大，性能一般般"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:ao,props:{id:"redis分布式锁"},children:[{type:b,tag:x,props:{href:"#redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81",ariaHidden:H,tabIndex:X},children:[{type:b,tag:c,props:{className:[Y,Z]},children:[]}]},{type:a,value:"Redis分布式锁"}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"互斥性：利用redis操作的原子性来实现"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"解铃还须系铃人：value的值为唯一标志线程的id，以此标示锁的所有者"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"不会发生死锁：利用redis的过期功能实现。即使加锁线程没有释放锁，锁依然能够通过自动过期的方式释放掉"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"具有容错性：下面只是一个单点redis的例子"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:aa,props:{className:[ab]},children:[{type:b,tag:ac,props:{className:[ad,"language-java"]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,"doc-comment",p]},children:[{type:a,value:"\u002F**\n * "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"@author"}]},{type:a,value:" cellargalaxy\n * "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"@time"}]},{type:a,value:" 18-12-22\n *\u002F"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,a$,e]},children:[{type:a,value:"@Service"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"class"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:ba}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F加锁操作成功返回的字符串"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:S}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:at}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:a,value:" LOCK_SUCCESS "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"\"OK\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F释放锁的Lua脚本，下面会解释这东西"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:S}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:at}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:a,value:" UN_LOCK_SCRIPT "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"\"if redis.call('get', KEYS[1]) ~= ARGV[1] then return 1 else return redis.call('del', KEYS[1]) end\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F加锁操作成功返回的long"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:S}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:at}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"Long"}]},{type:a,value:" RELEASE_SUCCESS "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"1L"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F每一个服务实例的每一个线程都有一个唯一的id"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:S}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,au]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aw}]}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bb}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,au]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aw}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F当前线程是否已经获取了锁，默认为false"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:S}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,au]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"Boolean"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aw}]}]},{type:a,value:" hasLock "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"withInitial"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"-\u003E"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:S}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bc}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,a$,e]},children:[{type:a,value:"@Autowired"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:ba}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bc}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"this"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:"jedisPool "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"tryLock"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"int"}]},{type:a,value:" expireTime"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ay}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:be}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bf}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002FSetParams是除了key-value，redis操作的其他参数"}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002Fnx意思的SET IF NOT EXIST，即key不存在才操作"}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002Fpx是如果进行操作，这个key的过期时间"}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bi}]},{type:a,value:" setParams "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bb}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bi}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"nx"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"px"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"expireTime"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F虽然这里检查了key是否存在，设置了value以及过期时间三个操作"}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F但是这里调用了一次set方法，redis保证这三个操作的原子性"}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aD},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:aq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:" setParams"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"LOCK_SUCCESS"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:bl}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bm},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"unLock"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ay}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:be}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bf}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"\u002F\u002F这里让redis执行Lua脚本，redis也保证Lua脚本的执行的原子性"}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"Object"}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:r}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"eval"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"UN_LOCK_SCRIPT"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bp}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aD},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bp}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"RELEASE_SUCCESS"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:bl}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bm},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:O}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"getId"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:s},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ay}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:aq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:R}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"hasLock"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:" hasLock"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:A}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"获取锁的解释在代码的注释里了，需要继续解释的是释放锁的那个脚本。"},{type:b,tag:w,props:{},children:[{type:a,value:"KEYS[1]"}]},{type:a,value:"就是"},{type:b,tag:w,props:{},children:[{type:a,value:aD}]},{type:a,value:"，"},{type:b,tag:w,props:{},children:[{type:a,value:"ARGV[1]"}]},{type:a,value:"是"},{type:b,tag:w,props:{},children:[{type:a,value:"id.get()"}]},{type:a,value:"。脚本意思显然是，如果加锁线程不是自己，则自己的锁就一定被释放了。否则返回删除key的结果。这是我参考"},{type:b,tag:x,props:{href:br,rel:[I,J,K],target:L},children:[{type:a,value:bs}]},{type:a,value:"改来的，他的脚本我觉得有问题。问题在于如果锁是因为过期而释放的，但对于调用这个方法的线程来说，锁确实是释放成功了，毕竟他已经不持有锁了。但是redis.call('get', KEYS[1]) == ARGV[1]却为false了，返回的是释放失败。"}]},{type:a,value:h},{type:b,tag:aa,props:{className:[ab]},children:[{type:b,tag:ac,props:{className:[ad,"language-lua"]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:bt}]},{type:a,value:"我的脚本\n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"~="}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:V}]},{type:a,value:W},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bw}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:a,value:W},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bx}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:by}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:W},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bz}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:bt}]},{type:a,value:"importnew的脚本\n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aj}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:V}]},{type:a,value:W},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bw}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:by}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:W},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bx}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:aY}]},{type:a,value:W},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bz}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:ao,props:{id:"zookeeper分布式锁"},children:[{type:b,tag:x,props:{href:"#zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81",ariaHidden:H,tabIndex:X},children:[{type:b,tag:c,props:{className:[Y,Z]},children:[]}]},{type:a,value:"Zookeeper分布式锁"}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"使用Zookeeper实现分布式锁需要利用Zookeeper的三个特性："}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"有序节点：如果创建一个"},{type:b,tag:w,props:{},children:[{type:a,value:"\u002Flock\u002Fnode-"}]},{type:a,value:"的有序节点，Zookeeper会根据"},{type:b,tag:w,props:{},children:[{type:a,value:"\u002Flock"}]},{type:a,value:"下的子节点数量，给新创建的有序节点添加一个编号，实际生成的节点变成"},{type:b,tag:w,props:{},children:[{type:a,value:"\u002Flock\u002Fnode-0000000000"}]},{type:a,value:"，下一个有序节点就是"},{type:b,tag:w,props:{},children:[{type:a,value:"\u002Flock\u002Fnode-0000000001"}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"临时节点：会话结束或者客户端超时，Zookeeper会删除这个临时节点"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"事件监听：我们可以对节点的四个事件进行监听，当事件发生时，Zookeeper会通知客户端。四个事件有：创建节点，删除节点，节点数据修改，子节点变更"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"Zookeeper分布式锁的流程如下："}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"线程创建一个有序临时节点，并获取此节点的编号"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"检查此节点编号是否最小，是的话则获取了锁"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"如果编号不是最小，监听编号比自己小中最大的节点的删除事件"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"监听到前节点的删除事件，从第二步开始重复，直到获得锁为止"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"获得锁后执行业务"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"删除节点，释放锁"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"分析："}]},{type:a,value:h},{type:b,tag:M,props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"Zookeeper保证有序节点之间不会重复，本质就是在排队。有点像Reentrantlock里面的阻塞队列，在排队，不断观察自己前面还有没有人，没有就到自己了。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"设置为临时节点，可以避免线程挂了，无法删除节点，这样后面的节点只能死等了"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"Zookeeper保证读操作与监听操作是原子的。避免有一种情况是线程A创建节点0并获取了锁，线程B创建节点1后发现有节点0，线程A删除节点0，线程B才去监听节点0被删除的情况。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"但是如果客户端存活却没有删除节点，后面的节点就只能死等，容易造成死锁。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"以及可以删除他人的节点？解铃不须系铃人？"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:a,value:"参考文章："}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:"http:\u002F\u002Fwww.54tianzhisheng.cn\u002F2018\u002F04\u002F24\u002FDistributed_lock\u002F",rel:[I,J,K],target:L},children:[{type:a,value:"分布式锁看这篇就够了"}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fchenzhou123520.iteye.com\u002Fblog\u002F1863407",rel:[I,J,K],target:L},children:[{type:a,value:"mysql乐观锁总结和实践"}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:br,rel:[I,J,K],target:L},children:[{type:a,value:bs}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fblog.csdn.net\u002Fdingse\u002Farticle\u002Fdetails\u002F80572783",rel:[I,J,K],target:L},children:[{type:a,value:"SpringBoot 2.0 整合Jedis"}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:"http:\u002F\u002Fwww.dengshenyu.com\u002Fjava\u002F%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F\u002F2017\u002F10\u002F23\u002Fzookeeper-distributed-lock.html",rel:[I,J,K],target:L},children:[{type:a,value:"基于Zookeeper的分布式锁"}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fwww.jianshu.com\u002Fp\u002F31335efec309",rel:[I,J,K],target:L},children:[{type:a,value:"ZooKeeper + Curator 实现分布式锁"}]}]},{type:a,value:h},{type:b,tag:v,props:{},children:[{type:b,tag:x,props:{href:"http:\u002F\u002Fblog.51cto.com\u002Fcomputerdragon\u002F1764705",rel:[I,J,K],target:L},children:[{type:a,value:"剖析curator的分布式互斥锁原理"}]}]}]},excerpt:{type:aO,children:[]},dir:bA,path:"\u002F中间件\u002F20181222\u002FMysql，Redis与Zookeeper实现分布式锁",extension:".md",title:aH,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20181222\u002FMysql，Redis与Zookeeper实现分布式锁\u002F",createAt:new Date(1545436800000),updateAt:new Date(1545436800000),attributes:[{name:"createAt",value:bB},{name:"updateAt",value:bB},{name:"sort",value:bA,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20181222\u002F1\u002F"}]}}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation"," ","keyword","\n","(",")","function",".","operator","li",";","comment","class-name","=","\n            ","\n    ","number","p","code","a","{","\n        ","}","1",",","boolean","return","set","wide","true","nofollow","noopener","noreferrer","_blank","ol","final","String","if","get","public","private","string","[","]"," \n",-1,"icon","icon-link"," jedisPool","\n\n    ","div","nuxt-content-highlight","pre","line-numbers","table","where","ThreadLocal","false","id","=="," redis","call"," KEYS"," \n    ","h1","status"," id","update"," id ","static","generics","\u003C","\u003E","null","\u002F\u002F初始化线程id","\n            id","UUID","randomUUID","toString","lockKey","无名の窝",10000,"青春猪头-牧之原翔子-江之岛","Mysql，Redis与Zookeeper实现分布式锁","2018-12-22T00:00:00.000Z","mysql的乐观锁",2,"Mysql的乐观锁","mysql的悲观锁","Mysql的悲观锁","root","h2","解铃还须系铃人：需要自己在表中增加一列值，为唯一标志线程的id，以此标示锁的所有者","具有容错性：暂时不会","language-sql","select","from","\n\n","version","for update","0","begin","\u002F","annotation","RedisLock","new","JedisPool"," lockKey","try","Jedis"," jedis ","getResource","SetParams"," result "," jedis","equals","result","\n                hasLock","\n                ","Collections","singletonList","http:\u002F\u002Fwww.importnew.com\u002F27477.html","Redis 分布式锁的正确实现方式（ Java 版 ）","\u002F\u002F","'get'"," ARGV","then","else","'del'","end","\u002F中间件\u002F20181222","2018-12-22")));