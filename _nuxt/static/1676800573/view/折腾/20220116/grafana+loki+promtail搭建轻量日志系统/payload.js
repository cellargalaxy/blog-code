__NUXT_JSONP__("/view/折腾/20220116/grafana+loki+promtail搭建轻量日志系统", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI){return {data:[{siteConfig:{siteName:ac,siteHost:"https:\u002F\u002Fcellargalaxy.github.io",basePath:"\u002Fblog-code\u002F",navs:[{text:"文章",url:"\u002Fblog-code\u002Fpage\u002F1\u002F"},{text:"归档",url:"\u002Fblog-code\u002Farchive\u002F0\u002F"},{text:"画画",url:"\u002Fblog-code\u002Fhtml\u002Fhua.html"},{text:"开源",url:"\u002Fblog-code\u002Fhttps:\u002Fgithub.com\u002Fcellargalaxy\u002Fblog-vue"}],pageSize:10,urlReplace:{"^/file/blog/code":"https:\u002F\u002Foracleamd1.dynv6.net\u002Ffile\u002Ffile\u002Fblog\u002Fcode"},backgroundImage:{duration:ad,fade:1000,images:[{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FcofTzDQXitjeVZ6.jpg",description:ae,type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FsfaRJ2lVeM3NDbE.jpg",description:ae,type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F26\u002FKybiTdftam5Su7x.jpg",description:"青春猪头-双葉理央",type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F09\u002F08\u002FxdX73nfs24qgOYk.jpg",description:"京吹-明日香,久美子",type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F14\u002FMAiruNcEFW2HYtg.jpg",description:"终将成为你-七海灯子,小糸侑",type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F05\u002FEojdAxTDJsFpbPw.jpg",description:"玉子市场-北白川玉子",type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F31\u002FAXxwJDRS9fmN2uU.jpg",description:"fate_hf-弓道馆",type:v},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F01\u002FaHhVObpJus6dnM4.jpg",description:"fate_hf-樱花树",type:v}]}},homeConfig:{brandInterval:ad,brands:[{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F21\u002FmMEAnwY5XPC2pFb.jpg",title:"日常",texts:["我们所度过的每个平凡的日常，也许就是连续不断发生的奇迹。","日々、私たちが過ごしている日常は、実は奇跡の連続なのかもしれない。"]},{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F04\u002F19\u002FH1MmXb9xPcYEhT2.jpg",title:"昨日之歌",texts:["时间梭梭箭如飞，人道漫漫步蹒跚","人間そんな変わるもんじゃないのに、月日ばっかどんどん過ぎて"]}],navs:[{text:"Github",url:"https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002F"}]},pageFootConfig:{lines:[[{text:"Copyright © 2017-? ."},{text:"备案？不存在的"},{text:"Powered by Nuxt.js & Github"}]]},buildTime:new Date(1676800584546),siteName:ac,file:{slug:af,description:"夜深，好困，长话短说。\n\nloki：存储查询日志的服务，对外提供一个http端口\npromtail：收集日志，把日志发生到loki里进行管理\ngrafana：可以通过loki的接口查询日志\n",createdAt:ag,updatedAt:ag,toc:[],body:{type:ah,children:[{type:b,tag:o,props:{},children:[{type:a,value:ai}]},{type:a,value:i},{type:b,tag:V,props:{},children:[{type:a,value:i},{type:b,tag:s,props:{},children:[{type:a,value:aj}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:a,value:ak}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:a,value:al}]},{type:a,value:i}]},{type:a,value:i},{type:a,value:i},{type:b,tag:K,props:{id:am},children:[{type:b,tag:q,props:{href:"#%E9%A2%84%E5%A4%87%E5%B7%A5%E4%BD%9C",ariaHidden:x,tabIndex:L},children:[{type:b,tag:c,props:{className:[M,N]},children:[]}]},{type:a,value:am}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"loki的http端口需要对外，但loki的http貌似没权限校验功能，所以用caddy反代置于，加个账号密码校验。"}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"caddy的配置，使用basicauth加上账号密码校验。admin就是账号，后面的是密码的hash base64。 这个hash base64需要使用caddy来生成，执行"},{type:b,tag:p,props:{},children:[{type:a,value:"caddy hash-password"}]},{type:a,value:"\n，输入两次密码，就能生成。"}]},{type:a,value:i},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,Q]},children:[{type:b,tag:p,props:{},children:[{type:a,value:":80 "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:W}]},{type:a,value:"\n  encode "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"gzip"}]},{type:a,value:" zstd\n  \n  route \u002Floki\u002F* "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:W}]},{type:a,value:"\n    uri strip_prefix \u002Floki\n    reverse_proxy "},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"127.0"}]},{type:a,value:".0.1:3100\n  "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:"\n    \n  basicauth \u002Floki\u002F* "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:W}]},{type:a,value:"\n    admin JDJhJDE0JEZDN1Q0ZjZwc2ZrbG1FODROdndmc09UZzRJWW41c2QyaFB0aUFnSUhwL3JZWVRob1FabWV1\n  "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:K,props:{id:an},children:[{type:b,tag:q,props:{href:"#grafana",ariaHidden:x,tabIndex:L},children:[{type:b,tag:c,props:{className:[M,N]},children:[]}]},{type:a,value:an}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"grafana没啥要求的，docker直接安装就好"}]},{type:a,value:i},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,Q]},children:[{type:b,tag:p,props:{},children:[{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:" volume create grafana_data\n"},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:Y},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:Z}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:_}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aa}]},{type:a,value:" grafana "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:ao}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,ap,l]},children:[{type:a,value:"GF_SERVER_ROOT_URL"}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:"https:\u002F\u002Fexample.com\u002Fgrafana\u002F "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:ao}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,ap,l]},children:[{type:a,value:"GF_SERVER_SERVE_FROM_SUB_PATH"}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:"true "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aq}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"3000"}]},{type:a,value:":3000 "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:T}]},{type:a,value:" grafana_data:\u002Fvar\u002Flib\u002Fgrafana "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n  grafana\u002Fgrafana\n"}]}]}]},{type:a,value:i},{type:b,tag:K,props:{id:ar},children:[{type:b,tag:q,props:{href:"#loki",ariaHidden:x,tabIndex:L},children:[{type:b,tag:c,props:{className:[M,N]},children:[]}]},{type:a,value:ar}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"配置文件，加了注释的可以按需改改，其余的都是官方默认配置。"}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"官方配置："},{type:b,tag:q,props:{href:as,rel:[A,B,C],target:D},children:[{type:a,value:as}]}]},{type:a,value:i},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,at]},children:[{type:b,tag:p,props:{},children:[{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"auth_enabled"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,ab,U]},children:[{type:a,value:"false"}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aw}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"9096"}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"common"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"path_prefix"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" \u002Ftmp\u002Floki\n  "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"storage"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"filesystem"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"chunks_directory"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" \u002Ftmp\u002Floki\u002Fchunks\n      "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"rules_directory"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" \u002Ftmp\u002Floki\u002Frules\n  "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"replication_factor"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"1"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"ring"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"instance_addr"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" 127.0.0.1\n    "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"kvstore"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" inmemory\n\n"},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"schema_config"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"configs"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"from"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,"datetime",r]},children:[{type:a,value:"2020-10-24"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" boltdb"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:"shipper\n      "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"object_store"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" filesystem\n      "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"schema"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" v11\n      "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"index"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:"\n        "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"prefix"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" index_\n        "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"period"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" 24h\n\n"},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"ruler"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"alertmanager_url"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:"\u002F\u002Flocalhost"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"9093"}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"limits_config"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"reject_old_samples"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,ab,U]},children:[{type:a,value:x}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#是否拒绝旧样本"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"reject_old_samples_max_age"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#30d,默认168h(7d),之前的样本被拒绝"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"ingestion_rate_mb"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"32"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#每用户每秒样本大小的摄取速率限制。单位为 MB"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"max_entries_limit_per_query"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"10000"}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#默认5000,最大查询行数"}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"table_manager"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"retention_deletes_enabled"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,ab,U]},children:[{type:a,value:x}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#开启删除"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"retention_period"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#30d,默认744h(31d),超过的数据将被删除"}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:aB}]},{type:a,value:i},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,Q]},children:[{type:b,tag:p,props:{},children:[{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:Y},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:Z}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:_}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aa}]},{type:a,value:" loki "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aq}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aw}]},{type:a,value:":3100 "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:T}]},{type:a,value:" \u002Fconfig:\u002Fconfig "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n  grafana\u002Floki "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:"\u002Fconfig\u002Floki.yaml\n"}]}]}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"安装完之后可以进"},{type:b,tag:p,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:3100\u002Floki\u002Fready"}]},{type:a,value:"。一开始会线上要等等，还没ready。等个一会就会显示ready了。"}]},{type:a,value:i},{type:b,tag:K,props:{id:aD},children:[{type:b,tag:q,props:{href:"#promtail",ariaHidden:x,tabIndex:L},children:[{type:b,tag:c,props:{className:[M,N]},children:[]}]},{type:a,value:aD}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"配置文件，官方配置："},{type:b,tag:q,props:{href:aE,rel:[A,B,C],target:D},children:[{type:a,value:aE}]}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"\u002Flog\u002F*log"}]},{type:a,value:"，promtail会抓取\u002Flog下面全面log结尾的文件"}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"启动之后可以看看日志，如果发现请求loki被拒绝，报429，可能是promtail给loki一口气发送的日志过大。可以修改loki的速率限制配置。"}]},{type:a,value:i},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,at]},children:[{type:b,tag:p,props:{},children:[{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"9080"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"0"}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"positions"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"filename"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" \u002Ftmp\u002Fpositions.yaml\n\n"},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"client"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"url"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:az},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:"\u002F\u002F127.0.0.1"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:"3100\u002Floki\u002Fapi\u002Fv1\u002Fpush\n  "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"basic_auth"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"username"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" username\n    "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"password"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" password\n\n"},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"scrape_configs"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"job_name"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" log\n    "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"static_configs"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"targets"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:" localhost\n        "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"job"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" log\n          "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"__path__"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" \u002Flog\u002F"},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"**\u002F*.log"}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"pipeline_stages"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"regex"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#https:\u002F\u002Fregex101.com\u002F"}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"expression"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,"string"]},children:[{type:a,value:"'(?P\u003Ctimestamp\u003E\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+\\d{2}:\\d{2}).+\\[(?P\u003Clevel\u003E[A-Z]{4})\\].+\\[logid:(?P\u003Clogid\u003E[0-9]+)\\].+\\[sn:(?P\u003Csn\u003E.+)\\].+\\[ip:(?P\u003Cip\u003E[0-9.]+)\\].+\\[caller:\"(?P\u003Ccaller\u003E.+)\"\\]'"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"level"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"logid"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"sn"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"ip"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"caller"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"timestamp"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"source"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" timestamp\n          "},{type:b,tag:c,props:{className:[d,g,h]},children:[{type:a,value:"format"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:f}]},{type:a,value:" RFC3339\n"}]}]}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:aB}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"加有日志文件的文件夹挂载到容器内的\u002Flog里。"}]},{type:a,value:i},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,Q]},children:[{type:b,tag:p,props:{},children:[{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:R}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:S}]},{type:a,value:Y},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:Z}]},{type:a,value:j},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:_}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aa}]},{type:a,value:" promtail "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:T}]},{type:a,value:" log:\u002Flog "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:T}]},{type:a,value:" \u002Fconfig.yml:\u002Fconfig.yml "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:"\n  grafana\u002Fpromtail "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,m,l]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:z}]},{type:a,value:"\u002Fconfig.yml\n"}]}]}]},{type:a,value:i},{type:b,tag:K,props:{id:aG},children:[{type:b,tag:q,props:{href:"#%E6%9F%A5%E8%AF%A2",ariaHidden:x,tabIndex:L},children:[{type:b,tag:c,props:{className:[M,N]},children:[]}]},{type:a,value:aG}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"在grafana的左边菜单里找到"},{type:b,tag:p,props:{},children:[{type:a,value:"Configuration"}]},{type:a,value:"，在配置里添加数据源。\n按理数据源的列表有loki可以选。URL填上"},{type:b,tag:p,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:3100\u002Floki"}]},{type:a,value:"。有账号密码就在"},{type:b,tag:p,props:{},children:[{type:a,value:"Basic auth"}]},{type:a,value:"里填一下。保存测试。"}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"左侧菜单里去到"},{type:b,tag:p,props:{},children:[{type:a,value:"Explore"}]},{type:a,value:"，点一下"},{type:b,tag:p,props:{},children:[{type:a,value:"Log browser"}]},{type:a,value:"，正常的话就有日志文件和任务名称可以选。\n所谓的任务名称，是promtail配置里的"},{type:b,tag:p,props:{},children:[{type:a,value:"scrape_configs.static_configs.labels.job"}]},{type:a,value:"那一项。"}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"查询logid："},{type:b,tag:p,props:{},children:[{type:a,value:"{job=\"log\"} |= \"211016031700537788\""}]}]},{type:a,value:i},{type:b,tag:o,props:{},children:[{type:a,value:"参考文章"}]},{type:a,value:i},{type:b,tag:V,props:{},children:[{type:a,value:i},{type:b,tag:s,props:{},children:[{type:b,tag:q,props:{href:"https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Finstallation\u002Fdocker\u002F",rel:[A,B,C],target:D},children:[{type:a,value:"官方安装教程"}]}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:b,tag:q,props:{href:"https:\u002F\u002Fjoelei.com\u002F2021\u002F06\u002Flightweight-log-system-loki-experience\u002F",rel:[A,B,C],target:D},children:[{type:a,value:"轻量级的日志系统Loki体验"}]}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:b,tag:q,props:{href:"https:\u002F\u002Fxiaosongs.com\u002Foperation\u002Floki\u002F",rel:[A,B,C],target:D},children:[{type:a,value:"Loki 轻量级日志收集系统"}]}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:b,tag:q,props:{href:"https:\u002F\u002Fwww.feiyiblog.com\u002F2021\u002F09\u002F16\u002F%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%ADLoki%E7%9A%84%E4%BC%98%E5%8C%96\u002F",rel:[A,B,C],target:D},children:[{type:a,value:"生产环境中Loki的优化"}]}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:b,tag:q,props:{href:"https:\u002F\u002Fwww.yoyoask.com\u002F?p=4436",rel:[A,B,C],target:D},children:[{type:a,value:"Loki、promtail、Grafana、Prometheus日志监控安装与配置"}]}]},{type:a,value:i}]}]},excerpt:{type:ah,children:[{type:b,tag:o,props:{},children:[{type:a,value:ai}]},{type:a,value:i},{type:b,tag:V,props:{},children:[{type:a,value:i},{type:b,tag:s,props:{},children:[{type:a,value:aj}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:a,value:ak}]},{type:a,value:i},{type:b,tag:s,props:{},children:[{type:a,value:al}]},{type:a,value:i}]}]},dir:aH,path:"\u002F折腾\u002F20220116\u002Fgrafana+loki+promtail搭建轻量日志系统",extension:".md",title:af,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220116\u002Fgrafana+loki+promtail搭建轻量日志系统\u002F",createAt:new Date(1642291200000),updateAt:new Date(1642291200000),attributes:[{name:"createAt",value:aI},{name:"updateAt",value:aI},{name:"sort",value:aH,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220116\u002F1\u002F"}]}}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation",":","key","atrule","\n"," ","\n  ","variable","parameter","\\","p","code","a","number","li","function","\n          ","wide","-","true","operator","=","nofollow","noopener","noreferrer","_blank","\n      ","comment","div","nuxt-content-highlight","pre","line-numbers","h1",-1,"icon","icon-link","\n\n","\n    ","language-shell","sudo","docker","-v","important","ul","{","}"," run ","-d","--restart","always ","--name","boolean","无名の窝",10000,"青春猪头-牧之原翔子-江之岛","grafana+loki+promtail搭建轻量日志系统","2022-01-16T00:00:00.000Z","root","夜深，好困，长话短说。","loki：存储查询日志的服务，对外提供一个http端口","promtail：收集日志，把日志发生到loki里进行管理","grafana：可以通过loki的接口查询日志","预备工作","grafana","-e","assign-left","-p","loki","https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Fconfiguration\u002F","language-yaml","server","http_listen_port","3100","grpc_listen_port","store"," http"," 720h ","安装","-config.file","promtail","https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Fclients\u002Fpromtail\u002Fconfiguration\u002F","labels","查询","\u002F折腾\u002F20220116","2022-01-16")));