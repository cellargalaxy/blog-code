__NUXT_JSONP__("/archive/2022", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,do0,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX,dY,dZ,d_,d$,ea,eb,ec,ed,ee,ef,eg,eh,ei,ej,ek,el,em,en,eo,ep,eq,er,es,et,eu,ev,ew,ex,ey,ez,eA,eB,eC,eD,eE,eF,eG,eH,eI,eJ,eK,eL,eM,eN,eO){return {data:[{siteConfig:{siteName:"无名の窝",siteHost:"https:\u002F\u002Fcellargalaxy.github.io",basePath:"\u002Fblog-code\u002F",navs:[{text:"文章",url:bV},{text:"归档",url:"\u002Fblog-code\u002Farchive\u002F0\u002F"},{text:"画画",url:"\u002Fblog-code\u002Fhtml\u002Fhua.html"},{text:"开源",url:"\u002Fblog-code\u002Fhttps:\u002Fgithub.com\u002Fcellargalaxy\u002Fblog-vue"}],pageSize:10,urlReplace:{"^/file/blog/code":"https:\u002F\u002Foracleamd1.dynv6.net\u002Ffile\u002Ffile\u002Fblog\u002Fcode"},backgroundImage:{duration:bW,fade:1000,images:[{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FcofTzDQXitjeVZ6.jpg",description:bX,type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F25\u002FsfaRJ2lVeM3NDbE.jpg",description:bX,type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F26\u002FKybiTdftam5Su7x.jpg",description:"青春猪头-双葉理央",type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F09\u002F08\u002FxdX73nfs24qgOYk.jpg",description:"京吹-明日香,久美子",type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F14\u002FMAiruNcEFW2HYtg.jpg",description:"终将成为你-七海灯子,小糸侑",type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F05\u002FEojdAxTDJsFpbPw.jpg",description:"玉子市场-北白川玉子",type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F31\u002FAXxwJDRS9fmN2uU.jpg",description:"fate_hf-弓道馆",type:aA},{url:"https:\u002F\u002Fi.loli.net\u002F2020\u002F02\u002F01\u002FaHhVObpJus6dnM4.jpg",description:"fate_hf-樱花树",type:aA}]}},homeConfig:{brandInterval:bW,brands:[{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F21\u002FmMEAnwY5XPC2pFb.jpg",title:"日常",texts:["我们所度过的每个平凡的日常，也许就是连续不断发生的奇迹。","日々、私たちが過ごしている日常は、実は奇跡の連続なのかもしれない。"]},{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F04\u002F19\u002FH1MmXb9xPcYEhT2.jpg",title:"昨日之歌",texts:["时间梭梭箭如飞，人道漫漫步蹒跚","人間そんな変わるもんじゃないのに、月日ばっかどんどん過ぎて"]}],navs:[{text:"Github",url:"https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002F"}]},pageFootConfig:{lines:[[{text:"Copyright © 2017-? ."},{text:"备案？不存在的"},{text:"Powered by Nuxt.js & Github"}]]},buildTime:new Date(1661351969092),startPage:2018,endPage:bY,currentPage:bY,files:[{slug:bZ,description:"夜深，好困，长话短说。\n\nloki：存储查询日志的服务，对外提供一个http端口\npromtail：收集日志，把日志发生到loki里进行管理\ngrafana：可以通过loki的接口查询日志\n",createdAt:b_,updatedAt:b_,toc:[],body:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:b$}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:ca}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:cb}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:cc}]},{type:a,value:e}]},{type:a,value:e},{type:a,value:e},{type:b,tag:Q,props:{id:cd},children:[{type:b,tag:j,props:{href:"#%E9%A2%84%E5%A4%87%E5%B7%A5%E4%BD%9C",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cd}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"loki的http端口需要对外，但loki的http貌似没权限校验功能，所以用caddy反代置于，加个账号密码校验。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"caddy的配置，使用basicauth加上账号密码校验。admin就是账号，后面的是密码的hash base64。 这个hash base64需要使用caddy来生成，执行"},{type:b,tag:k,props:{},children:[{type:a,value:"caddy hash-password"}]},{type:a,value:"\n，输入两次密码，就能生成。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ak]},children:[{type:b,tag:k,props:{},children:[{type:a,value:bv},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:"\n  encode "},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"gzip"}]},{type:a,value:" zstd\n  \n  route \u002Floki\u002F* "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:"\n    uri strip_prefix \u002Floki\n    reverse_proxy "},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"127.0"}]},{type:a,value:".0.1:3100\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:"\n    \n  basicauth \u002Floki\u002F* "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:"\n    admin JDJhJDE0JEZDN1Q0ZjZwc2ZrbG1FODROdndmc09UZzRJWW41c2QyaFB0aUFnSUhwL3JZWVRob1FabWV1\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:ce},children:[{type:b,tag:j,props:{href:"#grafana",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:ce}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"grafana没啥要求的，docker直接安装就好"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ak]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:" volume create grafana_data\n"},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" grafana "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aK}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aL,o]},children:[{type:a,value:"GF_SERVER_ROOT_URL"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:"https:\u002F\u002Fexample.com\u002Fgrafana\u002F "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aK}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aL,o]},children:[{type:a,value:"GF_SERVER_SERVE_FROM_SUB_PATH"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:"true "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"3000"}]},{type:a,value:":3000 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" grafana_data:\u002Fvar\u002Flib\u002Fgrafana "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\n  grafana\u002Fgrafana\n"}]}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:cf},children:[{type:b,tag:j,props:{href:"#loki",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cf}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"配置文件，加了注释的可以按需改改，其余的都是官方默认配置。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"官方配置："},{type:b,tag:j,props:{href:cg,rel:[x,y,z],target:A},children:[{type:a,value:cg}]}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ch]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"auth_enabled"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aD,aQ]},children:[{type:a,value:bw}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:ci}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cj}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:ck}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cl}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"9096"}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"common"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"path_prefix"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" \u002Ftmp\u002Floki\n  "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"storage"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"filesystem"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"chunks_directory"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" \u002Ftmp\u002Floki\u002Fchunks\n      "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"rules_directory"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" \u002Ftmp\u002Floki\u002Frules\n  "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"replication_factor"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aR}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"ring"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"instance_addr"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" 127.0.0.1\n    "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"kvstore"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cm}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" inmemory\n\n"},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"schema_config"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"configs"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"from"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,"datetime",K]},children:[{type:a,value:"2020-10-24"}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cm}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" boltdb"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:"shipper\n      "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"object_store"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" filesystem\n      "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"schema"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" v11\n      "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"index"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"prefix"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" index_\n        "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"period"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" 24h\n\n"},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"ruler"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"alertmanager_url"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:"\u002F\u002Flocalhost"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"9093"}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"limits_config"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"reject_old_samples"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aD,aQ]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#是否拒绝旧样本"}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"reject_old_samples_max_age"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:cn},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#30d,默认168h(7d),之前的样本被拒绝"}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"ingestion_rate_mb"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"32"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#每用户每秒样本大小的摄取速率限制。单位为 MB"}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"max_entries_limit_per_query"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"10000"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#默认5000,最大查询行数"}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"table_manager"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"retention_deletes_enabled"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aD,aQ]},children:[{type:a,value:p}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#开启删除"}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"retention_period"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:cn},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#30d,默认744h(31d),超过的数据将被删除"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aH}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ak]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" loki "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:ck}]},{type:a,value:":3100 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" \u002Fconfig:\u002Fconfig "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\n  grafana\u002Floki "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:co}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:"\u002Fconfig\u002Floki.yaml\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"安装完之后可以进"},{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:3100\u002Floki\u002Fready"}]},{type:a,value:"。一开始会线上要等等，还没ready。等个一会就会显示ready了。"}]},{type:a,value:e},{type:b,tag:Q,props:{id:cp},children:[{type:b,tag:j,props:{href:"#promtail",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cp}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"配置文件，官方配置："},{type:b,tag:j,props:{href:cq,rel:[x,y,z],target:A},children:[{type:a,value:cq}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"\u002Flog\u002F*log"}]},{type:a,value:"，promtail会抓取\u002Flog下面全面log结尾的文件"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"启动之后可以看看日志，如果发现请求loki被拒绝，报429，可能是promtail给loki一口气发送的日志过大。可以修改loki的速率限制配置。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ch]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:ci}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cj}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"9080"}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cl}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aI}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"positions"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"filename"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" \u002Ftmp\u002Fpositions.yaml\n\n"},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"client"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"url"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:"\u002F\u002F127.0.0.1"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:"3100\u002Floki\u002Fapi\u002Fv1\u002Fpush\n  "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"basic_auth"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"username"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" username\n    "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"password"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" password\n\n"},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"scrape_configs"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"job_name"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" log\n    "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"static_configs"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"targets"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:" localhost\n        "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"job"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" log\n          "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"__path__"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" \u002Flog\u002F"},{type:b,tag:c,props:{className:[d,aQ]},children:[{type:a,value:"**\u002F*.log"}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"pipeline_stages"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"regex"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#https:\u002F\u002Fregex101.com\u002F"}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"expression"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'(?P\u003Ctimestamp\u003E\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+\\d{2}:\\d{2}).+\\[(?P\u003Clevel\u003E[A-Z]{4})\\].+\\[logid:(?P\u003Clogid\u003E[0-9]+)\\].+\\[sn:(?P\u003Csn\u003E.+)\\].+\\[ip:(?P\u003Cip\u003E[0-9.]+)\\].+\\[caller:\"(?P\u003Ccaller\u003E.+)\"\\]'"}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"level"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"logid"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"sn"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"ip"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"caller"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:$}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"timestamp"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"source"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" timestamp\n          "},{type:b,tag:c,props:{className:[d,m,n]},children:[{type:a,value:"format"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:l}]},{type:a,value:" RFC3339\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aH}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"加有日志文件的文件夹挂载到容器内的\u002Flog里。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ak]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" promtail "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" log:\u002Flog "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" \u002Fconfig.yml:\u002Fconfig.yml "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\n  grafana\u002Fpromtail "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:co}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:"\u002Fconfig.yml\n"}]}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:cs},children:[{type:b,tag:j,props:{href:"#%E6%9F%A5%E8%AF%A2",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cs}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在grafana的左边菜单里找到"},{type:b,tag:k,props:{},children:[{type:a,value:"Configuration"}]},{type:a,value:"，在配置里添加数据源。\n按理数据源的列表有loki可以选。URL填上"},{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:3100\u002Floki"}]},{type:a,value:"。有账号密码就在"},{type:b,tag:k,props:{},children:[{type:a,value:"Basic auth"}]},{type:a,value:"里填一下。保存测试。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"左侧菜单里去到"},{type:b,tag:k,props:{},children:[{type:a,value:"Explore"}]},{type:a,value:"，点一下"},{type:b,tag:k,props:{},children:[{type:a,value:"Log browser"}]},{type:a,value:"，正常的话就有日志文件和任务名称可以选。\n所谓的任务名称，是promtail配置里的"},{type:b,tag:k,props:{},children:[{type:a,value:"scrape_configs.static_configs.labels.job"}]},{type:a,value:"那一项。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"查询logid："},{type:b,tag:k,props:{},children:[{type:a,value:"{job=\"log\"} |= \"211016031700537788\""}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aS}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Finstallation\u002Fdocker\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"官方安装教程"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fjoelei.com\u002F2021\u002F06\u002Flightweight-log-system-loki-experience\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"轻量级的日志系统Loki体验"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fxiaosongs.com\u002Foperation\u002Floki\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"Loki 轻量级日志收集系统"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.feiyiblog.com\u002F2021\u002F09\u002F16\u002F%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%ADLoki%E7%9A%84%E4%BC%98%E5%8C%96\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"生产环境中Loki的优化"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.yoyoask.com\u002F?p=4436",rel:[x,y,z],target:A},children:[{type:a,value:"Loki、promtail、Grafana、Prometheus日志监控安装与配置"}]}]},{type:a,value:e}]}]},excerpt:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:b$}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:ca}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:cb}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:cc}]},{type:a,value:e}]}]},dir:ct,path:"\u002F折腾\u002F20220116\u002Fgrafana+loki+promtail搭建轻量日志系统",extension:ag,title:bZ,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220116\u002Fgrafana+loki+promtail搭建轻量日志系统\u002F",createAt:new Date(1642291200000),updateAt:new Date(1642291200000),attributes:[{name:ah,value:cu},{name:ai,value:cu},{name:aj,value:ct,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220116\u002F1\u002F"}]},{slug:cv,description:bz,createdAt:"2022-03-04T00:00:00.000Z",updatedAt:"2022-03-07T00:00:00.000Z",toc:[{id:cw,depth:G,text:cx},{id:aT,depth:G,text:aT},{id:cy,depth:G,text:cz},{id:cA,depth:3,text:cB},{id:aU,depth:G,text:aU},{id:aV,depth:G,text:aV},{id:cC,depth:G,text:cD}],body:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:bz}]},{type:a,value:e},{type:a,value:e},{type:b,tag:Q,props:{id:"lsm树的实现"},children:[{type:b,tag:j,props:{href:"#lsm%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"LSM树的实现"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"RocksDB的LSM树的存储结构有三种：WAL+mentable+SSTable"}]},{type:a,value:e},{type:b,tag:H,props:{id:cw},children:[{type:b,tag:j,props:{href:"#wal",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cx}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"WAL(write-ahead log)(预写式日志)，WAL本质是一个追加写入的硬盘文件，是数据库技术中实现事务的一种标准方法，可以实现单机事务的原子性和持久性，同时提高写入的性能。\n在修改数据时为了实现事务的原子性和持久性，并不会直接修改数据文件，因为一个事务中可能会随机修改多个字段，导致需要修改数据文件的位置也是随机的。\n一是随机IO会影响性能，二是多次的随机IO写入显然无法保证原子性。\n而使用WAL的话，并不会直接去修改数据文件，而是把数据修改的情况都写入WAL里。往WAL里写入的类型有两种，redo执行写操作，undo回滚写操作。\n接下来可能会有五种情况："}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"往WAL写入redo前崩溃了，重启后WAL并没有相关日志：事务无执行，数据文件无影响"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"往WAL写入redo时崩溃了，重启后WAL的日志并不完整：事务取消执行，数据文件无影响"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"往WAL写入redo后崩溃了，重启后WAL的日志写入完整：从WAL中读出所需修改的数据，修改数据文件"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"修改数据文件时崩溃了：从WAL中读出所需修改的数据，继续修改数据文件"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"修改数据文件无法进行：往WAL里写入undo，回滚写操作，事务执行失败"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"使用WAL支持并发读读和读写，由于都是追加写入，不支持并发写写。\n如果需要读最新的数据，则需要往WAL里查询。如果WAL没查到，那数据文件里的就是最新的数据。\n需要注意，写入WAL与修改数据文件并不一定是同步的。往往会合并WAL多个写操作，批量刷入硬盘里。"}]},{type:a,value:e},{type:b,tag:H,props:{id:aT},children:[{type:b,tag:j,props:{href:"#mentable",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:aT}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"mentable是RocksDB的内存数据结构，使用跳表实现，分为active memtable和immutable memtable两种。\nRocksDB在写入WAL之后，会把数据写到active mentable里。\n如果active mentable被写满，会新建一个active mentable，旧的会变成immutable memtable，等待被异步刷入硬盘里。"}]},{type:a,value:e},{type:b,tag:H,props:{id:cy},children:[{type:b,tag:j,props:{href:"#sstable",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cz}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"SSTable，SST文件，全称Sorted String Table，是持久化的，不可改的，有序的数据文件。\nSSTable的文件分为多个区域，内部有索引信息能加快数据查询速度。\nmentable被刷到硬盘里的数据去向就是生成SSTable。\nSST文件都属于某一个层，从L0到Ln，层级越小，数据越新。新生成的SST文件首先会在L0层，但每一层的SST文件数量会有限制。在一定的条件下，会对SST文件进行合并。"}]},{type:a,value:e},{type:b,tag:aW,props:{id:cA},children:[{type:b,tag:j,props:{href:"#compaction",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cB}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"由于RocksDB通过增量写写入mentable，而SST文件数据来源于mentable，所以SST文件的数据的冗余的。\n为了减少冗余，会对SST文件进行合并，删除重复或者过期的key。\n而RocksDB默认是使用Level Style Compaction作为合并策略。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"首先L0的SST文件是从mentable生成的，所以L0的SST文件直接会有重复的key。\n当进行合并时，会选择Ln层的一个文件，与Ln+1的多个文件进行合并，合并相同的key，删除失效key。\n合并后，每一层的SST文件直接都是有顺序的。"}]},{type:a,value:e},{type:b,tag:H,props:{id:aU},children:[{type:b,tag:j,props:{href:"#%E8%AF%BB%E6%93%8D%E4%BD%9C",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:aU}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"在active mentable里查询"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"在immutable memtable里查询"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"在L0里查询。由于L0可能有重复key，所以才有遍历查询"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"在Ln里查询，由于Ln没有重复key，所以使用二分法查询"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"如果到Lmax都还查不到，那就是查不到"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:aV},children:[{type:b,tag:j,props:{href:"#%E5%86%99%E6%93%8D%E4%BD%9C",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:aV}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"数据写入active mentable"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"active mentable到达一定大小，会转变成immutable memtable，创建新的active mentable继续提供读写"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"满足一定会把immutable memtable刷为硬盘的SST文件。先写入系统缓存页，再异步写入硬盘，考虑到系统奔溃丢缓存页可能性较低，异步写还是可靠的"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:cC},children:[{type:b,tag:j,props:{href:"#column-family",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:cD}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"kv存储时需要指定列族(Column Family)，且允许创建多个列族。列族直接使用不同的mentable和SST文件，但是公用一个WAL。\n好处是可以对不同列族的mentable和SST进行不同的配置，提高读写性能。"}]},{type:a,value:e},{type:b,tag:Q,props:{id:"lsm树总结"},children:[{type:b,tag:j,props:{href:"#lsm%E6%A0%91%E6%80%BB%E7%BB%93",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"LSM树总结"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"相比于B+树来说，要在B+树写入随机的数据，写入的节点位置是随机的，随机写入影响着B+树的写入性能。\n而LSM树通过使用WAL，mentable和SST文件，将随机写转换为顺序写，大大提高了写入的性能。\n但顺序写的所带来的代价的空间放大，写放大和读放大。"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"由于SST文件的冗余性，存储空间被放大"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"同样由于冗余性而需要进行合并，每次合并都进行一次写操作，实际是把每次只需写入一次的数据放大操作了多次写"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"LSM树读取数据需要分层读取多次，读取次数的放大会影响读性能"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"空间放大，写放大和读放大三种需要平衡，RocksDB提供了许多配置来进行微调设置。\n跟B+树相比，B+树对事物支持更好，因为B+树能原地更新数据，并且数据只有一份。而LSM树的key在L0里会重复，只有在进行合并的时候才算完成事物。\nLSM树支持O(1)的写，O(n)的读。而B+树的读写都是O(logN)。通常来说，LSM树的写性能由于B+树，B+树的读性能优于LSM树。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aS}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fsegmentfault.com\u002Fa\u002F1190000041198407",rel:[x,y,z],target:A},children:[{type:a,value:"从 RocksDB 看 LSM-Tree 算法设计"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fflynx.dev\u002Frocksdb\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"一个项目的诞生(三)：RocksDB的价值"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Flessisbetter.site\u002F2020\u002F01\u002F02\u002Fwal-introduction\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"WAL(预写式日志)简介"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1623123",rel:[x,y,z],target:A},children:[{type:a,value:"你常听说的WAL到底是什么"}]}]}]},excerpt:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:bz}]}]},dir:cE,path:"\u002F中间件\u002F20220304\u002FRocksDB初步了解",extension:ag,title:cv,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20220304\u002FRocksDB初步了解\u002F",createAt:new Date(1646352000000),updateAt:new Date(1646611200000),attributes:[{name:ah,value:"2022-03-04"},{name:ai,value:"2022-03-07"},{name:aj,value:cE,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20220304\u002F1\u002F"}]},{slug:cF,toc:[],body:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:"这是关于关于我的页面，一名底层搬砖的程序猿。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"希望有一个自己喜欢的，漂漂亮亮的地方来记录各种东西，所以写了这个博客。当然你可能是在GitHub里看见这句话的，那欢迎光临"},{type:b,tag:j,props:{href:cG,rel:[x,y,z],target:A},children:[{type:a,value:cG}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"不知道写些什么好，就先到这里为止吧。"}]}]},dir:aX,path:"\u002FREADME",extension:ag,createdAt:aY,updatedAt:aY,excerpt:al,title:cF,url:"\u002Fblog-code\u002Fview\u002FREADME\u002F",createAt:new Date(1661351874239),updateAt:new Date(1661351874239),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:aX,url:bV}]},{slug:cH,toc:[{id:aZ,depth:G,text:aZ},{id:a_,depth:G,text:a_},{id:a$,depth:G,text:a$},{id:ba,depth:G,text:ba},{id:bb,depth:G,text:bb}],body:{type:_,children:[{type:b,tag:H,props:{id:aZ},children:[{type:b,tag:j,props:{href:"#%E6%B7%BB%E5%8A%A0%E5%88%86%E6%9E%90",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:aZ}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"排查工具我用的是PProf。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"对于web服务的使用，可以对外暴露一个端口拉取分析。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"使用go自带的web服务"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,bA]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bB}]},{type:a,value:bC},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bD}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,aD]},children:[{type:a,value:bE}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"net\u002Fhttp\u002Fpprof\""}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"http\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:cI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,aD]},children:[{type:a,value:bE}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"ListenAndServe"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:cJ}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aD]},children:[{type:a,value:"nil"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"使用gin的话，可以使用"},{type:b,tag:k,props:{},children:[{type:a,value:"github.com\u002Fgin-contrib\u002Fpprof"}]},{type:a,value:"包"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,bA]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bB}]},{type:a,value:bC},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bD}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"github.com\u002Fgin-contrib\u002Fpprof\""}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"github.com\u002Fgin-gonic\u002Fgin\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:cI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:"\n  engine "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cK}]},{type:a,value:" gin"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"Default"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:"\n  debug "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cK}]},{type:a,value:cL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"Group"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"\u002Fdebug\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:"\n  pprof"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"RouteRegister"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"debug"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"\u002Fpprof\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:"\n\n  "},{type:b,tag:c,props:{className:[d,aD]},children:[{type:a,value:bE}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:cL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"Run"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:cJ}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:H,props:{id:a_},children:[{type:b,tag:j,props:{href:"#%E5%88%86%E6%9E%90%E7%B1%BB%E5%9E%8B",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:a_}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"这时候打开 "},{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002F127.0.0.1:6060\u002Fdebug\u002Fpprof\u002F"}]},{type:a,value:" 应该就能看到分析页面"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,aw]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"\u002Fdebug\u002Fpprof\u002F\n\nTypes of profiles available:\nCount Profile\n342   allocs\n0     block\n0     cmdline\n18    goroutine\n342   heap\n0     mutex\n0     profile\n17    threadcreate\n0     trace\nfull goroutine stack dump\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"下面还有一些分析指标的说明"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"allocs：过去分配过的内存分析"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"block：导致阻塞的堆栈"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"cmdline：程序的命令行完整执行调用路径"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"goroutine：当前所有的协程情况"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"heap：当前内存分配情况"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"mutex：当前导致互斥锁竞争的持有者堆栈情况"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"profile：默认30s的CPU的profile"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"threadcreate：查看新创建的OS线程堆栈情况"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:a$},children:[{type:b,tag:j,props:{href:"#%E5%88%86%E6%9E%90%E5%8F%AF%E8%A7%86%E5%8C%96",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:a$}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"可以通过终端交互查看，但还是推荐网页可视化比较省心。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"使用网页可视化前需要安装"},{type:b,tag:k,props:{},children:[{type:a,value:"graphviz"}]},{type:a,value:"来渲染页面。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"使用命令下载并渲染分析，xxx就是上面的某种分析类型。之后后会自动打开浏览器。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,ak]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"go tool pprof "},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:"-http"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:":6061 http:\u002F\u002Flocalhost:6060\u002Fdebug\u002Fpprof\u002Fxxx\n"}]}]}]},{type:a,value:e},{type:b,tag:H,props:{id:ba},children:[{type:b,tag:j,props:{href:"#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E8%8F%9C%E5%8D%95",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:ba}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"view"}]},{type:a,value:"里有不同的可视化方式，分别是"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Top：会罗列各个方法的资源消耗，点一下可以排序\n"},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"flat：方法自身的资源消耗"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"flat%：方法自身的资源消耗占比"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"sum%：排序后的累加的资源消耗占比"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"cum：方法及其所调用的方法的资源消耗总和"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"cum%：方法及其所调用的方法的资源消耗总和占比"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Name：方法名"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Graph：一个方法调用关系图，框越大消耗越大。第一行是包名，第二行是方法名，第三行是flat+flat%，第四行是cum+cum%"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Flame Graph：火焰图，方法的cum可视化图形"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Peek：相比top，增加了方法的调用者和被调用者"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Source：可以看到源代码，对源代码基本进行分析"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"如果是选择了内存的指标，"},{type:b,tag:k,props:{},children:[{type:a,value:"simple"}]},{type:a,value:"里可以进一步对内存做进一步的过滤"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"alloc_objects：方法的历史内存对象数量"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"alloc_space：方法的历史内存分配大小"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"inuse_objects：方法的当前内存对象数量"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"inuse_space：方法的当前内存分配大小"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:bb},children:[{type:b,tag:j,props:{href:"#%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bb}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"这里简单看heap的top，在去看看Graph。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,aw]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"Flat      Flat%    Sum%    Cum         Cum%    Name Inlined?\n9728.45kB  37.33%  37.33%  9728.45kB   37.33%  context.WithValue    \n5120.08kB  19.65%  56.98%  14848.52kB  56.98%  github.com\u002Fcellargalaxy\u002Fgo_common\u002Futil.SetCtxValue   (inline)\n2562.81kB  9.84%   66.82%  2562.81kB   9.84%   runtime.allocm   \n2560.04kB  9.82%   76.64%  17408.56kB  66.81%  github.com\u002Fcellargalaxy\u002Fgo_common\u002Futil.ResetLogId    \n2449.92kB  9.40%   86.04%  2961.94kB   11.37%  modernc.org\u002Flibc\u002Fhonnef.co\u002Fgo\u002Fnetdb.init.0   \n561.50kB   2.15%   88.20%  17970.06kB  68.96%  github.com\u002Fcellargalaxy\u002Fserver_center\u002Fsdk.flushEvent \n...\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"包含的对象内存最大头的调用链路是"},{type:b,tag:k,props:{},children:[{type:a,value:"flushEvent-\u003EResetLogId-\u003ESetCtxValue-\u003EWithValue"}]},{type:a,value:"。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"他没有直接告诉我那个对象站内存大。一开始我是没看懂，想不明白。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"后来想啊想啊，想到了我代码里有这么一段代码。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,bA]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bB}]},{type:a,value:bC},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bD}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"context\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"flushEvent"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:a,value:bG},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:"for"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:"\n    ctx "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:cM}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:cN}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:cN}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:a,value:bG},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"\u002F\u002Fdo something"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aM}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:cM}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:a,value:bG},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:cO},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:a,value:"Context "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:an}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"\u002F\u002F省略SetCtxValue的逻辑"}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:cP}]},{type:a,value:cO},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"WithValue"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"xxx\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"yyy\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ao}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"context.Context"}]},{type:a,value:"不是一个map，每次for循环给ctx加值，值会一直累加，不会释放。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"给ctx加的值不大，并且for循环频率不高，所以内存增值是比较缓慢的，符合事件观察的现象。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:bI}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:cQ,rel:[x,y,z],target:A},children:[{type:a,value:cQ}]}]}]},dir:cR,path:"\u002Fgolang\u002F20220804\u002F记一次go内存泄漏排查",extension:ag,createdAt:aY,updatedAt:aY,excerpt:al,title:cH,url:"\u002Fblog-code\u002Fview\u002Fgolang\u002F20220804\u002F记一次go内存泄漏排查\u002F",createAt:new Date(1661351874239),updateAt:new Date(1661351874239),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:cR,url:"\u002Fblog-code\u002Fpage\u002Fgolang\u002F20220804\u002F1\u002F"}]},{slug:cS,toc:[],body:{type:_,children:[{type:b,tag:Q,props:{id:"oltp"},children:[{type:b,tag:j,props:{href:"#oltp",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"OLTP"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Online Transactional Processing，事务型数据库。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"要求实时处理，响应速度快，保证事务的ACID。实际场景中，多会操作少数几行的多列数据，因此适用于行式存储。"}]},{type:a,value:e},{type:b,tag:Q,props:{id:"olap"},children:[{type:b,tag:j,props:{href:"#olap",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"OLAP"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Online analytical processing：分析型数据库。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"对查询速度要求不高，查询也并不频繁，操作多是查询，对修改需求不高。实际场景中，多会查询少数几列的多行数据，因此适用于列式存储。"}]},{type:a,value:e},{type:b,tag:Q,props:{id:"htap"},children:[{type:b,tag:j,props:{href:"#htap",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"HTAP"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Hybrid Transactional\u002FAnalytical Processing：混合型数据库。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"既能支持实时事务特性，也支持大量数据查询分析的性能，一般由三种实现方式。"}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"在应用层对OLTP和OLAP系统进行松耦合，OLTP和OLAP共享一份数据，通过ETL将OLTP的数据同步到OLAP，整体对外表现为HTAP。"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"在数据库层分别使用行存储引擎和列存储引擎，分别负责OLTP和OLAP的功能。存储在物理上隔离，使用一定的协议进行数据同步。是主流的实现方案。"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"使用但一次存储引擎，同时实现OLTP和OLAP。但无论是单使用行存储还是列存储，性能都无法达到较优。"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:bI}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:cT,rel:[x,y,z],target:A},children:[{type:a,value:cT}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:cU,rel:[x,y,z],target:A},children:[{type:a,value:cU}]}]},{type:a,value:e}]},{type:a,value:e}]}]},dir:cV,path:"\u002F中间件\u002F20220428\u002FOLTP、OLAP与HTAP",extension:ag,createdAt:aJ,updatedAt:aJ,excerpt:al,title:cS,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20220428\u002FOLTP、OLAP与HTAP\u002F",createAt:new Date(1661351874243),updateAt:new Date(1661351874243),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:cV,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20220428\u002F1\u002F"}]},{slug:cW,toc:[],body:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:"记录一下最近用到了令牌桶来限频。在网上所说的令牌桶的基础上，还有一个很有用的做法。\n是允许一定程度的透支未来的令牌，但取得透支令牌的请求需要sleep一段时间。如果sleep的时间超过了能接受的上限，还是会被频率。\n这样子在sleep的时间范围内，其实起到了削峰填谷的作用。对于一些会一波一波来的请求，能起到平滑的作用。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"下面就直接贴lua脚本"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,aw]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"\u002F\u002F      限频的key\nkeys = [\"qps_limit_xxx\"]\n\u002F\u002F      所取走的令牌数  当前时间，毫秒  最大等待时间，毫秒  令牌桶容量  周期，毫秒\nargs = [1,            now.ts(),    \"3s\".ts(),        100,      1000] \u002F\u002F也就是QPS限制为100\nwait_time = eval(\"lua_script\", keys, args)\n"}]}]}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[P,"language-lua"]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:" key "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:" KEYS"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 限频的key"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:cX},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 所取走的令牌数"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:" curr_time "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:cY}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 当前时间，毫秒"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:cZ},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"3"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 最大等待时间，毫秒"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"4"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 令牌桶容量"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:c_},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"5"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 周期，毫秒。即假若桶是空的，经过一个周期，桶就能被填满"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:" rate "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aX}]},{type:a,value:c_},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 速率，每毫秒生成的令牌数量"}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- key的数据结构是hash，如有，保存着上次取令牌的时间和剩余令牌数"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:" limit "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:" redis"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bK}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"HMGET\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bM}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bN}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:" last_time "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:c$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:da}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aI}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:db},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:c$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:cY}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:da}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aI}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 计算当前令牌数量"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:dc},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:" math"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"floor"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"curr_time"},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:$}]},{type:a,value:"last_time"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"*"}]},{type:a,value:"rate"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 上次取令牌到现在为止，新增了多少令牌"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:db},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"+"}]},{type:a,value:dc},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 现在桶里有多少令牌"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bO}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:az}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bP}]},{type:a,value:dd},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:" bucket_cap\n"},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bQ}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 延迟时间判断"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aa}]},{type:a,value:de},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:aI}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bO}]},{type:a,value:cX},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"\u003C="}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bP}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 如果当前桶里牌数大于要取走的牌数，直接取就好"}]},{type:a,value:dd},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:$}]},{type:a,value:" consume_permit\n    redis"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bK}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:df}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bN}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:dg},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bM}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:dh},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:di}]},{type:a,value:"\n    wait_time "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"consume_permit"},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:$}]},{type:a,value:"total_permit"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aX}]},{type:a,value:"rate "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 需要多久才能生成这些透支的令牌"}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bO}]},{type:a,value:cZ},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:az}]},{type:a,value:de},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bP}]},{type:a,value:"\n        wait_time "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:$}]},{type:a,value:"wait_time "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"-- 返回\u003C0，代表超出延迟时间，被拦截"}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:di}]},{type:a,value:"\n        total_permit "},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:$}]},{type:a,value:" consume_permit\n        redis"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bK}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:df}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bN}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:dg},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bM}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:dh},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:J}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bQ}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:bQ}]},{type:a,value:ac},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:cP}]},{type:a,value:" wait_time\n"}]}]}]}]},dir:dj,path:"\u002F中间件\u002F20220617\u002Fredis实现令牌桶",extension:ag,createdAt:aJ,updatedAt:aJ,excerpt:al,title:cW,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20220617\u002Fredis实现令牌桶\u002F",createAt:new Date(1661351874243),updateAt:new Date(1661351874243),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:dj,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20220617\u002F1\u002F"}]},{slug:dk,toc:[{id:bc,depth:G,text:bc},{id:bd,depth:G,text:bd},{id:dl,depth:G,text:dm},{id:dn,depth:G,text:do0},{id:be,depth:G,text:be}],body:{type:_,children:[{type:b,tag:Q,props:{id:dp},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dp}]},{type:a,value:e},{type:b,tag:H,props:{id:bc},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E5%88%9B%E5%BB%BAdashboard",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bc}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"左边菜单的加号➕里创建一个dashboard，添加一个空的panel"}]},{type:a,value:e},{type:b,tag:Q,props:{id:dq},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#dashboard%E9%85%8D%E7%BD%AE",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dq}]},{type:a,value:e},{type:b,tag:H,props:{id:bd},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E4%B8%8B%E6%8B%89%E9%80%89%E6%8B%A9",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bd}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"点击右上角齿轮⚙"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"左边菜单的variables，添加一个参数"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Name，Label：随意"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Type：query"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Refresh：随意，一般on time range change"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Query：tag_values(metrics指标名,tag名称)"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Include All option：开启全选，全选的值是*"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"然后在Preview of values里就会罗列目前有哪些值"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Q,props:{id:"query-tab"},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#query-tab",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"Query tab"}]},{type:a,value:e},{type:b,tag:H,props:{id:dl},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E4%BD%BF%E7%94%A8metric%E7%94%BB%E5%9B%BE",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dm}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Metric\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Metric指标名"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Aggregator：不晓得"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Alias：图里展示这条线的别名"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Down sample\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Down sample：将多久时间里的原始数据进行统计"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Aggregator：统计聚合的方式"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Fill：没数据的点怎么填充"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Filters：可以设置多个tag的过滤，包括使用下拉选择来过滤。\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"key即tag名称"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Type见下Bosun比较类型"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"filter：可以写死某个值，如果有个参数叫env，filter可以填$env，则能下拉选择"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Group by：是否对这个参数分组显示"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Tags：推荐使用Filters"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Rate\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Rate：对数据求导，常用于算QPS，默认单位秒\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Counter：不晓得"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Explicit tags：不晓得"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Delta当前点减前一个点\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Counter：不晓得，但是能计算每个Down sample的数量，例如计算QPM"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:dn},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E4%BD%BF%E7%94%A8bosun%E7%94%BB%E5%9B%BE%E8%AE%A1%E7%AE%97xx%E7%8E%87",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:do0}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Query tab下面选择数据源bosun"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"例如计算成功率，("},{type:b,tag:c,props:{className:[bf,dr]},children:[{type:b,tag:ds,props:{className:[dt],jax:du},children:[{type:b,tag:dv,props:{style:"vertical-align: -0.566ex;",xmlns:dw,width:"14.279ex",height:"2.262ex",role:dx,focusable:bw,viewBox:"0 -750 6311.4 1000",xmlnsXLink:dy},children:[{type:b,tag:dz,props:{},children:[{type:b,tag:ad,props:{id:"MJX-1-TEX-I-1D460",d:"M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-I-1D462",d:"M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-I-1D450",d:"M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-I-1D452",d:"M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-N-2B",d:"M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-N-31",d:"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-N-29",d:"M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-N-2F",d:"M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-1-TEX-N-28",d:"M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"},children:[]}]},{type:b,tag:S,props:{stroke:bg,fill:bg,strokeWidth:aI,transform:dA},children:[{type:b,tag:S,props:{dataMmlNode:bf},children:[{type:b,tag:S,props:{dataMmlNode:am},children:[{type:b,tag:W,props:{dataC:bR,xLinkHref:bS},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(469,0)"},children:[{type:b,tag:W,props:{dataC:"1D462",xLinkHref:"#MJX-1-TEX-I-1D462"},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(1041,0)"},children:[{type:b,tag:W,props:{dataC:dB,xLinkHref:dC},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(1474,0)"},children:[{type:b,tag:W,props:{dataC:dB,xLinkHref:dC},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(1907,0)"},children:[{type:b,tag:W,props:{dataC:"1D452",xLinkHref:"#MJX-1-TEX-I-1D452"},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(2373,0)"},children:[{type:b,tag:W,props:{dataC:bR,xLinkHref:bS},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(2842,0)"},children:[{type:b,tag:W,props:{dataC:bR,xLinkHref:bS},children:[]}]},{type:b,tag:S,props:{dataMmlNode:aP,transform:"translate(3533.2,0)"},children:[{type:b,tag:W,props:{dataC:"2B",xLinkHref:"#MJX-1-TEX-N-2B"},children:[]}]},{type:b,tag:S,props:{dataMmlNode:"mn",transform:"translate(4533.4,0)"},children:[{type:b,tag:W,props:{dataC:"31",xLinkHref:"#MJX-1-TEX-N-31"},children:[]}]},{type:b,tag:S,props:{dataMmlNode:aP,transform:"translate(5033.4,0)"},children:[{type:b,tag:W,props:{dataC:"29",xLinkHref:"#MJX-1-TEX-N-29"},children:[]}]},{type:b,tag:S,props:{dataMmlNode:"TeXAtom",dataMjxTexclass:"ORD",transform:"translate(5422.4,0)"},children:[{type:b,tag:S,props:{dataMmlNode:aP},children:[{type:b,tag:W,props:{dataC:"2F",xLinkHref:"#MJX-1-TEX-N-2F"},children:[]}]}]},{type:b,tag:S,props:{dataMmlNode:aP,transform:"translate(5922.4,0)"},children:[{type:b,tag:W,props:{dataC:"28",xLinkHref:"#MJX-1-TEX-N-28"},children:[]}]}]}]}]}]}]},{type:a,value:"all+1)可以令"},{type:b,tag:c,props:{className:[bf,dr]},children:[{type:b,tag:ds,props:{className:[dt],jax:du},children:[{type:b,tag:dv,props:{style:"vertical-align: -0.186ex;",xmlns:dw,width:"4.934ex",height:"1.756ex",role:dx,focusable:bw,viewBox:"0 -694 2180.8 776",xmlnsXLink:dy},children:[{type:b,tag:dz,props:{},children:[{type:b,tag:ad,props:{id:"MJX-2-TEX-I-1D44E",d:"M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-2-TEX-I-1D459",d:"M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"},children:[]},{type:b,tag:ad,props:{id:"MJX-2-TEX-N-3D",d:"M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"},children:[]}]},{type:b,tag:S,props:{stroke:bg,fill:bg,strokeWidth:aI,transform:dA},children:[{type:b,tag:S,props:{dataMmlNode:bf},children:[{type:b,tag:S,props:{dataMmlNode:am},children:[{type:b,tag:W,props:{dataC:"1D44E",xLinkHref:"#MJX-2-TEX-I-1D44E"},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(529,0)"},children:[{type:b,tag:W,props:{dataC:dD,xLinkHref:dE},children:[]}]},{type:b,tag:S,props:{dataMmlNode:am,transform:"translate(827,0)"},children:[{type:b,tag:W,props:{dataC:dD,xLinkHref:dE},children:[]}]},{type:b,tag:S,props:{dataMmlNode:aP,transform:"translate(1402.8,0)"},children:[{type:b,tag:W,props:{dataC:"3D",xLinkHref:"#MJX-2-TEX-N-3D"},children:[]}]}]}]}]}]}]},{type:a,value:"success=0时，成功率=100%"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[aw,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"$all=q(\"sum:1m-sum-zero:rate{counter,,,diff}:metrics指标名{}{env=$env}\", \"$start\", \"\")\n$success=q(\"sum:1m-sum-zero:rate{counter,,,diff}:metrics指标名{}{env=$env}\", \"$start\", \"\")\n\n($success+1)\u002F($all+1)\n"}]}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:"transform-tab"},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#transform-tab",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"Transform tab"}]},{type:a,value:e},{type:b,tag:H,props:{id:be},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E5%9B%BE%E6%A0%87%E5%88%AB%E5%90%8D",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:be}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Outer join：不晓得，但得先选，不用选择Field name的下拉框"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Organize fields：可以对图标名称起别名"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Q,props:{id:dF},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#%E5%9B%BE%E6%A0%87",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dF}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"右边Panel里有个Legend，把Show打开即有图标，下面的选项可以选择展示图标的哪些参数"}]},{type:a,value:e},{type:b,tag:Q,props:{id:"bosun查询语句格式"},children:[{type:b,tag:j,props:{ariaHidden:p,href:"#bosun%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%A0%BC%E5%BC%8F",tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:"Bosun查询语句格式"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[aw,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"\u003Caggregator\u003E:\u003Cdownsample\u003E:\u003Crate_option\u003E:\u003Ctopk\u003E:\u003Cmetric_name\u003E{\u003Cgroup\u003E}{\u003Cfilter\u003E}\nq(\"sum:30s-sum-zero:rate:xxx.fail{env=*}\", \"1h\", \"\")\n"}]}]}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"aggregator：metrics聚合方式"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"downsample：metrics降采样\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"30s：聚合的时间区间"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"sum：聚合方法"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"zero：空值填充方法"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"rate_option：降采样里的数据的聚合方式，可选\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"应用metircs里面的rate counter, 可以直接写做rate{counter}"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"应用metrics里面的diff，那么写做rate{,,,diff,}"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"应用metrics里面的after_downsample，那么写做rate{,,,,after_downsample}"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Topk：可选\n"},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"例如top-10-max，按照max排序，取前10个"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"metric_name：metric指标名称"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"group：使用tag对数据进行聚合\u002F过滤\n"},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"literal_or：x=literal_or(A|B)：x=(A or B)"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"iliteral_or：大小写不敏感的literal_or"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"not_literal_or：x=not_literal_or(A|B)：x!=(A or B)"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"not_iliteral_or：大小写不敏感的not_literal_or"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"wildcard：通配符，用*占位，一般可以拿来匹配前后缀"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"iwildcard ：大小写不敏感的wildcard"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"regexp：正则"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:b,tag:"style",props:{},children:[{type:a,value:"\nmjx-container[jax=\"SVG\"] {\n  direction: ltr;\n}\n\nmjx-container[jax=\"SVG\"] \u003E svg {\n  overflow: visible;\n  min-height: 1px;\n  min-width: 1px;\n}\n\nmjx-container[jax=\"SVG\"] \u003E svg a {\n  fill: blue;\n  stroke: blue;\n}\n\nmjx-container[jax=\"SVG\"][display=\"true\"] {\n  display: block;\n  text-align: center;\n  margin: 1em 0;\n}\n\nmjx-container[jax=\"SVG\"][display=\"true\"][width=\"full\"] {\n  display: flex;\n}\n\nmjx-container[jax=\"SVG\"][justify=\"left\"] {\n  text-align: left;\n}\n\nmjx-container[jax=\"SVG\"][justify=\"right\"] {\n  text-align: right;\n}\n\ng[data-mml-node=\"merror\"] \u003E g {\n  fill: red;\n  stroke: red;\n}\n\ng[data-mml-node=\"merror\"] \u003E rect[data-background] {\n  fill: yellow;\n  stroke: none;\n}\n\ng[data-mml-node=\"mtable\"] \u003E line[data-line], svg[data-table] \u003E g \u003E line[data-line] {\n  stroke-width: 70px;\n  fill: none;\n}\n\ng[data-mml-node=\"mtable\"] \u003E rect[data-frame], svg[data-table] \u003E g \u003E rect[data-frame] {\n  stroke-width: 70px;\n  fill: none;\n}\n\ng[data-mml-node=\"mtable\"] \u003E .mjx-dashed, svg[data-table] \u003E g \u003E .mjx-dashed {\n  stroke-dasharray: 140;\n}\n\ng[data-mml-node=\"mtable\"] \u003E .mjx-dotted, svg[data-table] \u003E g \u003E .mjx-dotted {\n  stroke-linecap: round;\n  stroke-dasharray: 0,140;\n}\n\ng[data-mml-node=\"mtable\"] \u003E g \u003E svg {\n  overflow: visible;\n}\n\n[jax=\"SVG\"] mjx-tool {\n  display: inline-block;\n  position: relative;\n  width: 0;\n  height: 0;\n}\n\n[jax=\"SVG\"] mjx-tool \u003E mjx-tip {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\nmjx-tool \u003E mjx-tip {\n  display: inline-block;\n  padding: .2em;\n  border: 1px solid #888;\n  font-size: 70%;\n  background-color: #F8F8F8;\n  color: black;\n  box-shadow: 2px 2px 5px #AAAAAA;\n}\n\ng[data-mml-node=\"maction\"][data-toggle] {\n  cursor: pointer;\n}\n\nmjx-status {\n  display: block;\n  position: fixed;\n  left: 1em;\n  bottom: 1em;\n  min-width: 25%;\n  padding: .2em .4em;\n  border: 1px solid #888;\n  font-size: 90%;\n  background-color: #F8F8F8;\n  color: black;\n}\n\nforeignObject[data-mjx-xml] {\n  font-family: initial;\n  line-height: normal;\n  overflow: visible;\n}\n\nmjx-container[jax=\"SVG\"] path[data-c], mjx-container[jax=\"SVG\"] use[data-c] {\n  stroke-width: 3;\n}\n"}]}]},dir:dG,path:"\u002F中间件\u002F20220620\u002Fgrafana与Bosun笔记",extension:ag,createdAt:aJ,updatedAt:aJ,excerpt:al,title:dk,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20220620\u002Fgrafana与Bosun笔记\u002F",createAt:new Date(1661351874243),updateAt:new Date(1661351874243),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:dG,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20220620\u002F1\u002F"}]},{slug:dH,toc:[{id:bh,depth:G,text:bh},{id:bi,depth:G,text:bi},{id:bj,depth:G,text:bj}],body:{type:_,children:[{type:b,tag:Q,props:{id:dI},children:[{type:b,tag:j,props:{href:"#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dI}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"twrp刷入并不成功，目前不晓得啥原因。 但由于没有太需要twrp，所以就先放弃了。 可以直接调到刷rom那步。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"我下载的都是最新的"}]},{type:a,value:e},{type:b,tag:H,props:{id:bh},children:[{type:b,tag:j,props:{href:"#rom%E4%B8%8B%E8%BD%BD",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bh}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"最新的版本貌似永远停留在2020年十二月了。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:dJ,rel:[x,y,z],target:A},children:[{type:a,value:dJ}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"lineageos还有更新"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:dK,rel:[x,y,z],target:A},children:[{type:a,value:dK}]}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[aw,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"taimen-rp1a.201005.004.a1-factory-2f5c4987.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:H,props:{id:bi},children:[{type:b,tag:j,props:{href:"#%E4%B8%8B%E8%BD%BDtwrp",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bi}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"twrp起码到2022三月还有更新。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:dL,rel:[x,y,z],target:A},children:[{type:a,value:dL}]}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[aw,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"twrp-3.6.1_9-0-taimen.img\ntwrp-installer-3.6.1_9-0-taimen.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:H,props:{id:bj},children:[{type:b,tag:j,props:{href:"#%E4%B8%8B%E8%BD%BDfastboot",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bj}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"ubuntu安装安卓的fastboot，在安装ROM时提示版本太低，还是去官网下载了个新的"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:j,props:{href:dM,rel:[x,y,z],target:A},children:[{type:a,value:dM}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:dN},children:[{type:b,tag:j,props:{href:"#%E8%A7%A3%E9%94%81",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dN}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"待补充。我买到手已经是解锁了的，所以没操作"}]},{type:a,value:e},{type:b,tag:Q,props:{id:dO},children:[{type:b,tag:j,props:{href:"#%E6%AD%A5%E9%AA%A4",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dO}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:bT}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:dP}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:bU}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Q,props:{id:bT},children:[{type:b,tag:j,props:{href:"#%E5%88%B7%E5%85%A5%E4%B8%B4%E6%97%B6twrp",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bT}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"adb devices"}]},{type:a,value:"查看设备列表"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"关机后同时按开机键和音量下键\u002F"},{type:b,tag:k,props:{},children:[{type:a,value:"adb reboot bootloader"}]},{type:a,value:"进入bootloader模式"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:dQ}]},{type:a,value:dR}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"fastboot boot twrp-3.6.1_9-0-taimen.img"}]},{type:a,value:"刷入"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Q,props:{id:"刷入rom"},children:[{type:b,tag:j,props:{href:"#%E5%88%B7%E5%85%A5rom",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:dP}]},{type:a,value:e},{type:b,tag:T,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"解压fastboot工具和rom"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"将解压出来的fastboot文件夹里的全部文件拷贝一份到rom的文件夹里"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"得把fastboot文件夹里全部文件都拷贝，会依赖到文件夹里其他文件，不然刷到中途会失败"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"修改一下"},{type:b,tag:k,props:{},children:[{type:a,value:dS}]},{type:a,value:"，改成使用当前路径的fastboot"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"手机进入fastboot模式"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:dQ}]},{type:a,value:dR}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"直接"},{type:b,tag:k,props:{},children:[{type:a,value:dS}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"或者"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[aw,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"adb sideload taimen-rp1a.201005.004.a1-factory-2f5c4987.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:bU},children:[{type:b,tag:j,props:{href:"#%E5%88%B7%E5%85%A5%E6%B0%B8%E4%B9%85twrp",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bU}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"选择高级 \u003E sideload进入sideload"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[aw,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"adb sideload twrp-installer-3.6.1_9-0-taimen.zip\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"其他"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"这里主要说下进入recovery的方式：首先进入fastboot，然后通过音量键进入recovery，首次进入会看到一个\"no command\"的界面，当出现这个界面后需要长按power键，然后按一下音量up键，这样才能进入recovery模式；"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:bI}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dT,rel:[x,y,z],target:A},children:[{type:a,value:dT}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dU,rel:[x,y,z],target:A},children:[{type:a,value:dU}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dV,rel:[x,y,z],target:A},children:[{type:a,value:dV}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dW,rel:[x,y,z],target:A},children:[{type:a,value:dW}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:bk,rel:[x,y,z],target:A},children:[{type:a,value:bk}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:bk,rel:[x,y,z],target:A},children:[{type:a,value:bk}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dX,rel:[x,y,z],target:A},children:[{type:a,value:dX}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dY,rel:[x,y,z],target:A},children:[{type:a,value:dY}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"电信破解相关的"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:dZ,rel:[x,y,z],target:A},children:[{type:a,value:dZ}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:d_,rel:[x,y,z],target:A},children:[{type:a,value:d_}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:d$,rel:[x,y,z],target:A},children:[{type:a,value:d$}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ea,rel:[x,y,z],target:A},children:[{type:a,value:ea}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eb,rel:[x,y,z],target:A},children:[{type:a,value:eb}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ec,rel:[x,y,z],target:A},children:[{type:a,value:ec}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"无需root电信破解"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ed,rel:[x,y,z],target:A},children:[{type:a,value:ed}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"一代的"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ee,rel:[x,y,z],target:A},children:[{type:a,value:ee}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ef,rel:[x,y,z],target:A},children:[{type:a,value:ef}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eg,rel:[x,y,z],target:A},children:[{type:a,value:eg}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eh,rel:[x,y,z],target:A},children:[{type:a,value:eh}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ei,rel:[x,y,z],target:A},children:[{type:a,value:ei}]}]},{type:a,value:e}]}]},dir:ej,path:"\u002F折腾\u002F20220425\u002FPixel2xl刷机手记",extension:ag,createdAt:aB,updatedAt:aB,excerpt:al,title:dH,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220425\u002FPixel2xl刷机手记\u002F",createAt:new Date(1661351874247),updateAt:new Date(1661351874247),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:ej,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220425\u002F1\u002F"}]},{slug:ek,toc:[{id:bl,depth:G,text:bl},{id:bm,depth:G,text:bm}],body:{type:_,children:[{type:b,tag:Q,props:{id:el},children:[{type:b,tag:j,props:{href:"#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:el}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"鄙人有多个谷歌账号，在不同的电脑里使用。\n时间一长，不同账号和电脑的书签就会产生差异，很容易丢书签。\n虽然chrome对同一个账号，能在不同电脑之间同步书签。\n但是如果有设备长时间未离线后同步，会出现把已经删掉的书签又加回去的情况。\n并且我希望书签能在多个账号直接保持同步。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"其实找类似的功能的软件，没有一年也有半年了，始终无果。\n后来我意识到一个问题，不同账号的书签合并，跟合代码一样，是有可能发生冲突的，这个冲突显然没太多的办法进行自动处理。\n便最后还是决定自己写工具来手动定期合并书签罢。"}]},{type:a,value:e},{type:b,tag:Q,props:{id:em},children:[{type:b,tag:j,props:{href:"#chrome%E4%B9%A6%E7%AD%BE%E7%BB%93%E6%9E%84",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:em}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"从chrome导出的书签html其实只是个xml，折腾xml的结构折腾了好久。\n一是chrome的书签xml结构设计就不好解析，二是go的xml工具还是稀烂的。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"结构式最核心的是"},{type:b,tag:k,props:{},children:[{type:a,value:ab}]},{type:a,value:en},{type:b,tag:k,props:{},children:[{type:a,value:ab}]},{type:a,value:"标签有两种类型，分别是链接类型和文件夹类型。"}]},{type:a,value:e},{type:b,tag:H,props:{id:bl},children:[{type:b,tag:j,props:{href:"#%E9%93%BE%E6%8E%A5%E7%B1%BB%E5%9E%8B",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bl}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:ab}]},{type:a,value:"标签里面包住一个"},{type:b,tag:k,props:{},children:[{type:a,value:j}]},{type:a,value:en},{type:b,tag:k,props:{},children:[{type:a,value:j}]},{type:a,value:"标签就是书签的具体信息。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[eo,P]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:j}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,"attr-name"]},children:[{type:a,value:"href"}]},{type:b,tag:c,props:{className:[d,"attr-value"]},children:[{type:b,tag:c,props:{className:[d,f,"attr-equals"]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ep}]},{type:a,value:"https:\u002F\u002Fwww.google.com\u002F"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ep}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:"google"},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:H,props:{id:bm},children:[{type:b,tag:j,props:{href:"#%E6%96%87%E4%BB%B6%E5%A4%B9%E7%B1%BB%E5%9E%8B",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bm}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"文件夹类型的"},{type:b,tag:k,props:{},children:[{type:a,value:ab}]},{type:a,value:"标签里，直接子标签是没有"},{type:b,tag:k,props:{},children:[{type:a,value:j}]},{type:a,value:"标签的。\n而是第一个表示是"},{type:b,tag:k,props:{},children:[{type:a,value:aW}]},{type:a,value:"，记录这个文件夹的名称。\n然后再有一个"},{type:b,tag:k,props:{},children:[{type:a,value:bn}]},{type:a,value:"标签，包含着文件夹里所包含的内容。\n文件夹里既可以包含链接也可以包含文件夹，所以在"},{type:b,tag:k,props:{},children:[{type:a,value:bn}]},{type:a,value:"标签所包含的是多个"},{type:b,tag:k,props:{},children:[{type:a,value:ab}]},{type:a,value:"标签。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[eo,P]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:aW}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:"搜索引擎"},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:aW}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:bn}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:eq},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:az}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:eq},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:bn}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aG}]},{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:Z}]}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:er},children:[{type:b,tag:j,props:{href:"#%E4%B9%A6%E7%AD%BE%E8%A7%A3%E6%9E%90",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:er}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"书签的xml没有id和class，不能直接映射为结构体，书签也不闭合，还需要递归解析，添加了不少难度。\n经过了两天折腾，解析思路是把xml导到"},{type:b,tag:k,props:{},children:[{type:a,value:"github.com\u002FPuerkitoBio\u002Fgoquery"}]},{type:a,value:"当html解析。\n"},{type:b,tag:k,props:{},children:[{type:a,value:es}]},{type:a,value:"会给xml外面自动包和html、head和body。\n然后"},{type:b,tag:k,props:{},children:[{type:a,value:es}]},{type:a,value:"的选择器都以body绝对的开始标签，往后加定位标签。相当于用“绝对路径”而不是“相对路径”。\n一开始递归想用“相对路径”，但是翻遍github，go就没库能支持，浪费了很多时间。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"详细看代码吧："},{type:b,tag:j,props:{href:et,rel:[x,y,z],target:A},children:[{type:a,value:et}]}]},{type:a,value:e},{type:b,tag:Q,props:{id:eu},children:[{type:b,tag:j,props:{href:"#%E4%BD%BF%E7%94%A8",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:eu}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"将xml转成csv，对全部书签进行排序，输出到csv文件保持到github上。\n排序的规则的，不考虑请求协议，将域名倒过来，后面再接上path。\n例如"},{type:b,tag:k,props:{},children:[{type:a,value:"https:\u002F\u002Fwww.google.com\u002Fa?b=c#d"}]},{type:a,value:" ，排序的key是 "},{type:b,tag:k,props:{},children:[{type:a,value:"moc.elgoog.www\u002Fa?b=c#d"}]},{type:a,value:"。\n能让域名相近或者二级三级域名的放在一起。\n通过github版本管理管理书签，github上的书签作为冷备份。\n需要使用时将csv转回xml，通过floccus来进行热同步。"}]}]},dir:ev,path:"\u002F折腾\u002F20220430\u002Fchrome书签合并脚本",extension:ag,createdAt:aB,updatedAt:aB,excerpt:al,title:ek,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220430\u002Fchrome书签合并脚本\u002F",createAt:new Date(1661351874247),updateAt:new Date(1661351874247),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:ev,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220430\u002F1\u002F"}]},{slug:ew,toc:[{id:bo,depth:G,text:bo},{id:bp,depth:G,text:bp},{id:bq,depth:G,text:bq},{id:br,depth:G,text:br},{id:bs,depth:G,text:bs}],body:{type:_,children:[{type:b,tag:H,props:{id:bo},children:[{type:b,tag:j,props:{href:"#%E5%88%86%E5%B7%A5",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bo}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"node-exporter：安装在每台主机上，用于收集主机数据"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"prometheus：会去每台主机的node-exporter拉取收集数据"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"grafana：查询prometheus的数据用于展示"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:bp},children:[{type:b,tag:j,props:{href:"#%E5%AE%89%E8%A3%85exporter",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bp}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"运行起来大约只会消耗10M左右的内存"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ex,rel:[x,y,z],target:A},children:[{type:a,value:ex}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ey,rel:[x,y,z],target:A},children:[{type:a,value:ey}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[ak,P]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#port=9100"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" node-exporter "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:"--net"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:ez}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:"--pid"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:ez}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:eA}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\nprom\u002Fnode-exporter "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:"--path.rootfs"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:"\u002Fhost\n\n"},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" mysqld-exporter "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"9104"}]},{type:a,value:":9104 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aK}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aL,o]},children:[{type:a,value:"DATA_SOURCE_NAME"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"\"user:pw@(ip:port)\u002F\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\nprom\u002Fmysqld-exporter\n\n"},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" redis-exporter "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"9121"}]},{type:a,value:":9121 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:eA}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\nbitnami\u002Fredis-exporter "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:"--redis.addr"}]},{type:a,value:" redis:\u002F\u002Fip:port "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:"--redis.password"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'pw'"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"浏览器打开"},{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002Fip:9100\u002Fmetrics"}]},{type:a,value:" ，如果有东西就算安装完了"}]},{type:a,value:e},{type:b,tag:H,props:{id:bq},children:[{type:b,tag:j,props:{href:"#%E5%AE%89%E8%A3%85prometheus",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bq}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eB,rel:[x,y,z],target:A},children:[{type:a,value:eB}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eC,rel:[x,y,z],target:A},children:[{type:a,value:eC}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"配置文件，看网上说数据默认过期是30日，但是没找到通过配置文件修改过期时间的方法"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[ak,P]},children:[{type:b,tag:k,props:{},children:[{type:a,value:"global:\n  scrape_interval: 1m "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#默认情况下抓取目标的频率"}]},{type:a,value:"\n  scrape_timeout: 10s "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#刮取请求超时的时间"}]},{type:a,value:"\n  evaluation_interval: 1m "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#评估规则的频率"}]},{type:a,value:"\n\nscrape_configs: "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"#抓取配置列表"}]},{type:a,value:"\n  - job_name: linux\n    metrics_path: "},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'\u002Fmetrics'"}]},{type:a,value:"\n    basic_auth:\n      username: "},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:eD}]},{type:a,value:"\n      password: "},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:eD}]},{type:a,value:"\n    static_configs:\n      - targets: "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ax}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'ip:port'"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ay}]},{type:a,value:"\n        labels:\n          instance: 实例名称\n"}]}]}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[ak,P]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:" prometheus "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:"9090"}]},{type:a,value:":9090 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" \u002Fprometheus.yml:\u002Fetc\u002Fprometheus\u002Fprometheus.yml "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\nprom\u002Fprometheus\n"}]}]}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002Fip:9090\u002Fmetrics"}]},{type:a,value:eE}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002Fip:9090\u002Fgraph"}]},{type:a,value:eE}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:k,props:{},children:[{type:a,value:"http:\u002F\u002Fip:9090\u002Ftargets"}]},{type:a,value:" ：有机器列表，有"},{type:b,tag:k,props:{},children:[{type:a,value:"UP"}]},{type:a,value:"就是正常"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:br},children:[{type:b,tag:j,props:{href:"#grafana%E5%AE%89%E8%A3%85",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:br}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"略过"}]},{type:a,value:e},{type:b,tag:H,props:{id:bs},children:[{type:b,tag:j,props:{href:"#grafana%E9%85%8D%E7%BD%AE",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bs}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在左边菜单的齿轮进入plugins，安装prometheus插件。\n填URL、Basic auth，HTTP Method选GET。最后save and test。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"下载grafana模板的json。\n推荐用"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgrafana.com\u002Fgrafana\u002Fdashboards\u002F8919%E7%9A%842020%E5%B9%B4%E7%89%88%E6%9C%AC%EF%BC%8C2022%E7%89%88%E6%9C%AC%E5%A5%BD%E5%83%8F%E6%9C%89bug%EF%BC%8C%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%B2%A1%E6%98%BE%E7%A4%BA%E3%80%82",rel:[x,y,z],target:A},children:[{type:a,value:"https:\u002F\u002Fgrafana.com\u002Fgrafana\u002Fdashboards\u002F8919的2020年版本，2022版本好像有bug，磁盘数据没显示。"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"在左边dashboards菜单里，选import，导入刚下载的json文件。\nVictoriaMetrics选刚创建的prometheus数据源。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aS}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eF,rel:[x,y,z],target:A},children:[{type:a,value:eF}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eG,rel:[x,y,z],target:A},children:[{type:a,value:eG}]}]},{type:a,value:e}]}]},dir:eH,path:"\u002F折腾\u002F20220702\u002Fgrafana+prometheus+node-exporter搭建监控",extension:ag,createdAt:aB,updatedAt:aB,excerpt:al,title:ew,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220702\u002Fgrafana+prometheus+node-exporter搭建监控\u002F",createAt:new Date(1661351874247),updateAt:new Date(1661351874247),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:eH,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220702\u002F1\u002F"}]},{slug:eI,toc:[{id:aH,depth:G,text:aH},{id:bt,depth:G,text:bt},{id:bu,depth:G,text:bu}],body:{type:_,children:[{type:b,tag:h,props:{},children:[{type:a,value:"我没有苹果系的东西，app的密码基本我都是自己记的，对密码同步需求几乎都在汗牛充栋的web密码。\n一直以来都有听闻各种密码管理器，1Password、keepass的，但由于感觉迁移有风险"},{type:b,tag:"del",props:{},children:[{type:a,value:"懒"}]},{type:a,value:"，所以一直在使用谷歌浏览器来同步密码。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"直到在v2ex看了篇文章"},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F872745",rel:[x,y,z],target:A},children:[{type:a,value:"chrome 密码泄漏了， 才知道用 chrome 保存密码等于裸奔"}]},{type:a,value:"。\n对于谷歌浏览器的明文存储还是太过震撼。还是铁定了心迁移吧。"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"选型直接选v2ex文章里介绍的bitwarden（vaultwarden）了。\nbitwarden是一套服务端客户端都开源的密码管理套件。\n但官方的服务端资源消耗太大，所以有人用rust重写过了服务端，原名bitwarden_rs，现改名叫vaultwarden。\nvaultwarden直接提供docker镜像，存储默认使用sqlite。"}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eJ,rel:[x,y,z],target:A},children:[{type:a,value:eJ}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:eK,rel:[x,y,z],target:A},children:[{type:a,value:eK}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:aH},children:[{type:b,tag:j,props:{href:"#%E5%AE%89%E8%A3%85",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:aH}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"先启动服务，进"},{type:b,tag:k,props:{},children:[{type:a,value:"ip:port:7808"}]},{type:a,value:"就可以注册。这里得先注册一个账号。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[ak,P]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:" volume create vaultwarden_data\n"},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:eL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" vaultwarden_data:\u002Fdata "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:eM}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\n  vaultwarden\u002Fserver:alpine\n\n\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"注册完之后，就能进入个人页面了。\n但显然这样子阿猫阿狗都能来注册，是不行的。\n我们把实例删掉，加两个环境变量，禁止新用户注册和不允许邀请用户，再创建一个新的实例。\n新实例起来之后，就不能在注册了。"}]},{type:a,value:e},{type:b,tag:M,props:{className:[N]},children:[{type:b,tag:O,props:{className:[ak,P]},children:[{type:b,tag:k,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:af}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aq}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:at}]},{type:a,value:eL},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aK}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aL,o]},children:[{type:a,value:"SIGNUPS_ALLOWED"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:eN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aK}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aL,o]},children:[{type:a,value:"INVITATIONS_ALLOWED"}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:C}]},{type:a,value:eN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:au}]},{type:a,value:" vaultwarden_data:\u002Fdata\u002F "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,t,o]},children:[{type:a,value:aC}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,K]},children:[{type:a,value:eM}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\n  vaultwarden\u002Fserver:alpine\n"}]}]}]},{type:a,value:e},{type:b,tag:H,props:{id:bt},children:[{type:b,tag:j,props:{href:"#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bt}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"待体验"}]},{type:a,value:e},{type:b,tag:H,props:{id:bu},children:[{type:b,tag:j,props:{href:"#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD",ariaHidden:p,tabIndex:q},children:[{type:b,tag:c,props:{className:[r,s]},children:[]}]},{type:a,value:bu}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"待研究"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:aS}]},{type:a,value:e},{type:b,tag:R,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Flaosu.ml\u002F2020\u002F07\u002F18\u002F%E7%94%A8bitwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"https:\u002F\u002Flaosu.ml\u002F2020\u002F07\u002F18\u002F用bitwarden自建密码管理系统\u002F"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fblog.ous50.moe\u002F2021\u002F03\u002F12\u002Fvaultwarden%E6%90%AD%E5%BB%BA\u002F",rel:[x,y,z],target:A},children:[{type:a,value:"https:\u002F\u002Fblog.ous50.moe\u002F2021\u002F03\u002F12\u002Fvaultwarden搭建\u002F"}]}]},{type:a,value:e}]}]},dir:eO,path:"\u002F折腾\u002F20220824\u002F安装bitwardenrs密码管理器",extension:ag,createdAt:aB,updatedAt:aB,excerpt:al,title:eI,url:"\u002Fblog-code\u002Fview\u002F折腾\u002F20220824\u002F安装bitwardenrs密码管理器\u002F",createAt:new Date(1661351874247),updateAt:new Date(1661351874247),attributes:[{name:ah,value:U},{name:ai,value:U},{name:aj,value:eO,url:"\u002Fblog-code\u002Fpage\u002F折腾\u002F20220824\u002F1\u002F"}]}]}],fetch:{},mutations:al}}("text","element","span","token","\n","punctuation","li","p"," ","a","code",":","key","atrule","variable","true",-1,"icon","icon-link","parameter","\\","operator","\n  ","nofollow","noopener","noreferrer","_blank","function","=","keyword","string","comment",2,"h2","(",")","number","tag","div","nuxt-content-highlight","pre","line-numbers","h1","ul","g","ol","2022-08-24",",","use","\n    ",".","\u003E","root","-","local","dt","\n\n","path","sudo","docker",".md","createAt","updateAt","sort","language-shell",void 0,"mi","{","}"," run ","-d","--restart","always ","--name","-v","\n          ","language-text","[","]","\u003C","wide","2022-08-24T14:37:54.247Z","-p","boolean","\n      ","tonumber","\u003C\u002F","安装","0","2022-08-24T14:37:54.243Z","-e","assign-left","func","ARGV"," total_permit ","mo","important","1","参考文章","mentable","读操作","写操作","h3","\u002F","2022-08-24T14:37:54.239Z","添加分析","分析类型","分析可视化","可视化的菜单","原因分析","创建dashboard","下拉选择","图标别名","math","currentColor","rom下载","下载twrp","下载fastboot","https:\u002F\u002Fblog.csdn.net\u002Fweixin_45472158\u002Farticle\u002Fdetails\u002F108441357","链接类型","文件夹类型","dl","分工","安装exporter","安装prometheus","grafana安装","grafana配置","客户端使用","数据备份",":80 ","false","\n        "," http","RocksDB是一个嵌入式的KV数据库，由Facebook基于levelDB开发。\n多数情况下，看一把RocksDB看做是一个在本地的，数据落盘的，大数据量的Redis，且访问性能高于远端的Redis。\nRocksDB底层使用LSM树实现，但LSM树实际上并不是一棵具体的树，其实是一套存储处理算法。\nLSM树对KV的持久化，保持较高性能的读的基础上，实现了追加写，提供了写入的性能。","language-go","package"," main\n\n","import","_","ctx context","Context","ctx","参考文献"," bucket_cap ","pcall"," key","\"last_time\"","\"curr_permit\"","if","then","end","1D460","#MJX-1-TEX-I-1D460","刷入临时twrp","刷入永久twrp","\u002Fblog-code\u002Fpage\u002F1\u002F",10000,"青春猪头-牧之原翔子-江之岛",2022,"grafana+loki+promtail搭建轻量日志系统","2022-01-16T00:00:00.000Z","夜深，好困，长话短说。","loki：存储查询日志的服务，对外提供一个http端口","promtail：收集日志，把日志发生到loki里进行管理","grafana：可以通过loki的接口查询日志","预备工作","grafana","loki","https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Fconfiguration\u002F","language-yaml","server","http_listen_port","3100","grpc_listen_port","store"," 720h ","-config.file","promtail","https:\u002F\u002Fgrafana.com\u002Fdocs\u002Floki\u002Flatest\u002Fclients\u002Fpromtail\u002Fconfiguration\u002F","labels","查询","\u002F折腾\u002F20220116","2022-01-16","RocksDB初步了解","wal","WAL","sstable","SSTable","compaction","Compaction","column-family","Column Family","\u002F中间件\u002F20220304","README","https:\u002F\u002Fcode.cellargalaxy.top\u002F","记一次go内存泄漏排查","main","\":6060\"",":="," engine","ResetLogId","flush"," context","return","https:\u002F\u002Fgolang2.eddycjy.com\u002Fposts\u002Fch6\u002F01-pprof-1\u002F","\u002Fgolang\u002F20220804","OLTP、OLAP与HTAP","https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1706006","https:\u002F\u002Fblog.51cto.com\u002Fkymdidicom\u002F3145671","\u002F中间件\u002F20220428","redis实现令牌桶"," consume_permit ","2"," max_wait "," period ","limit","or"," curr_permit "," new_permit ","\n    total_permit "," wait_time ","\"HMSET\""," total_permit"," curr_time","else","\u002F中间件\u002F20220617","grafana与Bosun笔记","使用metric画图","使用Metric画图","使用bosun画图计算xx率","使用Bosun画图(计算XX率)","左侧菜单","dashboard配置","math-inline","mjx-container","MathJax","SVG","svg","http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg","img","http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxlink","defs","scale(1,-1)","1D450","#MJX-1-TEX-I-1D450","1D459","#MJX-2-TEX-I-1D459","图标","\u002F中间件\u002F20220620","Pixel2xl刷机手记","前期准备","https:\u002F\u002Fdevelopers.google.com\u002Fandroid\u002Fimages#taimen","https:\u002F\u002Fdownload.lineageos.org\u002Ftaimen","https:\u002F\u002Ftwrp.me\u002Fgoogle\u002Fgooglepixel2xl.html","https:\u002F\u002Fdeveloper.android.com\u002Fstudio\u002Freleases\u002Fplatform-tools","解锁","步骤","刷入ROM","fastboot devices","检查设备列表","flash-all.sh","https:\u002F\u002Freallysnow.moe\u002Farchives\u002F244.html","https:\u002F\u002Flemisky.github.io\u002F2020\u002F11\u002F30\u002FPixel-XL-%E5%88%B7%E6%9C%BA%E7%9B%B8%E5%85%B3\u002F","https:\u002F\u002Fwww.jianshu.com\u002Fp\u002F4017e9d6541c","https:\u002F\u002Fwww.itfanr.cc\u002F2018\u002F10\u002F16\u002Fgoogle-pixel-unlock-bl-and-root\u002F","https:\u002F\u002Fblog.csdn.net\u002Fachirandliu\u002Farticle\u002Fdetails\u002F105028423","https:\u002F\u002Fceshidao.com\u002Fhow-to-get-magisk-working-on-pixel-2-xl\u002F","https:\u002F\u002Fsandyfffeng.com\u002F2020\u002F05\u002F24\u002Fgoogle-pixel-2-%E7%A0%B4%E8%A7%A3%E7%94%B5%E4%BF%A14g-%E5%85%A8%E6%95%99%E7%A8%8B%EF%BC%88mac-windows-%E9%80%9A%E7%94%A8%EF%BC%89\u002F","https:\u002F\u002Fblog.isteed.cc\u002Fpost\u002F4291184207\u002F","https:\u002F\u002Fgist.github.com\u002Fcoeusite\u002F86f6318c13c5bc15aef13345f1bb3ed4","https:\u002F\u002Fwww.jianshu.com\u002Fp\u002F075ed256a85d","https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F395935","https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F598302","https:\u002F\u002Fandroid.poppur.com\u002Fjiaocheng\u002F10416.html","https:\u002F\u002Fwww.berlinchan.com\u002F2019\u002F09\u002Fupdate-android-10-and-flash-modem-for-china-telecom-4g","https:\u002F\u002Fwww.somedoc.net\u002F?p=4263","http:\u002F\u002Fwww.gandalf.site\u002F2018\u002F11\u002Fgoogle-pixel-4g.html","https:\u002F\u002Fwww.v2ex.com\u002Ft\u002F429528","https:\u002F\u002Fericclose.github.io\u002FPixel-modem-mod-for-China-Telecom.html","\u002F折腾\u002F20220425","chrome书签合并脚本","需求背景","chrome书签结构","标签，","language-xml","\"","...","书签解析","goquery","https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002Fgo_common\u002Fblob\u002Fmain\u002Ftool\u002Fbookmark.go","使用","\u002F折腾\u002F20220430","grafana+prometheus+node-exporter搭建监控","https:\u002F\u002Fgithub.com\u002Fprometheus\u002Fnode_exporter","https:\u002F\u002Fhub.docker.com\u002Fr\u002Fprom\u002Fnode-exporter","\"host\"","\"\u002F:\u002Fhost:ro,rslave\"","https:\u002F\u002Fprometheus.io\u002Fdocs\u002Fprometheus\u002Flatest\u002Finstallation\u002F","https:\u002F\u002Fhub.docker.com\u002Fr\u002Fprom\u002Fprometheus","'admin'"," ：有页面显示","https:\u002F\u002Fblog.csdn.net\u002Fqq_37688023\u002Farticle\u002Fdetails\u002F106532101","https:\u002F\u002Fwww.fyovo.com\u002F6180.html","\u002F折腾\u002F20220702","安装bitwardenrs密码管理器","https:\u002F\u002Fgithub.com\u002Fdani-garcia\u002Fvaultwarden","https:\u002F\u002Fhub.docker.com\u002Fr\u002Fvaultwarden\u002Fserver"," vaultwarden ","7808","false ","\u002F折腾\u002F20220824")));