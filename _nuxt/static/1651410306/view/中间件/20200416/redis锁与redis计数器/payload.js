__NUXT_JSONP__("/view/%E4%B8%AD%E9%97%B4%E4%BB%B6/20200416/redis%E9%94%81%E4%B8%8Eredis%E8%AE%A1%E6%95%B0%E5%99%A8", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP){return {data:[{navbarConfig:{brandText:aT,brandUrl:"\u002Fblog-code\u002F",navs:[{text:"文章",url:"\u002Fblog-code\u002Fpage\u002F1\u002F"},{text:"归档",url:"\u002Fblog-code\u002Farchive\u002F0\u002F"},{text:"画画",url:"\u002Fblog-code\u002Fhtml\u002Fhua.html"},{text:"开源",url:"\u002Fblog-code\u002Fhttps:\u002Fgithub.com\u002Fcellargalaxy\u002Fblog-vue"}]},homeConfig:{brandInterval:10000,brands:[{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F01\u002F21\u002FmMEAnwY5XPC2pFb.jpg",title:"日常",texts:["我们所度过的每个平凡的日常，也许就是连续不断发生的奇迹。","日々、私たちが過ごしている日常は、実は奇跡の連続なのかもしれない。"]},{imageUrl:"https:\u002F\u002Fi.loli.net\u002F2020\u002F04\u002F19\u002FH1MmXb9xPcYEhT2.jpg",title:"昨日之歌",texts:["时间梭梭箭如飞，人道漫漫步蹒跚","人間そんな変わるもんじゃないのに、月日ばっかどんどん過ぎて"]}],navs:[{text:"Github",url:"https:\u002F\u002Fgithub.com\u002Fcellargalaxy\u002F"}]},pageFootConfig:{lines:[[{text:"Copyright © 2017-? ."},{text:"备案？不存在的"},{text:"Powered by Nuxt.js & Github"}]]},buildTime:new Date(1651410313305),siteName:aT,file:{slug:aU,description:ay,createdAt:aV,updatedAt:aV,toc:[{id:aW,depth:2,text:aX}],body:{type:aY,children:[{type:b,tag:s,props:{},children:[{type:a,value:ay}]},{type:a,value:h},{type:a,value:h},{type:b,tag:P,props:{id:aZ},children:[{type:b,tag:x,props:{href:"#%E5%9C%BA%E6%99%AF%E4%B8%8E%E9%97%AE%E9%A2%98",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:aZ}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"有个定时任务，每到整点执行当前小时的任务。也就14点执行14点任务，15点执行15点任务，到了15点，哪怕14点任务还没执行也不用再执行了。原则，重复执行比不执行好。以前多节点执行任务也是使用了redis锁，逻辑是以小时为key，获取了锁的节点把key的超时时间设置为两个小时，避免其他节点能在拿到锁。但据说出现过问题，一两月下来突然有一两个任务执行失败了，至于什么问题由于历史久远已经无从查起。"}]},{type:a,value:h},{type:b,tag:P,props:{id:a_},children:[{type:b,tag:x,props:{href:"#%E7%8E%B0%E6%9C%89%E7%9A%84redis%E9%94%81%E9%80%BB%E8%BE%91",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:a_}]},{type:a,value:h},{type:b,tag:ae,props:{className:[af]},children:[{type:b,tag:ag,props:{className:[ah,az]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:a$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"AutoPushRedisImpl"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,ba,e]},children:[{type:a,value:"@Autowired"}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:am}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bc}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"TimeUnit"}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"redisTemplate"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bf}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"setIfAbsent"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"\""}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"+"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"System"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"currentTimeMillis"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:"\n            redisTemplate"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"expire"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:"\n        redisTemplate"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"delete"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"先从理论上说，这种实现会有两个问题。一是加锁的时间没有带上持锁人的信息，解锁的时候容易导致把别人的锁解了。二是如果setIfAbsent执行成功之后突然挂了，没能执行expire，那锁就永远都不会过期了。结合这个场景进行分析。第一点，锁是不用主动解的，实际上unLock方法就没被调用。设置了两小时过期时间，两小时之后就不会执行这个任务了，也不会有实例抢这个锁（当然前提是全部实例的时间都是对的）。而第二点，setIfAbsent执行成功后就报错了，锁永远不过时，其他节点无法执行这个任务，而这个节点又没执行这个任务，确实会导致描述里的问题。我本来觉得第二点虽然理论上可能会发生，但实际概率估计很小。不过现在想来服务器都在海外，网络波动应该是不可避免的才对。setIfAbsent的请求到redis，设置成功了，突然网络波动连接断开，setIfAbsent报错，也很合理。"}]},{type:a,value:h},{type:b,tag:P,props:{id:bh},children:[{type:b,tag:x,props:{href:"#%E6%94%B9%E8%BF%9B%E6%80%9D%E8%B7%AF",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:bh}]},{type:a,value:h},{type:b,tag:aB,props:{},children:[{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"自然是修复redis锁的逻辑bug"}]},{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"增加一个任务执行失败后的有限重试机制"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"上面猜测setIfAbsent报错导致任务执行失败，但不止setIfAbsent的报错会导致任务执行失败。因此需要在任务由于任何原因执行失败之后，其他节点都能够重试这个任务。为了实现第二点，我的思路是，例如任务执行大约需要一分钟，那么节点获取锁之后给key设置十分钟的过期时间，足够执行任务。当任务执行完成，把key的过期时间设置为两小时，避免任务被重复执行。当任务执行抛异常被捕抓到，主动释放锁，或者当任务执行被强制中断，没能主动释放锁，但由于锁十分钟之后也会自动过期。所以没把key的过期时间修改两小时的任务都视为未能完成的任务，最后会因为锁的释放被重新执行。然后在redis记录任务执行的次数，当执行次数已经超过最大值，哪怕获取到锁也不再执行任务。这里由于是获取到锁才给执行次数加一，所以不要考虑并发问题。"}]},{type:a,value:h},{type:b,tag:P,props:{id:bi},children:[{type:b,tag:x,props:{href:"#redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:bi}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"依赖，这里jedis的版本由spring-boot-starter-redis决定。"}]},{type:a,value:h},{type:b,tag:ae,props:{className:[af]},children:[{type:b,tag:ag,props:{className:[ah,"language-xml"]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:an}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:"redis.clients"},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Z}]},{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Z}]},{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Z}]},{type:a,value:an}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:an}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:"org.springframework.boot"},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Z}]},{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:"spring-boot-starter-redis"},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Z}]},{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Z}]},{type:a,value:an}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"获取锁使用了Jedis的set方法，使得key不存在时才设置值以及给key设置过期时间是一个原子操作。在jedis新一点版本的set方法略有不同，NX和EX操作封装了个参数对象，大同小异。"}]},{type:a,value:h},{type:b,tag:ae,props:{className:[af]},children:[{type:b,tag:ag,props:{className:[ah,az]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,E]},children:[{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:"lombok"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"extern"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"slf4j"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"Slf4j"}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,E]},children:[{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bm},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,E]},children:[{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bm},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:am}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,E]},children:[{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"clients"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aD},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,E]},children:[{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bo},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ak}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,E]},children:[{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bo},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"UUID"}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aD},{type:b,tag:c,props:{className:[d,ba,e]},children:[{type:a,value:"@Slf4j"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:a$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,br,bs]},children:[{type:a,value:"\u002F**\n     * key不存在时才设置值\n     *\u002F"}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:" SET_IF_NOT_EXIST "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"NX\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,br,bs]},children:[{type:a,value:"\u002F**\n     * 过期时间单位标识，EX：秒\n     *\u002F"}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:" SET_WITH_EXPIRE_TIME "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"EX\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:" OK "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"OK\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ar}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"Long"}]},{type:a,value:" SUCCESS "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"1L"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,as]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:bt},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:am}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"redisTemplate "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"instanceId "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:" UUID"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"randomUUID"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"toString"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bv}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bx}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:by}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bz}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,as]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aJ}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aL},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aM}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"set"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bt},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" SET_IF_NOT_EXIST"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" SET_WITH_EXPIRE_TIME"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:" OK"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aQ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"获取redis锁结果, key: {}, success: {}\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"renewLock"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bv}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bx}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:by}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bz}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D]},children:[{type:a,value:aA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,as]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aJ}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aL},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aM}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:bA},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"if redis.call('get',KEYS[1]) ~= ARGV[1] then return 0 else return redis.call('expire',KEYS[1],ARGV[2]) end\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bB}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bD},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"valueOf"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"secondsToExpire"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aQ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"更新redis锁结果, key: {}, success: {}\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:M}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,as]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aJ}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aL},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aM}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:y}]},{type:a,value:bA},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"if redis.call('get',KEYS[1]) ~= ARGV[1] then return 1 else return redis.call('del',KEYS[1]) end\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bB}]},{type:a,value:aN},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:aO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bD},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:D}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aQ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"\"释放redis锁结果, key: {}, success: {}\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"这里再掰一下释放锁的lua脚本的逻辑。在网上我看到的释放锁的lua脚本都是这样的逻辑：只有key存在并且为当前节点所有时，才会去执行释放锁，否则一律失败。但假若一种情况，一个节点获取到锁，过期时间一分钟，但任务执行了五分钟，这时候key已经过期，实际上锁已经被这个节点释放了，但当走释放锁的逻辑却是失败的，有用什么意义呢。如果之后会以释放锁来分支做一些逻辑，那是做还是不做呢，这个实例是确确实实获取过锁，才走到这里的。"}]},{type:a,value:h},{type:b,tag:ae,props:{className:[af]},children:[{type:b,tag:ag,props:{className:[ah,"language-lua"]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bG}]},{type:a,value:"我的脚本\n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aj}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"~="}]},{type:a,value:bI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bJ}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bK}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bM}]},{type:a,value:aD},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bG}]},{type:a,value:"importnew的脚本\n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aj}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"=="}]},{type:a,value:bI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bJ}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bK}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:A}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aF}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bM}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:P,props:{id:"分布式redis锁"},children:[{type:b,tag:x,props:{href:"#%E5%88%86%E5%B8%83%E5%BC%8Fredis%E9%94%81",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:"分布式Redis锁"}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"上面的redis锁是基于单个主节点的，如果主节点宕机进行了选举，新的主节点不一定能把锁的key同步，就可能会导致有两个实例获取到锁。"}]},{type:a,value:h},{type:b,tag:"h2",props:{id:aW},children:[{type:b,tag:x,props:{href:"#redlock",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:aX}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"所以在redis集群里，有N个（例如5个）独立的主节点，可以使用Redlock（红锁）算法。"}]},{type:a,value:h},{type:b,tag:aB,props:{},children:[{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"获取当前时间戳作为开始时间戳"}]},{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"依次向全部主节点加锁。每次加锁请求都需要设置超时时间，并且超时时间应该远远短于锁的有效时间"}]},{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"如果获取到了过半数主节点的锁，并且当前时间减去开始时间戳小于锁有效时间，即锁还没过期，则获取锁成功。这样子锁的实际有效时间就是距离锁过期剩下的时间了"}]},{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"如果没能获取过半锁，或者遍历完全部主节点后锁已经过期了，则向全部主节点解锁，稍等一段随机时间再重试"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:P,props:{id:"redlock的问题"},children:[{type:b,tag:x,props:{href:"#redlock%E7%9A%84%E9%97%AE%E9%A2%98",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:"Redlock的问题"}]},{type:a,value:h},{type:b,tag:aB,props:{},children:[{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"宕机问题：实例1拿到ABC三个锁，之后C宕机选举了，新C的锁丢了，实例2拿到了CDE三个锁，那就有两个实例拿到锁了"}]},{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"停顿问题：实例1拿到了锁，之后经历了很长的GC，长到锁过期了，之后实例2拿到了锁，但实例1从GC醒来的时候还以为只有自己有锁"}]},{type:a,value:h},{type:b,tag:I,props:{},children:[{type:a,value:"时间问题：实例1拿到了ABC三个锁，C的时间出了问题导致锁提前过期，实例2拿到了CDE的锁"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:P,props:{id:bN},children:[{type:b,tag:x,props:{href:"#redis%E8%AE%A1%E6%95%B0%E5%99%A8",ariaHidden:G,tabIndex:J},children:[{type:b,tag:c,props:{className:[K,L]},children:[]}]},{type:a,value:bN}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:a,value:"redis计数器就很简单了，直接redisTemplate就能调用，返回的是加一之后的值。"}]},{type:a,value:h},{type:b,tag:ae,props:{className:[af]},children:[{type:b,tag:ag,props:{className:[ah,az]},children:[{type:b,tag:ai,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:bc}]},{type:a,value:" increase "},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:t}]},{type:a,value:N},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bf}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"increment"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:S},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" delta"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fblog.csdn.net\u002FMuscleheng\u002Farticle\u002Fdetails\u002F103052584",rel:[V,W,X],target:Y},children:[{type:a,value:"SpringBoot Redis实现分布式锁"}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fmy.oschina.net\u002Fdengfuwei\u002Fblog\u002F1600681",rel:[V,W,X],target:Y},children:[{type:a,value:"spring boot redis分布式锁"}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1353616",rel:[V,W,X],target:Y},children:[{type:a,value:"Redis分布式锁的正确实现方式（Java版）"}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fbenjaminwhx.com\u002F2018\u002F08\u002F26\u002FRedis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%AE%9E%E7%8E%B0%E5%A7%BF%E5%8A%BF\u002F",rel:[V,W,X],target:Y},children:[{type:a,value:"Redis分布式锁的正确实现姿势"}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fcrossoverjie.top\u002F2018\u002F03\u002F29\u002Fdistributed-lock\u002Fdistributed-lock-redis\u002F",rel:[V,W,X],target:Y},children:[{type:a,value:"基于 Redis 的分布式锁"}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fjuejin.im\u002Fpost\u002F5e6727e16fb9a07cc845b9ba",rel:[V,W,X],target:Y},children:[{type:a,value:"基于Redis实现分布式锁之前，这些坑你一定得知道"}]}]},{type:a,value:h},{type:b,tag:s,props:{},children:[{type:b,tag:x,props:{href:"https:\u002F\u002Fblog.wangqi.love\u002Farticles\u002Fdistributed\u002FRedlock%E7%AE%97%E6%B3%95.html",rel:[V,W,X],target:Y},children:[{type:a,value:"Redlock算法"}]}]}]},excerpt:{type:aY,children:[{type:b,tag:s,props:{},children:[{type:a,value:ay}]}]},dir:bO,path:"\u002F中间件\u002F20200416\u002Fredis锁与redis计数器",extension:".md",title:aU,url:"\u002Fblog-code\u002Fview\u002F中间件\u002F20200416\u002Fredis锁与redis计数器",createAt:new Date(1586995200000),updateAt:new Date(1586995200000),attributes:[{name:"createAt",value:bP},{name:"updateAt",value:bP},{name:"sort",value:bO,url:"\u002Fblog-code\u002Fpage\u002F中间件\u002F20200416\u002F1\u002F"}]}}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation"," ","keyword","\n",".","(",")","class-name",";","function",",","operator","tag","\n    ","p","=","\n            ","\n        ","\u003E","a","String","string","return","{","}","boolean","import","number","true","\u003C","li",-1,"icon","icon-link","public"," redisTemplate"," key","h1","private","\n\n    ","key","Jedis","1","nofollow","noopener","noreferrer","_blank","\u003C\u002F","namespace","final"," success","[","]"," \n","div","nuxt-content-highlight","pre","line-numbers","code","if","Arrays","\n            log","RedisTemplate","dependency","groupId","artifactId","RedisCallback","static","generics","asList"," redis","call"," KEYS"," \n    ","之前写过一篇分别用mysql，redis和zookeeper实现分布式锁，但写的比较简略。这次写个比较完整的redis锁和redis计数器的实现。","language-java","false","ol","redis","\n\n"," secondsToExpire","0","execute","Boolean"," redisConnection ","-\u003E"," jedis "," redisConnection","getNativeConnection"," result "," jedis"," success ","equals","result","info","无名の窝","redis锁与redis计数器","2020-04-16T00:00:00.000Z","redlock","Redlock","root","场景与问题","现有的redis锁逻辑","class","annotation","tryLock","long"," time"," timeUnit","opsForValue","unLock","改进思路","redis分布式锁","jedis","org","springframework","data","core","java","util","RedisLockImpl","doc-comment","comment"," instanceId","this","int","secondsToExpire ","\u003C=","error","\"过期时间不得小于等于0\""," script ","Object","eval","script","instanceId"," SUCCESS","\u002F\u002F","'get'"," ARGV","then","else","'del'","end","redis计数器","\u002F中间件\u002F20200416","2020-04-16")));