---
title: n1升级armbian系统
date: 2024-02-08
math: true
mermaid: true
sticky: 0
category: 折腾
tags:
---

n1的系统已经多年没有更新过了，还停留在了古老的5.77版本。虽然稳定压倒一切，但这么久了也得升级一下。

## 下载固件

这次打算直接重装系统，armbian选择debian，先去[debian](https://www.debian.org/releases/index.zh-cn.html)里挑最新稳定版本号。
然后到[github](https://github.com/ophub/amlogic-s9xxx-armbian)里下载对应的固件。

例如N1的CPU是s905d，当下debian的最新稳定版是bookworm，再挑个最新的内核，所以我选择了Armbian_24.2.0_amlogic_s905d_bookworm_6.6.15_server_2024.02.01.img.gz。
下载下来之后校验一下hash，避免文件损坏。

## 制作启动盘

固件官方推荐使用[rufus](https://rufus.ie/)或者[balenaEtcher](https://etcher.balena.io/)
来把固件写到U盘里。由于我是Linux系统，所以用了balenaEtcher来刷。
以前使用5.77版本的时候，还需要手动替换dtb文件，**不然系统负载会升高。现在使用这个固件，刷完就可以直接用了。**

## 刷入EMMC

备份好N1里的重要文件。

把刷好的U盘插到靠近HDMI的USB口，断电重启。一切顺利就会进入到U盘系统里（默认用户: root, 默认密码: 1234）。

执行`armbian-install`将系统刷进EMMC里。**中途好像还有让选择分区格式？**。刷完之后关机，拔掉U盘，重启

## 系统配置与软件安装

### 创建swap

```shell
#单位GB
armbian-swap 1
free -h
```

### 删除默认DNS

```shell
cat /etc/resolvconf/resolv.conf.d/head
rm /etc/resolvconf/resolv.conf.d/head
touch /etc/resolvconf/resolv.conf.d/head
```

### 中文乱码

```shell
# 备份文件
cp /etc/environment /etc/environment.bak
# 修改
vim /etc/environment
ARCH=arm64
LC_ALL="en_US.utf-8"
# 使之生效
source /etc/environment
```

### 替换apt源

```shell
cat /etc/apt/sources.list.d/armbian.list

sed -i.bak 's#http://apt.armbian.com#https://mirrors.tuna.tsinghua.edu.cn/armbian#g' /etc/apt/sources.list.d/armbian.list

apt update -y
apt upgrade -y
apt install sudo vim curl wget git htop -y
```

+ 防火墙
+ 修改时区
+ journal日志大小限制
+ 创建用户
+ 安装docker

### 开机挂载U盘

```shell
sudo blkid

sudo vim /etc/fstab
UUID=B07C12B77C1277F4 /media/user/upan ntfs defaults 0 1
```

### 清理

```shell
sudo apt-get clean
sudo apt-get autoclean
sudo apt-get autoremove
```

### 观察负载

```shell
htop
```

## 参考文献

+ [Armbian 软件仓库](https://mirrors.tuna.tsinghua.edu.cn/help/armbian/)
+ [[N1盒子] N1终于刷上最新固件Armbian_22.08.0_Aml_s905d_jammy_5.15.51-2022-6-30](https://www.right.com.cn/forum/thread-8242071-1-1.html)
+ [amlogic-s9xxx-armbian](https://github.com/ophub/amlogic-s9xxx-armbian/tree/main)