---
title: 安装Debian手记
date: 2025-01-05
math: true
mermaid: true
sticky: 0
category: 折腾
tags:
---

Archlinux滚挂了两次，没爱，心累了。

## 硬件与目标

+ NVMe固态的笔记本电脑
+ 安装Debian单系统
+ 使用Btrfs磁盘格式
+ 安装GNOME桌面

## 前期准备

+ [ ] 下载安装镜像：https://www.debian.org/distrib/
    + 推荐下载「完整安装映像」，在安装后期跳过在线下载，安装完成后再安装gnome
    + 其次是Live Gnome，但是安装的是完整版gnome，会有烦人的小游戏
    + 不推荐「小型安装映像」，需要强制联网下载，软件下载巨慢无比
+ SHA256校验镜像：`sha256sum debian.ios`
+ 烧录U盘
    + `sudo flatpak install -y flathub io.gitlab.adhami3310.Impression`或者https://etcher.balena.io/
    + dd命令虽然通用，但是看不到进度条，心里不安心

## 安装系统

系统分区记得要设置格式化，其余没啥特别需要注意的，如果安装过程中U盘掉盘了，强制重启重装就好。

| 分区    | 大小   | 类型               |
|-------|------|------------------|
| EFI分区 | 128M | EFI System       |
| 交换分区  | 16G  | Linux System     |
| 系统分区  | 剩余空间 | Linux filesystem |

不知道是不是在安装的时候少选了什么东西，连sudo都没安装，因此安装完成先切换到root账户进行操作。

```shell
# 在普通用户里切换root账号，su后输入root密码
su
```

### 国内源

终端里下载debian12的清华源配置文件进行替换，其余版本参考：https://mirrors.tuna.tsinghua.edu.cn/help/debian/

长链：https://raw.githubusercontent.com/cellargalaxy/blog-code/refs/heads/master/source/_posts/%E6%8A%98%E8%85%BE/30.debian12-sources.list
短链：https://shorturl.at/RHdo5

```shell
cd /etc/apt
mv sources.list sources.list.back
wget https://shorturl.at/RHdo5 -O sources.list
```

### 更新系统

```shell
apt update
apt upgrade -y
```

### 准备非root用户

```shell
# 安装sudo
apt install -y sudo

vi /etc/sudoers
# 在%sudo ALL=(ALL:ALL) ALL下面添加
xxx ALL=(ALL:ALL) ALL
# xxx为该用户的用户组，一般与用户名相同
# 不知道为什么是只读文件，但可以wq!强制保存
```

### 安装桌面

```shell
# 安装gnome而不是gnome-core，会有烦人的小游戏
apt install gnome-core gdm3

# 桌面开机启动
systemctl enable gdm3
systemctl start gdm3
```

## 安装软件

将该文件下载到手机里，与VPN的截图通过UBS复制到电脑里方便操作。并且在系统里配置socks5的系统代理。

### 防火墙

```shell
sudo apt install -y ufw
sudo systemctl enable --now ufw
sudo systemctl status ufw
sudo ufw default deny

sudo ufw enable
sudo ufw disable

sudo ufw allow 8024
sudo ufw status numbered
sudo ufw delete 3
```

### 终端软件

```shell
sudo apt install -y ntfs-3g git wget curl guake htop vim flameshot flatpak
```

### shell

```shell
#我这使用zsh
sudo apt install -y zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

#改zsh主题
vim ~/.zshrc
ZSH_THEME="gentoo"
source ~/.zshrc
```

### 主题

```shell
# 主题我使用这个
cd /tmp
git clone --depth 1 https://github.com/vinceliuice/Qogir-theme.git
./Qogir-theme/install.sh --tweaks round -c dark -l -i debian

# 图标我使用这个
sudo apt install -y numix-icon-theme-circle
```

### WIFI

安装系统的时候配置文件会被写死了账号密码，导致gnome识别不到wifi，非常傻逼

```shell
sudo vim /etc/network/interfaces
# 将类似下面的东西注释掉
allow-hotplug wlo1
iface wlo1 inet dhcp
	wpa-ssid wifi名称
	wpa-psk  wifi密码
```

### 引导程序

```shell
#隐藏grub菜单，GRUB_TIMEOUT设置为0

sudo vim /etc/default/grub  # 编辑
sudo update-grub            # 更新
```

### docker

```shell
curl -fsSl https://get.docker.com | bash -s docker

sudo systemctl enable docker
sudo systemctl start docker

# docker拉取镜像走代理，https://neucrack.com/p/286
sudo systemctl status docker                            # 查询docker的service文件路径
Environment="HTTP_PROXY=socks5://192.168.123.1:10808"
Environment="HTTPS_PROXY=socks5://192.168.123.1:10808"
Environment="NO_PROXY=192.168.123.1"
sudo systemctl daemon-reload                            # 重载service文件

sudo mkdir /etc/docker
sudo vim /etc/docker/daemon.json
{
  "log-driver":"json-file",
  "log-opts": {"max-size":"5m", "max-file":"3"}
}
sudo systemctl restart docker # 重启docker生效配置
sudo docker info              # 检查配置是否生效

sudo groupadd docker          # 创建docker用户组
sudo gpasswd -a $USER docker  # 将用户加入到docker用户组
newgrp docker                 # 更新用户组
docker run --rm hello-world   # 检查docker能否正常运行
```

```shell
docker run -d \
  --restart=always \
  --privileged \
  --network=host \
  --name v2raya \
  -v /lib/modules:/lib/modules:ro \
  -v /etc/resolv.conf:/etc/resolv.conf \
  -v /etc/v2raya:/etc/v2raya \
  mzz2017/v2raya
```

梯子，方便之后操作：http://127.0.0.1:2017/

### 卸载预装软件

如果安装了gnome的小游戏全家桶，进行卸载

```shell
sudo apt purge aisleriot gnome-sudoku gnome-nibbles ace-of-penguins gbrainy gnome-taquin gnome-tetravex  gnome-robots gnome-chess lightsoff swell-foop quadrapassel tali gnome-mahjongg gnome-2048 iagno gnome-klotski five-or-more gnome-mines four-in-a-row hitori

sudo apt-get remove --purge "firefox*"
sudo apt-get remove --purge "shotwell*"
sudo apt-get remove --purge "transmission-*"
sudo apt-get remove --purge "thunderbird*"
sudo apt-get remove --purge "mozc*"
sudo apt-get remove --purge "anthy*"
sudo apt-get remove --purge "goldendict*"
sudo apt-get remove --purge "hdate-applet*"
sudo apt-get remove --purge "xiterm*"
sudo apt-get remove --purge "mlterm*"
sudo apt-get remove --purge "libreoffice*"
sudo apt-get remove --purge "gnome-games*"

sudo apt-get clean
sudo apt-get autoremove
```

### flatpak

```shell
# 恢复官方源，先强制删除在添加
sudo flatpak remote-delete --force flathub
sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

# 配置国内源，上海交大：https://mirror.sjtu.edu.cn/docs/flathub
sudo flatpak remote-modify flathub --url=https://mirror.sjtu.edu.cn/flathub

# 查看仓库源
sudo flatpak remotes --show-details

# 让flatpak内的软件也感知系统主题
flatpak --user override --filesystem=~/.config/gtk-4.0
flatpak --user override --filesystem=~/.themes
flatpak --user override --env=GTK_THEME=Qogir-Dark

# 重启才能启动软件
sudo reboot

# 更新全部软件
flatpak update
```

```shell
sudo flatpak install -y flathub io.github.flattool.Warehouse             # flatpak软件管理
sudo flatpak install -y flathub com.github.tchx84.Flatseal               # flatpak权限管理

# gnome全家桶，如果gnome-core已经安装的就不用重复安装了
sudo flatpak install -y flathub org.gnome.Maps				             # 地图
sudo flatpak install -y flathub org.gnome.Weather			             # 天气
sudo flatpak install -y flathub org.gnome.Rhythmbox3                     # 播放音乐
sudo flatpak install -y flathub org.gnome.baobab                         # 磁盘占用统计
sudo flatpak install -y flathub org.gnome.FileRoller                     # 压缩解压
sudo flatpak install -y flathub org.gnome.Boxes                          # 虚拟机
sudo flatpak install -y flathub org.gnome.gedit                          # 编辑文本

sudo flatpak install -y flathub org.kde.okular                           # 查看文档
sudo flatpak install -y flathub org.kde.gwenview                         # 查看图片
sudo flatpak install -y flathub org.kde.kolourpaint                      # 画画
sudo flatpak install -y flathub org.remmina.Remmina                      # 远程桌面
sudo flatpak install -y flathub org.videolan.VLC                         # vlc
sudo flatpak install -y flathub io.mpv.Mpv                               # mpv
sudo flatpak install -y flathub org.mozilla.firefox                      # firefox
sudo flatpak install -y flathub com.google.Chrome                        # chrome
sudo flatpak install -y flathub com.tencent.WeChat                       # WeChat
sudo flatpak install -y flathub com.qq.QQ                                # QQ
sudo flatpak install -y flathub cn.feishu.Feishu                         # Feishu
sudo flatpak install -y flathub com.wps.Office                           # wps
sudo flatpak install -y flathub com.jetbrains.GoLand                     # GoLand
sudo flatpak install -y flathub com.jetbrains.PyCharm-Professional       # PyCharm
sudo flatpak install -y flathub com.jetbrains.WebStorm                   # WebStorm
sudo flatpak install -y flathub io.gitlab.adhami3310.Impression          # 烧录U盘
sudo flatpak install -y flathub io.dbeaver.DBeaverCommunity              # DBeaver
```

### 输入法

1 安装fcitx5

```shell
# 系统使用 Gnome 桌面环境，安装 Gnome-Software 的 Flatpak 插件
sudo apt install -y gnome-software-plugin-flatpak

# 安装 Fcitx5
sudo flatpak install -y flathub org.fcitx.Fcitx5
# 安装 Fcitx5 Rime 插件
sudo flatpak install -y flathub org.fcitx.Fcitx5.Addon.Rime
```

2 配置fcitx5

```shell
sudo vim /etc/environment

GTK_IM_MODULE=fcitx
QT_IM_MODULE=fcitx
XMODIFIERS=@im=fcitx
INPUT_METHOD=fcitx
SDL_IM_MODULE=fcitx
GLFW_IM_MODULE=ibus
```

```shell
# 参考：https://github.com/pickfire/dotfiles/blob/alpine/.config/fcitx5/config
# 先启动一下fcitx5，启动fcitx5后会创建他的配置文件夹
# 创建配置文件，添加如下配置
vim ~/.var/app/org.fcitx.Fcitx5/config/fcitx5/config

[Hotkey/TriggerKeys]
0=Shift_R
# 如果配置的是Shift_L，则只有左Shift能切换输入法，并且剔除Ctrl+Space
# 我习惯于两个Shift都能切换输入法，因此配置的是Shift_R
```

3 安装雾凇拼音

```shell
cd ~/.var/app/org.fcitx.Fcitx5/data/fcitx5
mv rime rime.back
git clone --depth 1 https://github.com/iDvel/rime-ice.git rime
```

4 配置雾凇拼音

```shell
vim ~/.var/app/org.fcitx.Fcitx5/data/fcitx5/rime/default.yaml

patch:
  "menu/page_size": 10  # 候选词数量
  schema_list:          # 我只要雾凇拼音就够了，其余注释
    - schema: rime_ice
```

5 注销重登

## 软件配置

### gnome-tweak

```shell
sudo apt install -y gnome-tweaks
sudo flatpak install flathub org.gnome.Extensions
```

尽管extensions里会显示未检测到本地主机连接器，但是点击安装，会安装到Extensions里

+ [ ] 快捷键
    + [ ] `/usr/bin/flameshot gui`
    + [ ] `guake-toggle`，除了在guake里进行配置，还需要在设置里进行设置，否则在某些窗口里无法唤醒
+ [ ] 电源
    + [ ] 节能
    + [ ] 关闭自动挂起
    + [ ] 显示电池百分比
+ [ ] 触摸板关闭自然滚动
+ [ ] 设置图标
+ [ ] 设置壁纸
+ [ ] guake与Fcitx5开机自启
+ [ ] 顶栏
+ [ ] Dash to Dock：https://extensions.gnome.org/extension/307/dash-to-dock/
    + [ ] 所有显示器都启用
    + [ ] 位于屏幕左侧
    + [ ] 延伸到屏幕边缘
    + [ ] 不显示回收站
    + [ ] 不透明度
    + [ ] 收缩Dash
+ [ ] 系统监控：https://extensions.gnome.org/extension/3010/system-monitor-next/
    + [ ] https://github.com/mgalgs/gnome-shell-system-monitor-next-applet
    + [ ] 先安装依赖`sudo apt install gir1.2-gtop-2.0 gir1.2-nm-1.0 gir1.2-clutter-1.0 gnome-system-monitor`
    + [ ] CPU-图表
    + [ ] 内存-图表
    + [ ] 网路-数字
    + [ ] 硬盘-数字
    + [ ] 温度-数字

### home文件夹

home文件夹我也习惯改改

```shell
mkdir -p $HOME/desktop
mkdir -p $HOME/download
mkdir -p $HOME/document
mkdir -p $HOME/music
mkdir -p $HOME/picture
mkdir -p $HOME/video
mkdir -p $HOME/software

vim ~/.config/user-dirs.dirs

XDG_TEMPLATES_DIR="$HOME/desktop"
XDG_PUBLICSHARE_DIR="$HOME/desktop"
XDG_DESKTOP_DIR="$HOME/desktop"
XDG_DOWNLOAD_DIR="$HOME/download"
XDG_DOCUMENTS_DIR="$HOME/document"
XDG_MUSIC_DIR="$HOME/music"
XDG_PICTURES_DIR="$HOME/picture"
XDG_VIDEOS_DIR="$HOME/video"
```

### 油猴

+ [ ] [AC-baidu-重定向优化百度搜狗谷歌必应搜索_favicon_双列](https://greasyfork.org/zh-CN/scripts/14178-ac-baidu-%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E5%BF%85%E5%BA%94%E6%90%9C%E7%B4%A2-favicon-%E5%8F%8C%E5%88%97)
+ [ ] [夜间模式-shift快捷键版](https://greasyfork.org/zh-CN/scripts/437290-%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F-shift%E5%BF%AB%E6%8D%B7%E9%94%AE%E7%89%88)
+ [ ] [文本选中复制](https://greasyfork.org/zh-CN/scripts/405130-%E6%96%87%E6%9C%AC%E9%80%89%E4%B8%AD%E5%A4%8D%E5%88%B6)
+ [ ] [放开飞书复制和右键](https://greasyfork.org/zh-CN/scripts/454518-%E6%94%BE%E5%BC%80%E9%A3%9E%E4%B9%A6%E5%A4%8D%E5%88%B6%E5%92%8C%E5%8F%B3%E9%94%AE)

## 其他

### jetbrains全家桶

[一个NB闪闪的开源库ja-netfilter](https://sqiang.net/post/3632131313.html)

1. [https://3.jetbra.in/](https://3.jetbra.in/)或者[https://jetbra.in/s](https://jetbra.in/s)
2. 下载ja-netfilter，里面有VM配置文件，照抄即可
3. 重启，填写激活码
4. 下载Consolas字体
5.
如果输入法框不跟踪光标：[JetBrainsRuntime-for-Linux-x64](https://github.com/RikudouPatrickstar/JetBrainsRuntime-for-Linux-x64)


