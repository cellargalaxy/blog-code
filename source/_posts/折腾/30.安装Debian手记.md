---
title: 安装Debian手记
date: 2025-01-05
math: true
mermaid: true
sticky: 0
category: 折腾
tags:
---

Archlinux滚挂了两次，没爱，心累了。

使用小提示：在手机里把文档下载下来，用USB将文档传到电脑里，方便复制粘贴。

## 硬件与目标

+ NVMe固态的笔记本电脑
+ 安装Debian单系统
+ 使用Btrfs磁盘格式
+ 安装GNOME桌面

## 前期准备

+ [ ] 下载安装镜像：https://www.debian.org/distrib/
    + 推荐下载「完整安装映像」，在安装后期跳过在线下载，安装完成后再安装gnome
    + 其次是Live Gnome，但是安装的是完整版gnome，会有烦人的小游戏
    + 不推荐「小型安装映像」，需要强制联网下载，软件下载巨慢无比
+ SHA256校验镜像：`sha256sum debian.ios`
+ 烧录U盘
    + `sudo flatpak install flathub io.gitlab.adhami3310.Impression`或者https://etcher.balena.io/
    + dd命令虽然通用，但是看不到进度条，心里不安心

## 安装系统

系统分区记得要设置格式化，其余没啥特别需要注意的，如果安装过程中U盘掉盘了，强制重启重装就好。

| 分区    | 大小   | 类型               |
|-------|------|------------------|
| EFI分区 | 512M | EFI System       |
| 交换分区  | 16G  | Linux System     |
| 系统分区  | 剩余空间 | Linux filesystem |

不知道是不是在安装的时候少选了什么东西，连sudo都没安装，因此安装完成先切换到root账户进行操作。

```shell
# 在普通用户里切换root账号，输入root密码
su
```

### 国内源

终端里下载debian12的清华源配置文件进行替换，其余版本参考：https://mirrors.tuna.tsinghua.edu.cn/help/debian/

长链：https://raw.githubusercontent.com/cellargalaxy/blog-code/refs/heads/master/source/_posts/%E6%8A%98%E8%85%BE/30.debian12-sources.list
短链：https://shorturl.at/RHdo5

```shell
mv /etc/apt/sources.list /etc/apt/sources.list.back
wget https://shorturl.at/RHdo5 -O sources.list
```

### 更新系统

```shell
apt-get update
apt upgrade -y
```

### 防火墙

```shell
apt install -y ufw
systemctl enable --now ufw
systemctl status ufw
ufw default deny

ufw enable
ufw disable

ufw allow 8024
ufw status numbered
ufw delete 3
```

### 准备非root用户

```shell
# 安装sudo
apt install -y sudo

vi /etc/sudoers
# 在%sudo ALL=(ALL:ALL) ALL下面添加
xxx ALL=(ALL:ALL) ALL
# xxx为该用户的用户组，一般与用户名相同
# 不知道为什么是只读文件，但可以wq!强制保存
```

### 安装桌面

```shell
# 安装gnome而不是gnome-core，会有烦人的小游戏
apt install gnome-core gdm3

# 桌面开机启动
systemctl enable gdm3
systemctl start gdm3
```

## 安装软件

### 终端软件

```shell
sudo apt install -y ntfs-3g git wget curl guake htop vim flatpak
```

### shell

```shell
#我这使用zsh
sudo apt install -y zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

#改zsh主题
vim ~/.zshrc
ZSH_THEME="gentoo"
source ~/.zshrc
```

### 主题

```shell
# 主题我使用这个
cd /tmp
git clone --depth 1 https://github.com/vinceliuice/Qogir-theme.git
./Qogir-theme/install.sh --tweaks round -c dark -l -i debian

# 图标我使用这个
sudo apt install -y numix-icon-theme-circle
```

### WIFI

安装系统的时候配置文件会被写死了账号密码，导致gnome识别不到wifi，非常傻逼

```shell
sudo vim /etc/network/interfaces
# 将类似下面的东西注释掉
allow-hotplug wlo1
iface wlo1 inet dhcp
	wpa-ssid wifi名称
	wpa-psk  wifi密码
```

### 引导程序

```shell
#隐藏grub菜单，GRUB_TIMEOUT设置为0

sudo vim /etc/default/grub  # 编辑
sudo update-grub            # 更新
```

### docker

```shell
sudo apt install -y docker.io docker-compose
curl -fsSl https://get.docker.com | bash -s docker --mirror Aliyun

sudo systemctl enable docker
sudo systemctl start docker

# docker拉取镜像走代理，https://neucrack.com/p/286
sudo systemctl status docker                            # 查询docker的service文件路径
Environment="HTTP_PROXY=socks5://192.168.123.1:10808"
Environment="HTTPS_PROXY=socks5://192.168.123.1:10808"
Environment="NO_PROXY=192.168.123.1"
sudo systemctl daemon-reload                            # 重载service文件

sudo mkdir /etc/docker
sudo vim /etc/docker/daemon.json
{
  "log-driver":"json-file",
  "log-opts": {"max-size":"5m", "max-file":"3"}
}
sudo systemctl restart docker # 重启docker生效配置
sudo docker info              # 检查配置是否生效

sudo groupadd docker          # 创建docker用户组
sudo gpasswd -a $USER docker  # 将用户加入到docker用户组
newgrp docker                 # 更新用户组
docker run --rm hello-world   # 检查docker能否正常运行
```

```shell
docker run -d \
  --restart=always \
  --privileged \
  --network=host \
  --name v2raya \
  -v /lib/modules:/lib/modules:ro \
  -v /etc/resolv.conf:/etc/resolv.conf \
  -v /etc/v2raya:/etc/v2raya \
  mzz2017/v2raya
```

梯子，方便之后操作：http://127.0.0.1:2017/

提示，可以在手机里截图配置，通过USB到电脑里。

### flatpak

```shell
# 恢复官方源，先强制删除在添加
sudo flatpak remote-delete --force flathub
sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

# 配置国内源，上海交大：https://mirror.sjtu.edu.cn/docs/flathub
sudo flatpak remote-modify flathub --url=https://mirror.sjtu.edu.cn/flathub

# 查看仓库源
sudo flatpak remotes --show-details

# 重启才能安装软件
sudo reboot

# 更新全部软件
flatpak update

# 让flatpak内的软件也感知系统主题
flatpak --user override --filesystem=~/.config/gtk-4.0
flatpak --user override --filesystem=~/.themes
flatpak --user override --env=GTK_THEME=Qogir-Dark
```

```shell
sudo flatpak install flathub io.github.flattool.Warehouse             # flatpak软件管理
sudo flatpak install flathub com.github.tchx84.Flatseal               # flatpak权限管理
sudo flatpak install flathub org.kde.okular                           # 查看文档
sudo flatpak install flathub org.kde.gwenview                         # 查看图片
sudo flatpak install flathub org.kde.kolourpaint                      # 画画
sudo flatpak install flathub org.gnome.Rhythmbox3                     # 播放音乐
sudo flatpak install flathub org.gnome.baobab                         # 磁盘占用统计
sudo flatpak install flathub org.gnome.gedit                          # 编辑文本
sudo flatpak install flathub org.remmina.Remmina                      # 远程桌面
sudo flatpak install flathub org.gnome.FileRoller                     # 压缩解压
sudo flatpak install flathub org.videolan.VLC                         # vlc
sudo flatpak install flathub io.mpv.Mpv                               # mpv
sudo flatpak install flathub org.mozilla.firefox                      # firefox
sudo flatpak install flathub org.gnome.Extensions                     # 管理gnome拓展
sudo flatpak install flathub com.tencent.WeChat                       # WeChat
sudo flatpak install flathub com.qq.QQ                                # QQ
sudo flatpak install flathub cn.feishu.Feishu                         # Feishu
sudo flatpak install flathub com.wps.Office                           # wps
sudo flatpak install flathub org.flameshot.Flameshot                  # 截图
sudo flatpak install flathub com.jetbrains.GoLand                     # GoLand
sudo flatpak install flathub com.jetbrains.PyCharm-Professional       # PyCharm
sudo flatpak install flathub com.jetbrains.WebStorm                   # WebStorm
sudo flatpak install flathub io.gitlab.adhami3310.Impression          # 烧录U盘
sudo flatpak install flathub org.qbittorrent.qBittorrent              # qBittorrent
sudo flatpak install flathub org.gnome.Boxes                          # 虚拟机
sudo flatpak install flathub io.dbeaver.DBeaverCommunity              # DBeaver

# 其中有一部分需要代理环境才能下载，不能使用sudo，sudo后代理会不生效
export all_proxy=socks5://192.168.123.1:10808
flatpak install flathub com.google.Chrome                        # chrome
```

### 输入法

1 安装fcitx5

```shell
# 系统使用 Gnome 桌面环境，安装 Gnome-Software 的 Flatpak 插件
sudo apt install -y gnome-software-plugin-flatpak

# 安装 Fcitx5
sudo flatpak install flathub org.fcitx.Fcitx5
# 安装 Fcitx5 Rime 插件
sudo flatpak install flathub org.fcitx.Fcitx5.Addon.Rime
```

2 配置fcitx5

```shell
sudo vim /etc/environment

GTK_IM_MODULE=fcitx
QT_IM_MODULE=fcitx
XMODIFIERS=@im=fcitx
INPUT_METHOD=fcitx
SDL_IM_MODULE=fcitx
GLFW_IM_MODULE=ibus
```

```shell
# 参考：https://github.com/pickfire/dotfiles/blob/alpine/.config/fcitx5/config
# 先启动一下fcitx5，启动fcitx5后会创建他的配置文件夹
# 创建配置文件，添加如下配置
vim ~/.var/app/org.fcitx.Fcitx5/config/fcitx5/config

[Hotkey/TriggerKeys]
0=Shift_R
# 如果配置的是Shift_L，则只有左Shift能切换输入法，并且剔除Ctrl+Space
# 我习惯于两个Shift都能切换输入法，因此配置的是Shift_R
```

3 安装雾凇拼音

```shell
cd ~/.var/app/org.fcitx.Fcitx5/data/fcitx5
mv rime rime.back
git clone --depth 1 https://github.com/iDvel/rime-ice.git rime
```

4 配置雾凇拼音

```shell
vim ~/.var/app/org.fcitx.Fcitx5/data/fcitx5/rime/default.yaml

patch:
  "menu/page_size": 10  # 候选词数量
  schema_list:          # 我只要雾凇拼音就够了，其余注释
    - schema: rime_ice
```

5 注销重登

## 软件配置

### gnome-tweak

```shell
sudo apt install -y gnome-tweak
sudo flatpak install flathub org.gnome.Extensions
```

尽管extensions里会显示未检测到本地主机连接器，但是点击安装，会安装到flatpak的Extensions里

+ [ ] guake与Fcitx5开机自启
    + 不知道为什么开机启动项，开机启动几次之后就会丢，ubuntu也有这个问题，可能是gnome的bug？
+ [ ] Dash to Dock：https://extensions.gnome.org/extension/307/dash-to-dock/
    + [ ] 所有显示器都启用
    + [ ] 位于屏幕左侧
    + [ ] 延伸到屏幕边缘
    + [ ] 不显示回收站
    + [ ] 不透明度
    + [ ] 收缩Dash
+ [ ] 系统监控：https://extensions.gnome.org/extension/3010/system-monitor-next/
    + [ ] github：https://github.com/mgalgs/gnome-shell-system-monitor-next-applet
    + [ ] 安装依赖`sudo apt install gir1.2-gtop-2.0 gir1.2-nm-1.0 gir1.2-clutter-1.0 gnome-system-monitor`
    + [ ] CPU-图表
    + [ ] 内存-图表
    + [ ] 网路-数字
    + [ ] 硬盘-数字
    + [ ] 温度-数字

```shell
# 快捷键
/usr/bin/flameshot gui
guake-toggle
```

### home文件夹

home文件夹我也习惯改改

```shell
mkdir -p $HOME/desktop
mkdir -p $HOME/download
mkdir -p $HOME/document
mkdir -p $HOME/music
mkdir -p $HOME/picture
mkdir -p $HOME/video
mkdir -p $HOME/software

vim ~/.config/user-dirs.dirs

XDG_TEMPLATES_DIR="$HOME/desktop"
XDG_PUBLICSHARE_DIR="$HOME/desktop"
XDG_DESKTOP_DIR="$HOME/desktop"
XDG_DOWNLOAD_DIR="$HOME/download"
XDG_DOCUMENTS_DIR="$HOME/document"
XDG_MUSIC_DIR="$HOME/music"
XDG_PICTURES_DIR="$HOME/picture"
XDG_VIDEOS_DIR="$HOME/video"
```

### 油猴

+ [ ] [AC-baidu-重定向优化百度搜狗谷歌必应搜索_favicon_双列](https://greasyfork.org/zh-CN/scripts/14178-ac-baidu-%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E5%BF%85%E5%BA%94%E6%90%9C%E7%B4%A2-favicon-%E5%8F%8C%E5%88%97)
+ [ ] [夜间模式-shift快捷键版](https://greasyfork.org/zh-CN/scripts/437290-%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F-shift%E5%BF%AB%E6%8D%B7%E9%94%AE%E7%89%88)
+ [ ] [文本选中复制](https://greasyfork.org/zh-CN/scripts/405130-%E6%96%87%E6%9C%AC%E9%80%89%E4%B8%AD%E5%A4%8D%E5%88%B6)
+ [ ] [放开飞书复制和右键](https://greasyfork.org/zh-CN/scripts/454518-%E6%94%BE%E5%BC%80%E9%A3%9E%E4%B9%A6%E5%A4%8D%E5%88%B6%E5%92%8C%E5%8F%B3%E9%94%AE)

## 其他

### jetbrains全家桶

[一个NB闪闪的开源库ja-netfilter](https://sqiang.net/post/3632131313.html)

1. 下载解压ja-netfilter：https://gitee.com/ja-netfilter/ja-netfilter/releases
2. 修改ja-netfilter的配置

dns.conf

```shell
[DNS]
EQUAL,jetbrains.com
EQUAL,brucege.com
EQUAL,plugin.obroom.com
```

power.conf

```shell
[Result]
; Suit 220701
EQUAL,108391492724719606277191711676038310454333436786970899072879934267610324870870961974305689698304529291751931883693569275416671653649715395540162187908455880751887548211257780817773830153477469379663893839249632010489688404104740814832791608983255964373246023808678041003248593298915323068020141515280275870731964298697511434302901212533563571472947179437111243030002421474283363073021442715554541318313064598900684758246291687123240210640543678544269324094608551763049140564128299834843381841274260516105408318037686490277144538983963856617365418526798235932271319705894170543971766101775628884107261100637290512593943587295268337137890353216997114446658051251047509442298463526766678103653729776506979657957966027949436493606289520405331110453990512846697802196701678785414928082416405650857741201229183421400567636999723106788808933737428330992184832395299929033666381663232693108552887968738513151493044369308652310586803160326722967115451573652070286501044484503083240302303438554529551204609089966636092666792347623413483134664670641246129954999815529917163967761617333572567787618346281658716181608204191963817312534492517480248086896060880038259592723773361709406277837609546030729611710076711450268767610513506889086815865283,65537,860106576952879101192782278876319243486072481962999610484027161162448933268423045647258145695082284265933019120714643752088997312766689988016808929265129401027490891810902278465065056686129972085119605237470899952751915070244375173428976413406363879128531449407795115913715863867259163957682164040613505040314747660800424242248055421184038777878268502955477482203711835548014501087778959157112423823275878824729132393281517778742463067583320091009916141454657614089600126948087954465055321987012989937065785013284988096504657892738536613208311013047138019418152103262155848541574327484510025594166239784429845180875774012229784878903603491426732347994359380330103328705981064044872334790365894924494923595382470094461546336020961505275530597716457288511366082299255537762891238136381924520749228412559219346777184174219999640906007205260040707839706131662149325151230558316068068139406816080119906833578907759960298749494098180107991752250725928647349597506532778539709852254478061194098069801549845163358315116260915270480057699929968468068015735162890213859113563672040630687357054902747438421559817252127187138838514773245413540030800888215961904267348727206110582505606182944023582459006406137831940959195566364811905585377246353->31872219281407242025505148642475109331663948030010491344733687844358944945421064967310388547820970408352359213697487269225694990179009814674781374751323403257628081559561462351695605167675284372388551941279783515209238245831229026662363729380633136520288327292047232179909791526492877475417113579821717193807584807644097527647305469671333646868883650312280989663788656507661713409911267085806708237966730821529702498972114194166091819277582149433578383639532136271637219758962252614390071122773223025154710411681628917523557526099053858210363406122853294409830276270946292893988830514538950951686480580886602618927728470029090747400687617046511462665469446846624685614084264191213318074804549715573780408305977947238915527798680393538207482620648181504876534152430149355791756374642327623133843473947861771150672096834149014464956451480803326284417202116346454345929350148770746553056995922154382822307758515805142704373984019252210715650875853634697920708113806880196144197384637328982263167395073688501517286678083973976140696077590122053014085412828620051470085033364773099146103525313018873319293728800442101520384088109603555959893639842091339193857485407672132882577840295039058621747654642202620767068924079813640067442975
EQUAL,820563695837794062003013052431566406311160519459527861500703856031109754642079235583817632608600538427437617602262999609013304012507897813563718719720856177652850327961467224291449089135680755288577504536702620359129295482393325960269624080511269764101665311320956470015613044808066402568798693281462244978128867910557946603386047729514659336854309276651962414690113978708520364504328849058883417158186751315886080272834506502242438553969507697483002851232580211232007222134718334176577725640440791904351641362718652452524224349310214787836932692511798322090590491010282507213990514918561984012596822561474687437143,65537,24521566609765666164947017540032021599255701751860227819512057581863724253675446227963662825786216373422117712052647819939094618512591273903731385388945941620956494535886991119537555521717683289574562412249381695575366776196301290570457146763799416784211789775179394339350479765228864277544252534115220169733628333836919758657866915165201332480467127194998195481209996470680276955438320553419743409285076366446411459237915876713514676197204668785300100857270615348770478845912795954436677863461158442534283102154396294509903255539003316675136070586165787963286744036831353098283719024130881707718857451774498022915819->986236757547332986472011617696226561292849812918563355472727826767720188564083584387121625107510786855734801053524719833194566624465665316622563244215340671405971599343902468620306327831715457360719532421388780770165778156818229863337344187575566725786793391480600129482653072861971002459947277805295727097226389568776499707662505334062639449916265137796823793276300221537201727072401742985542559596685092673521228140822200236743113743661549252453726123450722876929538747702356573783116366629850199080495560991841329893037291900147497007197055572787780928474439121332736213562021554409579596714683101113281773829

[Args]
EQUAL,65537,24773058818499217187577663886010908531303294206336895556072197892590450942803807164562754911175164262596715237551312004078542654996496301487027034803410086499747369353221485073240039340641397198525027728751956658900801359887190562885573922317930300068615009483578963467556425525328780085523172495307229112069939166202511721671904748968934606589702999279663332403655662225374084460291376706916679151764149324177444374590606643838366605181996272409014933080082205048098737253668016260658830645459388519595314928290853199112791333551144805347785109465401055719331231478162870216035573012645710763533896540021550083104281->3,24773058818499217187577663886010908531303294206336895556072197892590450942803807164562754911175164262596715237551312004078542654996496301487027034803410086499747369353221485073240039340641397198525027728751956658900801359887190562885573922317930300068615009483578963467556425525328780085523172495307229112069939166202511721671904748968934606589702999279663332403655662225374084460291376706916679151764149324177444374590606643838366605181996272409014933080082205048098737253668016260658830645459388519595314928290853199112791333551144805347785109465401055719331231478162870216035573012645710763533896540021550083104281
EQUAL,65537,112990544699464667379805164176191940546242208117491544203358534026745357579006792084392734842374059845912387257283707238075863959850326589016727302942528968334782467185179054600102556548201786183972872728459057873984508534595649484729912852626347880177196897414735118804133099744542685440257890337513274043513->3,112990544699464667379805164176191940546242208117491544203358534026745357579006792084392734842374059845912387257283707238075863959850326589016727302942528968334782467185179054600102556548201786183972872728459057873984508534595649484729912852626347880177196897414735118804133099744542685440257890337513274043513
```

url.conf

```shell
[URL]
PREFIX,https://account.jetbrains.com/lservice/rpc/validateKey.action
```

4. 编辑JVM选项
5. 在空白行复制如下三串代码

```shell
--add-opens=java.base/jdk.internal.org.objectweb.asm=ALL-UNNAMED
--add-opens=java.base/jdk.internal.org.objectweb.asm.tree=ALL-UNNAMED
-javaagent:/path/ja-netfilter/ja-netfilter.jar
```

6. 去[https://3.jetbra.in/](https://3.jetbra.in/)或者[https://jetbra.in/s](https://jetbra.in/s)找激活码
7. 启动软件，激活
8. 下载Consolas字体
9.

如果输入法框不跟踪光标：[JetBrainsRuntime-for-Linux-x64](https://github.com/RikudouPatrickstar/JetBrainsRuntime-for-Linux-x64)

### 卸载预装软件

如果安装了gnome的小游戏全家桶，进行卸载

```shell
sudo apt purge aisleriot gnome-sudoku gnome-nibbles ace-of-penguins  gbrainy gnome-sushi gnome-taquin gnome-tetravex  gnome-robots gnome-chess lightsoff swell-foop quadrapassel tali gnome-mahjongg gnome-2048 iagno gnome-klotski five-or-more gnome-mines four-in-a-row hitori

sudo apt-get remove --purge "shotwell*"
sudo apt-get remove --purge "transmission-*"
sudo apt-get remove --purge "thunderbird*"
sudo apt-get remove --purge "mozc-*"
sudo apt-get remove --purge "anthy*"
sudo apt-get remove --purge "goldendict*"
sudo apt-get remove --purge "hdate-applet*"
sudo apt-get remove --purge "xiterm*"
sudo apt-get remove --purge "mlterm*"
sudo apt-get remove --purge "firefox*"
sudo apt-get remove --purge "evolution*"
sudo apt-get remove --purge "zenity*"
sudo apt-get remove --purge "gnome-games*"
sudo apt-get remove --purge "libreoffice*"

sudo apt-get clean
sudo apt-get autoremove
```

