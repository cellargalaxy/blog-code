---
title: 安装Archlinux手记
date: 2025-01-05
math: true
mermaid: true
sticky: 0
category: 折腾
tags:
---

Archlinux滚挂了两次，心累了。

## 硬件与目标

+ NVMe固态的笔记本电脑
+ 安装Debian单系统
+ 使用Btrfs磁盘格式
+ 安装GNOME桌面

## 前期准备

+ [ ] 下载安装镜像：https://www.debian.org/distrib/
    + 下载Live Gnome，虽然有烦人是小游戏，但能开箱即用
    + 不推荐「小型安装映像」与「完整安装映像」
    + 小型安装映像安装过程需要强制联网下载
    + 完整安装映像虽然不是强制联网，但是安装完还需要不少配置
+ SHA256校验镜像：随缘吧，心累了
+ 烧录U盘：https://etcher.balena.io/
    + dd命令虽然通用，但是看不到进度条，心里不安心

## 镜像与安装

无特别需要注意的，如果按照过程中U盘掉盘了，强制重启重装就好

### 准备非root用户

debian在安装时创建的用户默认没有sudo权限，需要手动添加

```shell
su #输入root密码
vi /etc/sudoers
#在%sudo ALL=(ALL:ALL) ALL下面添加
#xxx ALL=(ALL:ALL) ALL
#xxx为该用户的用户组
#不知道为什么是只读文件，但可以wq!强制保存
```

### 国内源

一下配置是debian12的，采用清华源，其余版本参考：https://mirrors.tuna.tsinghua.edu.cn/help/debian/

```shell
sudo vi /etc/apt/sources.list

# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware

deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware

deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware

# 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换
deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
```

### 更新系统

```shell
sudo apt-get update
sudo apt upgrade -y
```

### 软件 todo

```shell
sudo apt install -y adobe-source-han-serif-cn-fonts wqy-zenhei                     #几个开源中文字体。一般装上文泉驿就能解决大多 wine 应用中文方块的问题 todo,not work
sudo apt install -y noto-fonts-cjk noto-fonts-emoji noto-fonts-extra    #谷歌开源字体及表情 todo,not work
sudo apt install -y ntfs-3g git wget curl guake htop flatpak vim                   #一些常用软件
```

### 引导程序

```shell
#编辑引导配置，可选
#隐藏grub菜单
#GRUB_TIMEOUT与设置为0
sudo vim /etc/default/grub  #编辑
sudo update-grub            #更新
```

### 防火墙

```shell
sudo apt install -y ufw
sudo systemctl enable --now ufw
sudo systemctl status ufw

sudo ufw enable  #启动
sudo ufw disable #关闭

sudo ufw default deny #开启了防火墙并随系统启动同时关闭所有外部对本机的访问
sudo ufw reset        #重置所有规则
sudo ufw allow 8024
sudo ufw status numbered
sudo ufw delete 3
```

### docker


```shell
sudo apt install -y docker.io docker-compose

sudo systemctl enable docker  #开机启动docker
sudo systemctl start docker   #现在就启动docker

#docker拉取镜像走代理，https://neucrack.com/p/286
sudo systemctl status docker                            #查询docker的service文件路径
Environment="HTTP_PROXY=http://192.168.123.1:10809"     #在配置文件的[Service]下面增加环境变量
Environment="HTTPS_PROXY=http://192.168.123.1:10809"
sudo systemctl daemon-reload                            #重载service文件

sudo mkdir /etc/docker
sudo vim /etc/docker/daemon.json
{
  "log-driver":"json-file",
  "log-opts": {"max-size":"5m", "max-file":"3"}
}
sudo systemctl restart docker #重启docker生效配置
sudo docker info              #检查配置是否生效

sudo groupadd docker          #创建docker用户组
sudo gpasswd -a $USER docker  #将用户加入到docker用户组
newgrp docker                 #更新用户组
docker run --rm hello-world   #检查docker能否正常运行

```
